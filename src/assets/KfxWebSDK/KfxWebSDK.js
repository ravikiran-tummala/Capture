/* eslint-disable */
var compatibility=function(){"use strict";var e=0,t=!0,i=window.URL||window.webkitURL,n=function(t,i){var n=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,i){var n=(new Date).getTime(),a=Math.max(0,16-(n-e)),r=window.setTimeout(function(){t(n+a)},a);return e=n+a,r};return n.call(window,t,i)},a=function(e){var t=window.cancelAnimationFrame||function(e){clearTimeout(e)};return t.call(window,e)},r=function(e,t,i){if(!window.navigator.mediaDevices||!window.navigator.mediaDevices.getUserMedia){var n=window.navigator.mediaDevices.getUserMedia||window.navigator.getUserMedia||window.navigator.mozGetUserMedia||window.navigator.webkitGetUserMedia||window.navigator.msGetUserMedia||function(e,t,i){i()};return n.call(window.navigator,e,t,i)}window.navigator.mediaDevices.getUserMedia(e).then(function(e){t(e)})["catch"](function(e){i(e)})},o=function(){var e=new ArrayBuffer(8),i=new Uint32Array(e);return i[0]=4278190080,t=!0,255===e[0]&&(t=!1),t};return{URL:i,requestAnimationFrame:n,cancelAnimationFrame:a,getUserMedia:r,detectEndian:o,isLittleEndian:t}}();/*
The MIT License (MIT)

Copyright (c) 2008 Jacob Seidelin

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
*/
(function(){"use strict";function e(e){return!!e.exifdata}function t(e,t){t=t||e.match(/^data\:([^\;]+)\;base64,/im)[1]||"",e=e.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var i=atob(e),n=i.length,a=new ArrayBuffer(n),r=new Uint8Array(a),o=0;o<n;o++)r[o]=i.charCodeAt(o);return a}function i(e,t){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="blob",i.onload=function(e){200!=this.status&&0!==this.status||t(this.response)},i.send()}function n(e,n){function o(t){var i=a(t),o=r(t);e.exifdata=i||{},e.iptcdata=o||{},n&&n.call(e)}if(e.src)if(/^data\:/i.test(e.src)){var s=t(e.src);o(s)}else if(/^blob\:/i.test(e.src)){var l=new FileReader;l.onload=function(e){o(e.target.result)},i(e.src,function(e){l.readAsArrayBuffer(e)})}else{var c=new XMLHttpRequest;c.onload=function(){if(200!=this.status&&0!==this.status)throw"Could not load image";o(c.response),c=null},c.open("GET",e.src,!0),c.responseType="arraybuffer",c.send(null)}else if(window.FileReader&&(e instanceof window.Blob||e instanceof window.File)){var l=new FileReader;l.onload=function(e){f&&console.log("Got file of length "+e.target.result.byteLength),o(e.target.result)},l.readAsArrayBuffer(e)}}function a(e){var t=new DataView(e);if(f&&console.log("Got file of length "+e.byteLength),255!=t.getUint8(0)||216!=t.getUint8(1))return f&&console.log("Not a valid JPEG"),!1;for(var i,n=2,a=e.byteLength;n<a;){if(255!=t.getUint8(n))return f&&console.log("Not a valid marker at offset "+n+", found: "+t.getUint8(n)),!1;if(i=t.getUint8(n+1),f&&console.log(i),225==i)return f&&console.log("Found 0xFFE1 marker"),u(t,n+4,t.getUint16(n+2)-2);n+=2+t.getUint16(n+2)}}function r(e){var t=new DataView(e);if(f&&console.log("Got file of length "+e.byteLength),255!=t.getUint8(0)||216!=t.getUint8(1))return f&&console.log("Not a valid JPEG"),!1;for(var i=2,n=e.byteLength,a=function(e,t){return 56===e.getUint8(t)&&66===e.getUint8(t+1)&&73===e.getUint8(t+2)&&77===e.getUint8(t+3)&&4===e.getUint8(t+4)&&4===e.getUint8(t+5)};i<n;){if(a(t,i)){var r=t.getUint8(i+7);r%2!==0&&(r+=1),0===r&&(r=4);var s=i+8+r,l=t.getUint16(i+6+r);return o(e,s,l)}i++}}function o(e,t,i){for(var n,a,r,o,s,l=new DataView(e),u={},f=t;f<t+i;)28===l.getUint8(f)&&2===l.getUint8(f+1)&&(o=l.getUint8(f+2),o in y&&(r=l.getInt16(f+3),s=r+5,a=y[o],n=c(l,f+5,r),u.hasOwnProperty(a)?u[a]instanceof Array?u[a].push(n):u[a]=[u[a],n]:u[a]=n)),f++;return u}function s(e,t,i,n,a){var r,o,s,c=e.getUint16(i,!a),u={};for(s=0;s<c;s++)r=i+12*s+2,o=n[e.getUint16(r,!a)],!o&&f&&console.log("Unknown tag: "+e.getUint16(r,!a)),u[o]=l(e,r,t,i,a);return u}function l(e,t,i,n,a){var r,o,s,l,u,f,h=e.getUint16(t+2,!a),d=e.getUint32(t+4,!a),p=e.getUint32(t+8,!a)+i;switch(h){case 1:case 7:if(1==d)return e.getUint8(t+8,!a);for(r=d>4?p:t+8,o=[],l=0;l<d;l++)o[l]=e.getUint8(r+l);return o;case 2:return r=d>4?p:t+8,c(e,r,d-1);case 3:if(1==d)return e.getUint16(t+8,!a);for(r=d>2?p:t+8,o=[],l=0;l<d;l++)o[l]=e.getUint16(r+2*l,!a);return o;case 4:if(1==d)return e.getUint32(t+8,!a);for(o=[],l=0;l<d;l++)o[l]=e.getUint32(p+4*l,!a);return o;case 5:if(1==d)return u=e.getUint32(p,!a),f=e.getUint32(p+4,!a),s=new Number(u/f),s.numerator=u,s.denominator=f,s;for(o=[],l=0;l<d;l++)u=e.getUint32(p+8*l,!a),f=e.getUint32(p+4+8*l,!a),o[l]=new Number(u/f),o[l].numerator=u,o[l].denominator=f;return o;case 9:if(1==d)return e.getInt32(t+8,!a);for(o=[],l=0;l<d;l++)o[l]=e.getInt32(p+4*l,!a);return o;case 10:if(1==d)return e.getInt32(p,!a)/e.getInt32(p+4,!a);for(o=[],l=0;l<d;l++)o[l]=e.getInt32(p+8*l,!a)/e.getInt32(p+4+8*l,!a);return o}}function c(e,t,i){var n="";for(d=t;d<t+i;d++)n+=String.fromCharCode(e.getUint8(d));return n}function u(e,t){if("Exif"!=c(e,t,4))return f&&console.log("Not valid EXIF data! "+c(e,t,4)),!1;var i,n,a,r,o,l=t+6;if(18761==e.getUint16(l))i=!1;else{if(19789!=e.getUint16(l))return f&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;i=!0}if(42!=e.getUint16(l+2,!i))return f&&console.log("Not valid TIFF data! (no 0x002A)"),!1;var u=e.getUint32(l+4,!i);if(u<8)return f&&console.log("Not valid TIFF data! (First offset less than 8)",e.getUint32(l+4,!i)),!1;if(n=s(e,l,l+u,g,i),n.ExifIFDPointer){r=s(e,l,l+n.ExifIFDPointer,m,i);for(a in r){switch(a){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":r[a]=S[a][r[a]];break;case"ExifVersion":case"FlashpixVersion":r[a]=String.fromCharCode(r[a][0],r[a][1],r[a][2],r[a][3]);break;case"ComponentsConfiguration":r[a]=S.Components[r[a][0]]+S.Components[r[a][1]]+S.Components[r[a][2]]+S.Components[r[a][3]]}n[a]=r[a]}}if(n.GPSInfoIFDPointer){o=s(e,l,l+n.GPSInfoIFDPointer,v,i);for(a in o){switch(a){case"GPSVersionID":o[a]=o[a][0]+"."+o[a][1]+"."+o[a][2]+"."+o[a][3]}n[a]=o[a]}}return n}var f=!1,h=this,d=0,p=function(e){return e instanceof p?e:this instanceof p?void(this.EXIFwrapped=e):new p(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=p),exports.EXIF=p):h.EXIF=p;var m=p.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},g=p.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},v=p.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},S=p.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},y={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};p.getData=function(t,i){return!((t instanceof Image||t instanceof HTMLImageElement)&&!t.complete)&&(e(t)?i&&i.call(t):n(t,i),!0)},p.getTag=function(t,i){if(e(t))return t.exifdata[i]},p.getAllTags=function(t){if(!e(t))return{};var i,n=t.exifdata,a={};for(i in n)n.hasOwnProperty(i)&&(a[i]=n[i]);return a},p.pretty=function(t){if(!e(t))return"";var i,n=t.exifdata,a="";for(i in n)n.hasOwnProperty(i)&&(a+="object"==typeof n[i]?n[i]instanceof Number?i+" : "+n[i]+" ["+n[i].numerator+"/"+n[i].denominator+"]\r\n":i+" : ["+n[i].length+" values]\r\n":i+" : "+n[i]+"\r\n");return a},p.readFromBinaryFile=function(e){return a(e)},window.EXIF=p}).call(this);/*
The MIT License

Copyright (c) 2012 Eugene Zatepyakin

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
*/
var jsfeat=jsfeat||{REVISION:"ALPHA"};!function(e){"use strict";var t=1.192092896e-7,i=1e-37,n=256,a=512,r=1024,o=2048,s=4096,l=1,c=2,u=3,f=4,h=new Int32Array([-1,1,4,-1,4,-1,-1,-1,8,-1,-1,-1,-1,-1,-1,-1,8]),d=function(){return function(e){return 65280&e}}(),p=function(){return function(e){return 255&e}}(),m=function(){return function(e){return h[(65280&e)>>8]}}(),g=0,v=1,S=2,y=3,b=1,C=1,T=2,w=function(){function e(e,t){this.size=(e+7|0)&-8,"undefined"==typeof t?this.buffer=new ArrayBuffer(this.size):(this.buffer=t,this.size=t.length),this.u8=new Uint8Array(this.buffer),this.i32=new Int32Array(this.buffer),this.f32=new Float32Array(this.buffer),this.f64=new Float64Array(this.buffer)}return e}(),I=function(){function e(e,t,i,o){this.type=0|d(i),this.channel=0|p(i),this.cols=0|e,this.rows=0|t,"undefined"==typeof o?this.allocate():(this.buffer=o,this.data=this.type&n?this.buffer.u8:this.type&a?this.buffer.i32:this.type&r?this.buffer.f32:this.buffer.f64)}return e.prototype.allocate=function(){delete this.data,delete this.buffer,this.buffer=new w(this.cols*m(this.type)*this.channel*this.rows),this.data=this.type&n?this.buffer.u8:this.type&a?this.buffer.i32:this.type&r?this.buffer.f32:this.buffer.f64},e.prototype.copy_to=function(e){for(var t=e.data,i=this.data,n=0,a=this.cols*this.rows*this.channel|0;n<a-4;n+=4)t[n]=i[n],t[n+1]=i[n+1],t[n+2]=i[n+2],t[n+3]=i[n+3];for(;n<a;++n)t[n]=i[n]},e.prototype.resize=function(e,t,i){"undefined"==typeof i&&(i=this.channel);var n=e*m(this.type)*i*t;n>this.buffer.size?(this.cols=e,this.rows=t,this.channel=i,this.allocate()):(this.cols=e,this.rows=t,this.channel=i)},e}(),x=function(){function e(e){this.levels=0|e,this.data=new Array(e),this.pyrdown=jsfeat.imgproc.pyrdown}return e.prototype.allocate=function(e,t,i){for(var n=this.levels;--n>=0;)this.data[n]=new I(e>>n,t>>n,i)},e.prototype.build=function(e,t){"undefined"==typeof t&&(t=!0);var i=2,n=e,a=this.data[0];if(!t)for(var r=e.cols*e.rows;--r>=0;)a.data[r]=e.data[r];for(a=this.data[1],this.pyrdown(n,a);i<this.levels;++i)n=a,a=this.data[i],this.pyrdown(n,a)},e}(),A=function(){function e(e,t,i,n,a){"undefined"==typeof e&&(e=0),"undefined"==typeof t&&(t=0),"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),"undefined"==typeof a&&(a=-1),this.x=e,this.y=t,this.score=i,this.level=n,this.angle=a}return e}();e.U8_t=n,e.S32_t=a,e.F32_t=r,e.S64_t=o,e.F64_t=s,e.C1_t=l,e.C2_t=c,e.C3_t=u,e.C4_t=f,e.U8C1_t=n|l,e.U8C3_t=n|u,e.U8C4_t=n|f,e.F32C1_t=r|l,e.F32C2_t=r|c,e.S32C1_t=a|l,e.S32C2_t=a|c,e.EPSILON=t,e.FLT_MIN=i,e.COLOR_RGBA2GRAY=g,e.COLOR_RGB2GRAY=v,e.COLOR_BGRA2GRAY=S,e.COLOR_BGR2GRAY=y,e.BOX_BLUR_NOSCALE=b,e.SVD_U_T=C,e.SVD_V_T=T,e.get_data_type=d,e.get_channel=p,e.get_data_type_size=m,e.data_t=w,e.matrix_t=I,e.pyramid_t=x,e.keypoint_t=A}(jsfeat),function(e){var t=function(){var e,t,i=function(){function e(e){this.next=null,this.data=new jsfeat.data_t(e),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64}return e.prototype.resize=function(e){delete this.data,this.data=new jsfeat.data_t(e),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64},e}(),n=0;return{allocate:function(a,r){e=t=new i(r);for(var o=0;o<a;++o){var s=new i(r);t=t.next=s,n++}},get_buffer:function(t){var i=e;return e=e.next,n--,t>i.size&&i.resize(t),i},put_buffer:function(e){t=t.next=e,n++}}}();e.cache=t,t.allocate(30,2560)}(jsfeat),function(e){var t=function(){var e=new Int32Array(96);return{get_gaussian_kernel:function(e,t,i,n){var a=0,r=0,o=0,s=0,l=0,c=0,u=jsfeat.cache.get_buffer(e<<2),f=u.f32;if(1==(1&e)&&e<=7&&t<=0)switch(e>>1){case 0:f[0]=1,c=1;break;case 1:f[0]=.25,f[1]=.5,f[2]=.25,c=1;break;case 2:f[0]=.0625,f[1]=.25,f[2]=.375,f[3]=.25,f[4]=.0625,c=1;break;case 3:f[0]=.03125,f[1]=.109375,f[2]=.21875,f[3]=.28125,f[4]=.21875,f[5]=.109375,f[6]=.03125,c=1}else for(s=t>0?t:.3*(.5*(e-1)-1)+.8,l=-.5/(s*s);a<e;++a)r=a-.5*(e-1),o=Math.exp(l*r*r),f[a]=o,c+=o;if(n&jsfeat.U8_t)for(c=256/c,a=0;a<e;++a)i[a]=f[a]*c+.5|0;else for(c=1/c,a=0;a<e;++a)i[a]=f[a]*c;jsfeat.cache.put_buffer(u)},perspective_4point_transform:function(e,t,i,n,a,r,o,s,l,c,u,f,h,d,p,m,g){var v=t,S=c,y=o,b=v*S*y,C=p,T=v*C,w=S*T,I=u,x=v*I,A=r,E=i,P=d,D=E*P,_=D*A,M=P*A*I,O=P*y,L=P*I,R=S*y,k=C*S,F=C*A,U=I*A,G=1/(O-L-R+k-F+U),N=v*P,j=E*A,B=y*v,H=C*B,V=E*S,K=D*I,W=E*I*A,z=y*C*S,q=C*E,X=-(w-b+x*A-A*T-D*S+_-M+O*S)*G,Y=(b-w-N*y+N*I+_-S*j+F*S-M)*G,Z=v,J=(-I*T+H+V*y-D*y+K-W+F*I-z)*G,Q=(-H+B*I-q*S+K-W+q*A+z-O*I)*G,$=E,ee=(-x+B+V-j+L-O-k+F)*G,te=(-T+x+D-V+F-U-O+R)*G;v=n,S=f,y=l,b=v*S*y,C=g,T=v*C,w=S*T,I=h,x=v*I,A=s,E=a,P=m,D=E*P,_=D*A,M=P*A*I,O=P*y,L=P*I,R=S*y,k=C*S,F=C*A,U=I*A,G=1/(O-L-R+k-F+U),N=v*P,j=E*A,B=y*v,H=C*B,V=E*S,K=D*I,W=E*I*A,z=y*C*S,q=C*E;var ie=-(w-b+x*A-A*T-D*S+_-M+O*S)*G,ne=(b-w-N*y+N*I+_-S*j+F*S-M)*G,ae=v,re=(-I*T+H+V*y-D*y+K-W+F*I-z)*G,oe=(-H+B*I-q*S+K-W+q*A+z-O*I)*G,se=E,le=(-x+B+V-j+L-O-k+F)*G,ce=(-T+x+D-V+F-U-O+R)*G;S=Q-te*$,y=X*Q,b=X*$,T=J*Y,w=Z*J,x=Y*ee;var ue=Z*ee;P=1/(y-b*te-T+w*te+x*$-ue*Q),_=-J+$*ee;var fe=-J*te+Q*ee;U=-Y+Z*te;var he=X-ue;j=X*te-x,B=-Y*$+Z*Q;var de=b-w,pe=y-T;W=S*P;var me=U*P,ge=B*P,ve=e.data;ve[0]=ie*W+ne*(_*P)-ae*(fe*P),ve[1]=ie*me+ne*(he*P)-ae*(j*P),ve[2]=-ie*ge-ne*(de*P)+ae*(pe*P),ve[3]=re*W+oe*(_*P)-se*(fe*P),ve[4]=re*me+oe*(he*P)-se*(j*P),ve[5]=-re*ge-oe*(de*P)+se*(pe*P),ve[6]=le*W+ce*(_*P)-fe*P,ve[7]=le*me+ce*(he*P)-j*P,ve[8]=-le*ge-ce*(de*P)+pe*P},qsort:function(t,i,n,a){var r,o,s,l,c=7,u=0,f=0,h=0,d=0,p=0,m=0,g=0,v=0,S=0,y=0,b=0,C=0,T=0,w=0,I=0,x=0,A=0,E=0,P=e;if(!(n-i+1<=1))for(P[0]=i,P[1]=n;u>=0;)for(f=P[u<<1],h=P[(u<<1)+1],u--;;){if(p=h-f+1,p<=c){for(g=f+1;g<=h;g++)for(v=g;v>f&&a(t[v],t[v-1]);v--)r=t[v],t[v]=t[v-1],t[v-1]=r;break}for(E=0,y=f,C=h,w=f+(p>>1),p>40&&(S=p>>3,I=f,x=f+S,A=f+(S<<1),o=t[I],s=t[x],l=t[A],f=a(o,s)?a(s,l)?x:a(o,l)?A:I:a(l,s)?x:a(o,l)?I:A,I=w-S,x=w,A=w+S,o=t[I],s=t[x],l=t[A],w=a(o,s)?a(s,l)?x:a(o,l)?A:I:a(l,s)?x:a(o,l)?I:A,I=h-(S<<1),x=h-S,A=h,o=t[I],s=t[x],l=t[A],h=a(o,s)?a(s,l)?x:a(o,l)?A:I:a(l,s)?x:a(o,l)?I:A),I=f,x=w,A=h,o=t[I],s=t[x],l=t[A],w=a(o,s)?a(s,l)?x:a(o,l)?A:I:a(l,s)?x:a(o,l)?I:A,w!=y&&(r=t[w],t[w]=t[y],t[y]=r,w=y),f=b=y+1,h=T=C,o=t[w];;){for(;f<=h&&!a(o,t[f]);)a(t[f],o)||(f>b&&(r=t[b],t[b]=t[f],t[f]=r),E=1,b++),f++;for(;f<=h&&!a(t[h],o);)a(o,t[h])||(h<T&&(r=t[T],t[T]=t[h],t[h]=r),E=1,T--),h--;if(f>h)break;r=t[f],t[f]=t[h],t[h]=r,E=1,f++,h--}if(0==E){for(f=y,h=C,g=f+1;g<=h;g++)for(v=g;v>f&&a(t[v],t[v-1]);v--)r=t[v],t[v]=t[v-1],t[v-1]=r;break}for(p=Math.min(b-y,f-b),m=f-p|0,d=0;d<p;++d,++m)r=t[y+d],t[y+d]=t[m],t[m]=r;for(p=Math.min(C-T,T-h),m=C-p+1|0,d=0;d<p;++d,++m)r=t[f+d],t[f+d]=t[m],t[m]=r;if(p=f-b,m=T-h,p>1)m>1?p>m?(++u,P[u<<1]=y,P[(u<<1)+1]=y+p-1,f=C-m+1,h=C):(++u,P[u<<1]=C-m+1,P[(u<<1)+1]=C,f=y,h=y+p-1):(f=y,h=y+p-1);else{if(!(m>1))break;f=C-m+1,h=C}}},median:function(e,t,i){for(var n,a=0,r=0,o=0,s=t+i>>1;;){if(i<=t)return e[s];if(i==t+1)return e[t]>e[i]&&(n=e[t],e[t]=e[i],e[i]=n),e[s];for(a=t+i>>1,e[a]>e[i]&&(n=e[a],e[a]=e[i],e[i]=n),e[t]>e[i]&&(n=e[t],e[t]=e[i],e[i]=n),e[a]>e[t]&&(n=e[a],e[a]=e[t],e[t]=n),r=t+1,n=e[a],e[a]=e[r],e[r]=n,o=i;;){do++r;while(e[t]>e[r]);do--o;while(e[o]>e[t]);if(o<r)break;n=e[r],e[r]=e[o],e[o]=n}n=e[t],e[t]=e[o],e[o]=n,o<=s?t=r:o>=s&&(i=o-1)}}}}();e.math=t}(jsfeat),function(e){var t=function(){return{identity:function(e,t){"undefined"==typeof t&&(t=1);for(var i=e.data,n=e.rows,a=e.cols,r=a+1|0,o=n*a,s=o;--o>=0;)i[o]=0;for(o=s,s=0;s<o;)i[s]=t,s+=r},transpose:function(e,t){for(var i=0,n=0,a=t.rows,r=t.cols,o=0,s=0,l=0,c=t.data,u=e.data;i<a;s+=1,o+=r,i++)for(l=s,n=0;n<r;l+=a,n++)u[l]=c[o+n]},multiply:function(e,t,i){for(var n=0,a=0,r=0,o=0,s=0,l=0,c=0,u=0,f=t.cols,h=t.rows,d=i.cols,p=t.data,m=i.data,g=e.data,v=0;n<h;o+=f,n++)for(c=0,a=0;a<d;u++,c++,a++){for(l=c,s=o,v=0,r=0;r<f;s++,l+=d,r++)v+=p[s]*m[l];g[u]=v}},multiply_ABt:function(e,t,i){for(var n=0,a=0,r=0,o=0,s=0,l=0,c=0,u=t.cols,f=t.rows,h=i.rows,d=t.data,p=i.data,m=e.data,g=0;n<f;o+=u,n++)for(l=0,a=0;a<h;c++,a++){for(s=o,g=0,r=0;r<u;s++,l++,r++)g+=d[s]*p[l];m[c]=g}},multiply_AtB:function(e,t,i){for(var n=0,a=0,r=0,o=0,s=0,l=0,c=0,u=0,f=t.cols,h=t.rows,d=i.cols,p=t.data,m=i.data,g=e.data,v=0;n<f;o++,n++)for(c=0,a=0;a<d;u++,c++,a++){for(l=c,s=o,v=0,r=0;r<h;s+=f,l+=d,r++)v+=p[s]*m[l];g[u]=v}},multiply_AAt:function(e,t){for(var i=0,n=0,a=0,r=0,o=0,s=0,l=0,c=0,u=0,f=t.cols,h=t.rows,d=t.data,p=e.data,m=0;i<h;r+=h+1,o=s,i++)for(c=r,u=r,l=o,n=i;n<h;c++,u+=h,n++){for(s=o,m=0,a=0;a<f;a++)m+=d[s++]*d[l++];p[c]=m,p[u]=m}},multiply_AtA:function(e,t){for(var i=0,n=0,a=0,r=0,o=0,s=0,l=0,c=0,u=0,f=t.cols,h=t.rows,d=t.data,p=e.data,m=0;i<f;l+=f,i++)for(r=i,u=l+i,c=u,n=i;n<f;c++,u+=f,n++){for(o=r,s=n,m=0,a=0;a<h;o+=f,s+=f,a++)m+=d[o]*d[s];p[c]=m,p[u]=m}},identity_3x3:function(e,t){"undefined"==typeof t&&(t=1);var i=e.data;i[0]=i[4]=i[8]=t,i[1]=i[2]=i[3]=0,i[5]=i[6]=i[7]=0},invert_3x3:function(e,t){var i=e.data,n=t.data,a=i[4],r=i[8],o=i[5],s=i[7],l=i[0],c=l*a,u=l*o,f=i[3],h=i[1],d=f*h,p=i[2],m=f*p,g=i[6],v=g*h,S=g*p,y=1/(c*r-u*s-d*r+m*s+v*o-S*a);n[0]=(a*r-o*s)*y,n[1]=-(h*r-p*s)*y,n[2]=-(-h*o+p*a)*y,n[3]=-(f*r-o*g)*y,n[4]=(l*r-S)*y,n[5]=-(u-m)*y,n[6]=-(-f*s+a*g)*y,n[7]=-(l*s-v)*y,n[8]=(c-d)*y},multiply_3x3:function(e,t,i){var n=e.data,a=t.data,r=i.data,o=a[0],s=a[1],l=a[2],c=a[3],u=a[4],f=a[5],h=a[6],d=a[7],p=a[8],m=r[0],g=r[1],v=r[2],S=r[3],y=r[4],b=r[5],C=r[6],T=r[7],w=r[8];n[0]=o*m+s*S+l*C,n[1]=o*g+s*y+l*T,n[2]=o*v+s*b+l*w,n[3]=c*m+u*S+f*C,n[4]=c*g+u*y+f*T,n[5]=c*v+u*b+f*w,n[6]=h*m+d*S+p*C,n[7]=h*g+d*y+p*T,n[8]=h*v+d*b+p*w},mat3x3_determinant:function(e){var t=e.data;return t[0]*t[4]*t[8]-t[0]*t[5]*t[7]-t[3]*t[1]*t[8]+t[3]*t[2]*t[7]+t[6]*t[1]*t[5]-t[6]*t[2]*t[4]},determinant_3x3:function(e,t,i,n,a,r,o,s,l){return e*a*l-e*r*s-n*t*l+n*i*s+o*t*r-o*i*a}}}();e.matmath=t}(jsfeat),function(e){var t=function(){var e=function(e,t,i,n){n=e[t],e[t]=e[i],e[i]=n},t=function(e,t){return e=Math.abs(e),t=Math.abs(t),e>t?(t/=e,e*Math.sqrt(1+t*t)):t>0?(e/=t,t*Math.sqrt(1+e*e)):0},i=function(i,n,a,r,o,s){var l=jsfeat.EPSILON,c=0,u=0,f=0,h=0,d=0,p=0,m=0,g=0,v=0,S=s*s*30,y=0,b=0,C=0,T=0,w=0,I=0,x=0,A=0,E=0,P=jsfeat.cache.get_buffer(s<<2),D=jsfeat.cache.get_buffer(s<<2),_=P.i32,M=D.i32;if(r)for(;c<s;c++){for(f=c*o,u=0;u<s;u++)r[f+u]=0;r[f+c]=1}for(f=0;f<s;f++){if(a[f]=i[(n+1)*f],f<s-1){for(h=f+1,y=Math.abs(i[n*f+h]),c=f+2;c<s;c++)b=Math.abs(i[n*f+c]),y<b&&(y=b,h=c);_[f]=h}if(f>0){for(h=0,y=Math.abs(i[f]),c=1;c<f;c++)b=Math.abs(i[n*c+f]),y<b&&(y=b,h=c);M[f]=h}}if(s>1)for(;v<S;v++){for(f=0,y=Math.abs(i[_[0]]),c=1;c<s-1;c++)b=Math.abs(i[n*c+_[c]]),y<b&&(y=b,f=c);for(d=_[f],c=1;c<s;c++)b=Math.abs(i[n*M[c]+c]),y<b&&(y=b,f=M[c],d=c);if(C=i[n*f+d],Math.abs(C)<=l)break;for(T=.5*(a[d]-a[f]),w=Math.abs(T)+t(C,T),I=t(C,w),x=w/I,I=C/I,w=C/w*C,T<0&&(I=-I,w=-w),i[n*f+d]=0,a[f]-=w,a[d]+=w,c=0;c<f;c++)m=n*c+f,g=n*c+d,A=i[m],E=i[g],i[m]=A*x-E*I,i[g]=A*I+E*x;for(c=f+1;c<d;c++)m=n*f+c,g=n*c+d,A=i[m],E=i[g],i[m]=A*x-E*I,i[g]=A*I+E*x;for(c=d+1,m=n*f+c,g=n*d+c;c<s;c++,m++,g++)A=i[m],E=i[g],i[m]=A*x-E*I,i[g]=A*I+E*x;if(r)for(m=o*f,g=o*d,c=0;c<s;c++,m++,g++)A=r[m],E=r[g],r[m]=A*x-E*I,r[g]=A*I+E*x;for(u=0;u<2;u++){if(p=0==u?f:d,p<s-1){for(h=p+1,y=Math.abs(i[n*p+h]),c=p+2;c<s;c++)b=Math.abs(i[n*p+c]),y<b&&(y=b,h=c);_[p]=h}if(p>0){for(h=0,y=Math.abs(i[p]),c=1;c<p;c++)b=Math.abs(i[n*c+p]),y<b&&(y=b,h=c);M[p]=h}}}for(f=0;f<s-1;f++){for(h=f,c=f+1;c<s;c++)a[h]<a[c]&&(h=c);if(f!=h&&(e(a,h,f,y),r))for(c=0;c<s;c++)e(r,o*h+c,o*f+c,y)}jsfeat.cache.put_buffer(P),jsfeat.cache.put_buffer(D)},n=function(i,n,a,r,o,s,l,c){for(var u=2*jsfeat.EPSILON,f=jsfeat.FLT_MIN,h=0,d=0,p=0,m=0,g=Math.max(s,30),v=0,S=0,y=0,b=0,C=0,T=0,w=0,I=0,x=0,A=0,E=0,P=0,D=0,_=0,M=0,O=0,L=0,R=4660,k=0,F=0,U=0,G=jsfeat.cache.get_buffer(l<<3),N=G.f64;h<l;h++){for(p=0,E=0;p<s;p++)I=i[h*n+p],E+=I*I;if(N[h]=E,r){for(p=0;p<l;p++)r[h*o+p]=0;r[h*o+h]=1}}for(;m<g;m++){for(C=0,h=0;h<l-1;h++)for(d=h+1;d<l;d++){for(v=h*n|0,S=d*n|0,M=N[h],O=0,L=N[d],p=2,O+=i[v]*i[S],O+=i[v+1]*i[S+1];p<s;p++)O+=i[v+p]*i[S+p];if(!(Math.abs(O)<=u*Math.sqrt(M*L))){for(O*=2,P=M-L,D=t(O,P),P<0?(_=.5*(D-P),w=Math.sqrt(_/D),T=O/(D*w*2)):(T=Math.sqrt((D+P)/(2*D)),w=O/(D*T*2)),M=0,L=0,p=2,x=T*i[v]+w*i[S],A=-w*i[v]+T*i[S],i[v]=x,i[S]=A,M+=x*x,L+=A*A,x=T*i[v+1]+w*i[S+1],A=-w*i[v+1]+T*i[S+1],i[v+1]=x,i[S+1]=A,M+=x*x,L+=A*A;p<s;p++)x=T*i[v+p]+w*i[S+p],A=-w*i[v+p]+T*i[S+p],i[v+p]=x,i[S+p]=A,M+=x*x,L+=A*A;if(N[h]=M,N[d]=L,C=1,r)for(y=h*o|0,b=d*o|0,p=2,x=T*r[y]+w*r[b],A=-w*r[y]+T*r[b],r[y]=x,r[b]=A,x=T*r[y+1]+w*r[b+1],A=-w*r[y+1]+T*r[b+1],r[y+1]=x,r[b+1]=A;p<l;p++)x=T*r[y+p]+w*r[b+p],A=-w*r[y+p]+T*r[b+p],r[y+p]=x,r[b+p]=A}}if(0==C)break}for(h=0;h<l;h++){for(p=0,E=0;p<s;p++)I=i[h*n+p],E+=I*I;N[h]=Math.sqrt(E)}for(h=0;h<l-1;h++){for(d=h,p=h+1;p<l;p++)N[d]<N[p]&&(d=p);if(h!=d&&(e(N,h,d,E),r)){for(p=0;p<s;p++)e(i,h*n+p,d*n+p,I);for(p=0;p<l;p++)e(r,h*o+p,d*o+p,I)}}for(h=0;h<l;h++)a[h]=N[h];if(!r)return void jsfeat.cache.put_buffer(G);for(h=0;h<c;h++){for(E=h<l?N[h]:0;E<=f;){for(F=1/s,p=0;p<s;p++)R=214013*R+2531011,k=0!=(R>>16&32767&256)?F:-F,i[h*n+p]=k;for(m=0;m<2;m++)for(d=0;d<h;d++){for(E=0,p=0;p<s;p++)E+=i[h*n+p]*i[d*n+p];for(U=0,p=0;p<s;p++)I=i[h*n+p]-E*i[d*n+p],i[h*n+p]=I,U+=Math.abs(I);for(U=U?1/U:0,p=0;p<s;p++)i[h*n+p]*=U}for(E=0,p=0;p<s;p++)I=i[h*n+p],E+=I*I;E=Math.sqrt(E)}for(w=1/E,p=0;p<s;p++)i[h*n+p]*=w}jsfeat.cache.put_buffer(G)};return{lu_solve:function(t,i){var n,a,r,o,s=0,l=0,c=0,u=1,f=t.cols,h=t.data,d=i.data;for(s=0;s<f;s++){for(c=s,l=s+1;l<f;l++)Math.abs(h[l*f+s])>Math.abs(h[c*f+s])&&(c=l);if(Math.abs(h[c*f+s])<jsfeat.EPSILON)return 0;if(c!=s){for(l=s;l<f;l++)e(h,s*f+l,c*f+l,n);e(d,s,c,n),u=-u}for(r=-1/h[s*f+s],l=s+1;l<f;l++){for(a=h[l*f+s]*r,c=s+1;c<f;c++)h[l*f+c]+=a*h[s*f+c];d[l]+=a*d[s]}h[s*f+s]=-r}for(s=f-1;s>=0;s--){for(o=d[s],c=s+1;c<f;c++)o-=h[s*f+c]*d[c];d[s]=o*h[s*f+s]}return 1},cholesky_solve:function(e,t){var i,n,a=0,r=0,o=0,s=0,l=0,c=0,u=0,f=e.cols,h=e.data,d=t.data;for(a=0;a<f;a++)for(n=1,s=a*f,l=s,r=a;r<f;r++){for(i=h[l+a],o=0;o<a;o++)i-=h[o*f+a]*h[l+o];if(r==a){if(h[l+a]=i,0==i)return 0;n=1/i}else h[s+r]=i,h[l+a]=i*n;l+=f}for(s=0,c=0;c<f;c++){for(i=d[c],u=0;u<c;u++)i-=h[s+u]*d[u];d[c]=i,s+=f}for(s=0,c=0;c<f;c++)d[c]/=h[s+c],s+=f;for(c=f-1;c>=0;c--){for(i=d[c],u=c+1,s=u*f;u<f;u++)i-=h[s+c]*d[u],s+=f;d[c]=i}return 1},svd_decompose:function(e,t,i,a,r){"undefined"==typeof r&&(r=0);var o=0,s=0,l=e.rows,c=e.cols,u=l,f=c,h=e.type|jsfeat.C1_t;u<f&&(o=1,s=u,u=f,f=s);var d=jsfeat.cache.get_buffer(u*u<<3),p=jsfeat.cache.get_buffer(f<<3),m=jsfeat.cache.get_buffer(f*f<<3),g=new jsfeat.matrix_t(u,u,h,d.data),v=new jsfeat.matrix_t(1,f,h,p.data),S=new jsfeat.matrix_t(f,f,h,m.data);if(0==o)jsfeat.matmath.transpose(g,e);else{for(s=0;s<c*l;s++)g.data[s]=e.data[s];for(;s<f*u;s++)g.data[s]=0}if(n(g.data,u,v.data,S.data,f,u,f,u),t){for(s=0;s<f;s++)t.data[s]=v.data[s];for(;s<c;s++)t.data[s]=0}if(0==o){if(i&&r&jsfeat.SVD_U_T)for(s=u*u;--s>=0;)i.data[s]=g.data[s];else i&&jsfeat.matmath.transpose(i,g);if(a&&r&jsfeat.SVD_V_T)for(s=f*f;--s>=0;)a.data[s]=S.data[s];else a&&jsfeat.matmath.transpose(a,S)}else{if(i&&r&jsfeat.SVD_U_T)for(s=f*f;--s>=0;)i.data[s]=S.data[s];else i&&jsfeat.matmath.transpose(i,S);if(a&&r&jsfeat.SVD_V_T)for(s=u*u;--s>=0;)a.data[s]=g.data[s];else a&&jsfeat.matmath.transpose(a,g)}jsfeat.cache.put_buffer(d),jsfeat.cache.put_buffer(p),jsfeat.cache.put_buffer(m)},svd_solve:function(e,t,i){var n=0,a=0,r=0,o=0,s=0,l=e.rows,c=e.cols,u=0,f=0,h=0,d=e.type|jsfeat.C1_t,p=jsfeat.cache.get_buffer(l*l<<3),m=jsfeat.cache.get_buffer(c<<3),g=jsfeat.cache.get_buffer(c*c<<3),v=new jsfeat.matrix_t(l,l,d,p.data),S=new jsfeat.matrix_t(1,c,d,m.data),y=new jsfeat.matrix_t(c,c,d,g.data),b=i.data,C=v.data,T=S.data,w=y.data;for(this.svd_decompose(e,S,v,y,0),h=jsfeat.EPSILON*T[0]*c;n<c;n++,s+=c){for(f=0,a=0;a<c;a++)if(T[a]>h){for(r=0,u=0,o=0;r<l;r++,o+=c)u+=C[o+a]*b[r];f+=u*w[s+a]/T[a]}t.data[n]=f}jsfeat.cache.put_buffer(p),jsfeat.cache.put_buffer(m),jsfeat.cache.put_buffer(g)},svd_invert:function(e,t){var i=0,n=0,a=0,r=0,o=0,s=0,l=t.rows,c=t.cols,u=0,f=0,h=t.type|jsfeat.C1_t,d=jsfeat.cache.get_buffer(l*l<<3),p=jsfeat.cache.get_buffer(c<<3),m=jsfeat.cache.get_buffer(c*c<<3),g=new jsfeat.matrix_t(l,l,h,d.data),v=new jsfeat.matrix_t(1,c,h,p.data),S=new jsfeat.matrix_t(c,c,h,m.data),y=e.data,b=g.data,C=v.data,T=S.data;for(this.svd_decompose(t,v,g,S,0),f=jsfeat.EPSILON*C[0]*c;i<c;i++,o+=c)for(n=0,r=0;n<l;n++,s++){for(a=0,u=0;a<c;a++,r++)C[a]>f&&(u+=T[o+a]*b[r]/C[a]);y[s]=u}jsfeat.cache.put_buffer(d),jsfeat.cache.put_buffer(p),jsfeat.cache.put_buffer(m)},eigenVV:function(e,t,n){for(var a=e.cols,r=a*a,o=e.type|jsfeat.C1_t,s=jsfeat.cache.get_buffer(a*a<<3),l=jsfeat.cache.get_buffer(a<<3),c=new jsfeat.matrix_t(a,a,o,s.data),u=new jsfeat.matrix_t(1,a,o,l.data);--r>=0;)c.data[r]=e.data[r];if(i(c.data,a,u.data,t?t.data:null,a,a),n)for(;--a>=0;)n.data[a]=u.data[a];jsfeat.cache.put_buffer(s),jsfeat.cache.put_buffer(l)}}}();e.linalg=t}(jsfeat),function(e){var t=function(){var e=function(e){return e*e},t=function(e,t,i,n,a){for(var r=0,o=0,s=0,l=0,c=0,u=0,f=0,h=0,d=0,p=0,m=0;r<a;++r)o+=e[r].x,s+=e[r].y,u+=t[r].x,f+=t[r].y;for(o/=a,s/=a,u/=a,f/=a,r=0;r<a;++r)p=e[r].x-o,m=e[r].y-s,l+=Math.sqrt(p*p+m*m),p=t[r].x-u,m=t[r].y-f,h+=Math.sqrt(p*p+m*m);l/=a,h/=a,c=Math.SQRT2/l,d=Math.SQRT2/h,i[0]=i[4]=c,i[2]=-o*c,i[5]=-s*c,i[1]=i[3]=i[6]=i[7]=0,i[8]=1,n[0]=n[4]=d,n[2]=-u*d,n[5]=-f*d,n[1]=n[3]=n[6]=n[7]=0,n[8]=1},i=new jsfeat.matrix_t(3,3,jsfeat.F32_t|jsfeat.C1_t),n=new jsfeat.matrix_t(3,3,jsfeat.F32_t|jsfeat.C1_t),a=new jsfeat.matrix_t(6,6,jsfeat.F32_t|jsfeat.C1_t),r=new jsfeat.matrix_t(6,1,jsfeat.F32_t|jsfeat.C1_t),o=function(){function o(){}return o.prototype.run=function(e,o,s,l){var c,u,f=0,h=0,d=s.type|jsfeat.C1_t,p=s.data,m=i.data,g=n.data,v=0,S=0;t(e,o,m,g,l);for(var y=jsfeat.cache.get_buffer(2*l*6<<3),b=jsfeat.cache.get_buffer(2*l<<3),C=new jsfeat.matrix_t(6,2*l,d,y.data),T=new jsfeat.matrix_t(1,2*l,d,b.data),w=C.data,I=T.data;f<l;++f)c=e[f],u=o[f],v=m[0]*c.x+m[1]*c.y+m[2],S=m[3]*c.x+m[4]*c.y+m[5],h=2*f*6,w[h]=v,w[h+1]=S,w[h+2]=1,w[h+3]=0,w[h+4]=0,w[h+5]=0,h+=6,w[h]=0,w[h+1]=0,w[h+2]=0,w[h+3]=v,w[h+4]=S,w[h+5]=1,I[f<<1]=g[0]*u.x+g[1]*u.y+g[2],I[(f<<1)+1]=g[3]*u.x+g[4]*u.y+g[5];return jsfeat.matmath.multiply_AtA(a,C),jsfeat.matmath.multiply_AtB(r,C,T),jsfeat.linalg.lu_solve(a,r),p[0]=r.data[0],p[1]=r.data[1],p[2]=r.data[2],p[3]=r.data[3],p[4]=r.data[4],p[5]=r.data[5],p[6]=0,p[7]=0,p[8]=1,jsfeat.matmath.invert_3x3(n,n),jsfeat.matmath.multiply_3x3(s,n,s),jsfeat.matmath.multiply_3x3(s,s,i),jsfeat.cache.put_buffer(y),jsfeat.cache.put_buffer(b),1},o.prototype.error=function(t,i,n,a,r){for(var o,s,l=0,c=n.data;l<r;++l)o=t[l],s=i[l],a[l]=e(s.x-c[0]*o.x-c[1]*o.y-c[2])+e(s.y-c[3]*o.x-c[4]*o.y-c[5])},o.prototype.check_subset=function(e,t,i){return!0},o}(),s=new jsfeat.matrix_t(9,9,jsfeat.F32_t|jsfeat.C1_t),l=new jsfeat.matrix_t(9,9,jsfeat.F32_t|jsfeat.C1_t),c=function(){function e(){}return e.prototype.run=function(e,t,a,r){for(var o=0,c=0,u=a.data,f=i.data,h=n.data,d=s.data,p=l.data,m=0,g=0,v=0,S=0,y=0,b=0,C=0,T=0,w=0,I=0,x=0,A=0;o<r;++o)C+=t[o].x,T+=t[o].y,x+=e[o].x,A+=e[o].y;for(C/=r,T/=r,x/=r,A/=r,o=0;o<r;++o)y+=Math.abs(t[o].x-C),b+=Math.abs(t[o].y-T),w+=Math.abs(e[o].x-x),I+=Math.abs(e[o].y-A);if(Math.abs(y)<jsfeat.EPSILON||Math.abs(b)<jsfeat.EPSILON||Math.abs(w)<jsfeat.EPSILON||Math.abs(I)<jsfeat.EPSILON)return 0;for(y=r/y,b=r/b,w=r/w,I=r/I,f[0]=w,f[1]=0,f[2]=-x*w,f[3]=0,f[4]=I,f[5]=-A*I,f[6]=0,f[7]=0,f[8]=1,h[0]=1/y,h[1]=0,h[2]=C,h[3]=0,h[4]=1/b,h[5]=T,h[6]=0,h[7]=0,h[8]=1,o=81;--o>=0;)d[o]=0;for(o=0;o<r;++o)m=(t[o].x-C)*y,g=(t[o].y-T)*b,v=(e[o].x-x)*w,S=(e[o].y-A)*I,d[0]+=v*v,d[1]+=v*S,d[2]+=v,d[6]+=v*-m*v,d[7]+=v*-m*S,d[8]+=v*-m,d[10]+=S*S,d[11]+=S,d[15]+=S*-m*v,d[16]+=S*-m*S,d[17]+=S*-m,d[20]+=1,d[24]+=-m*v,d[25]+=-m*S,d[26]+=-m,d[30]+=v*v,d[31]+=v*S,d[32]+=v,d[33]+=v*-g*v,d[34]+=v*-g*S,d[35]+=v*-g,d[40]+=S*S,d[41]+=S,d[42]+=S*-g*v,d[43]+=S*-g*S,d[44]+=S*-g,d[50]+=1,d[51]+=-g*v,d[52]+=-g*S,d[53]+=-g,d[60]+=-m*v*-m*v+-g*v*-g*v,d[61]+=-m*v*-m*S+-g*v*-g*S,d[62]+=-m*v*-m+-g*v*-g,d[70]+=-m*S*-m*S+-g*S*-g*S,d[71]+=-m*S*-m+-g*S*-g,d[80]+=-m*-m+-g*-g;for(o=0;o<9;++o)for(c=0;c<o;++c)d[9*o+c]=d[9*c+o];return jsfeat.linalg.eigenVV(s,l),u[0]=p[72],u[1]=p[73],u[2]=p[74],u[3]=p[75],u[4]=p[76],u[5]=p[77],u[6]=p[78],u[7]=p[79],u[8]=p[80],jsfeat.matmath.multiply_3x3(a,n,a),jsfeat.matmath.multiply_3x3(a,a,i),m=1/u[8],u[0]*=m,u[1]*=m,u[2]*=m,u[3]*=m,u[4]*=m,u[5]*=m,u[6]*=m,u[7]*=m,u[8]=1,1},e.prototype.error=function(e,t,i,n,a){for(var r,o,s=0,l=0,c=0,u=0,f=i.data;s<a;++s)r=e[s],o=t[s],l=1/(f[6]*r.x+f[7]*r.y+1),c=(f[0]*r.x+f[1]*r.y+f[2])*l-o.x,u=(f[3]*r.x+f[4]*r.y+f[5])*l-o.y,n[s]=c*c+u*u},e.prototype.check_subset=function(e,t,i){if(4==i){var n=0,a=e[0],r=e[1],o=e[2],s=e[3],l=t[0],c=t[1],u=t[2],f=t[3],h=a.x,d=a.y,p=1,m=r.x,g=r.y,v=1,S=o.x,y=o.y,b=1,C=l.x,T=l.y,w=1,I=c.x,x=c.y,A=1,E=u.x,P=u.y,D=1,_=jsfeat.matmath.determinant_3x3(h,d,p,m,g,v,S,y,b),M=jsfeat.matmath.determinant_3x3(C,T,w,I,x,A,E,P,D);if(_*M<0&&n++,h=r.x,d=r.y,m=o.x,g=o.y,S=s.x,y=s.y,C=c.x,T=c.y,I=u.x,x=u.y,E=f.x,P=f.y,_=jsfeat.matmath.determinant_3x3(h,d,p,m,g,v,S,y,b),M=jsfeat.matmath.determinant_3x3(C,T,w,I,x,A,E,P,D),_*M<0&&n++,h=a.x,d=a.y,m=o.x,g=o.y,S=s.x,y=s.y,C=l.x,T=l.y,I=u.x,x=u.y,E=f.x,P=f.y,_=jsfeat.matmath.determinant_3x3(h,d,p,m,g,v,S,y,b),M=jsfeat.matmath.determinant_3x3(C,T,w,I,x,A,E,P,D),_*M<0&&n++,h=a.x,d=a.y,m=r.x,g=r.y,S=s.x,y=s.y,C=l.x,T=l.y,I=c.x,x=c.y,E=f.x,P=f.y,_=jsfeat.matmath.determinant_3x3(h,d,p,m,g,v,S,y,b),M=jsfeat.matmath.determinant_3x3(C,T,w,I,x,A,E,P,D),_*M<0&&n++,0!=n&&4!=n)return!1}return!0},e}();return{affine2d:o,homography2d:c}}(),i=function(){function e(e,t,i,n){"undefined"==typeof e&&(e=0),"undefined"==typeof t&&(t=.5),"undefined"==typeof i&&(i=.5),"undefined"==typeof n&&(n=.99),this.size=e,this.thresh=t,this.eps=i,this.prob=n}return e.prototype.update_iters=function(e,t){var i=Math.log(1-this.prob),n=Math.log(1-Math.pow(1-e,this.size));return 0|(n>=0||-i>=t*-n?t:Math.round(i/n))},e}(),n=function(){var e=function(e,t,i,n,a,r,o){for(var s=1e3,l=[],c=0,u=0,f=0,h=0,d=!1;f<s;++f){for(c=0;c<n&&f<s;){for(d=!1,h=0;!d;)for(d=!0,h=l[c]=0|Math.floor(Math.random()*a),u=0;u<c;++u)if(h==l[u]){d=!1;break}r[c]=t[h],o[c]=i[h],e.check_subset(r,o,c+1)?++c:f++}break}return c==n&&f<s},t=function(e,t,i,n,a,r,o,s){var l=0,c=0,u=0,f=r*r;for(e.error(i,n,t,o,a);c<a;++c)u=o[c]<=f,s[c]=u,l+=u;return l};return{ransac:function(i,n,a,r,o,s,l,c){if("undefined"==typeof c&&(c=1e3),o<i.size)return!1;var u=i.size,f=c,h=0,d=!1,p=[],m=[],g=!1,v=s.cols,S=s.rows,y=s.type|jsfeat.C1_t,b=jsfeat.cache.get_buffer(v*S<<3),C=jsfeat.cache.get_buffer(o),T=jsfeat.cache.get_buffer(o<<2),w=new jsfeat.matrix_t(v,S,y,b.data),I=new jsfeat.matrix_t(o,1,jsfeat.U8C1_t,C.data),x=-1,A=0,E=0,P=T.f32;if(o==u){if(n.run(a,r,w,o)<=0)return jsfeat.cache.put_buffer(b),jsfeat.cache.put_buffer(C),jsfeat.cache.put_buffer(T),!1;if(w.copy_to(s),l)for(;--o>=0;)l.data[o]=1;return jsfeat.cache.put_buffer(b),jsfeat.cache.put_buffer(C),jsfeat.cache.put_buffer(T),!0}for(;h<f;++h){if(g=e(n,a,r,u,o,p,m),!g){if(0==h)return jsfeat.cache.put_buffer(b),jsfeat.cache.put_buffer(C),jsfeat.cache.put_buffer(T),!1;break}E=n.run(p,m,w,u),E<=0||(A=t(n,w,a,r,o,i.thresh,P,I.data),A>Math.max(x,u-1)&&(w.copy_to(s),x=A,l&&I.copy_to(l),f=i.update_iters((o-A)/o,f),d=!0))}return jsfeat.cache.put_buffer(b),jsfeat.cache.put_buffer(C),jsfeat.cache.put_buffer(T),d},lmeds:function(i,n,a,r,o,s,l,c){if("undefined"==typeof c&&(c=1e3),o<i.size)return!1;var u=i.size,f=c,h=0,d=!1,p=[],m=[],g=!1,v=s.cols,S=s.rows,y=s.type|jsfeat.C1_t,b=jsfeat.cache.get_buffer(v*S<<3),C=jsfeat.cache.get_buffer(o),T=jsfeat.cache.get_buffer(o<<2),w=new jsfeat.matrix_t(v,S,y,b.data),I=new jsfeat.matrix_t(o,1,jsfeat.U8_t|jsfeat.C1_t,C.data),x=0,A=0,E=T.f32,P=1e9,D=0,_=0;if(i.eps=.45,f=i.update_iters(i.eps,f),o==u){if(n.run(a,r,w,o)<=0)return jsfeat.cache.put_buffer(b),jsfeat.cache.put_buffer(C),jsfeat.cache.put_buffer(T),!1;if(w.copy_to(s),l)for(;--o>=0;)l.data[o]=1;return jsfeat.cache.put_buffer(b),jsfeat.cache.put_buffer(C),jsfeat.cache.put_buffer(T),!0}for(;h<f;++h){if(g=e(n,a,r,u,o,p,m),!g){if(0==h)return jsfeat.cache.put_buffer(b),jsfeat.cache.put_buffer(C),jsfeat.cache.put_buffer(T),!1;break}A=n.run(p,m,w,u),A<=0||(n.error(a,r,w,E,o),_=jsfeat.math.median(E,0,o-1),_<P&&(P=_,w.copy_to(s),d=!0))}return d&&(D=2.5*1.4826*(1+5/(o-u))*Math.sqrt(P),D=Math.max(D,.001),x=t(n,s,a,r,o,D,E,I.data),l&&I.copy_to(l),d=x>=u),jsfeat.cache.put_buffer(b),jsfeat.cache.put_buffer(C),jsfeat.cache.put_buffer(T),d}}}();e.ransac_params_t=i,e.motion_model=t,e.motion_estimator=n}(jsfeat),function(e){var t=function(){var e=function(e,t,i,n){for(var a=0,r=e.channel,o=e.cols,s=e.rows,l=e.data,c=t.data,u=o/i,f=s/n,h=u*f*65536|0,d=0,p=0,m=0,g=0,v=0,S=0,y=0,b=0,C=0,T=0,w=0,I=0,x=0,A=0,E=0,P=0,D=jsfeat.cache.get_buffer(i*r<<2),_=jsfeat.cache.get_buffer(i*r<<2),M=jsfeat.cache.get_buffer(2*o*3<<2),O=D.i32,L=_.i32,R=M.i32;d<i;d++){for(C=d*u,T=C+u,v=C+1-1e-6|0,S=0|T,v=Math.min(v,o-1),S=Math.min(S,o-1),v>C&&(R[b++]=d*r|0,R[b++]=(v-1)*r|0,R[b++]=256*(v-C)|0,a++),m=v;m<S;m++)a++,R[b++]=d*r|0,R[b++]=m*r|0,R[b++]=256;T-S>.001&&(a++,R[b++]=d*r|0,R[b++]=S*r|0,R[b++]=256*(T-S)|0)}for(d=0;d<i*r;d++)O[d]=L[d]=0;for(p=0,g=0;g<s;g++){for(w=o*g,b=0;b<a;b++)for(x=R[3*b],v=R[3*b+1],A=R[3*b+2],y=0;y<r;y++)O[x+y]+=l[w+v+y]*A;if((p+1)*f<=g+1||g==s-1){if(E=256*Math.max(g+1-(p+1)*f,0)|0,P=256-E,I=i*p,E<=0)for(d=0;d<i*r;d++)c[I+d]=Math.min(Math.max((L[d]+256*O[d])/h,0),255),L[d]=O[d]=0;else for(d=0;d<i*r;d++)c[I+d]=Math.min(Math.max((L[d]+O[d]*P)/h,0),255),L[d]=O[d]*E,O[d]=0;p++}else for(d=0;d<i*r;d++)L[d]+=256*O[d],O[d]=0}jsfeat.cache.put_buffer(_),jsfeat.cache.put_buffer(D),jsfeat.cache.put_buffer(M)},t=function(e,t,i,n){for(var a=0,r=e.channel,o=e.cols,s=e.rows,l=e.data,c=t.data,u=o/i,f=s/n,h=1/(u*f),d=0,p=0,m=0,g=0,v=0,S=0,y=0,b=0,C=0,T=0,w=0,I=0,x=0,A=0,E=0,P=0,D=jsfeat.cache.get_buffer(i*r<<2),_=jsfeat.cache.get_buffer(i*r<<2),M=jsfeat.cache.get_buffer(2*o*3<<2),O=D.f32,L=_.f32,R=M.f32;d<i;d++){for(C=d*u,T=C+u,v=C+1-1e-6|0,S=0|T,v=Math.min(v,o-1),S=Math.min(S,o-1),v>C&&(a++,R[b++]=(v-1)*r|0,R[b++]=d*r|0,R[b++]=(v-C)*h),m=v;m<S;m++)a++,R[b++]=m*r|0,R[b++]=d*r|0,R[b++]=h;T-S>.001&&(a++,R[b++]=S*r|0,R[b++]=d*r|0,R[b++]=(T-S)*h)}for(d=0;d<i*r;d++)O[d]=L[d]=0;for(p=0,g=0;g<s;g++){for(w=o*g,b=0;b<a;b++)for(v=0|R[3*b],x=0|R[3*b+1],A=R[3*b+2],y=0;y<r;y++)O[x+y]+=l[w+v+y]*A;if((p+1)*f<=g+1||g==s-1){if(E=Math.max(g+1-(p+1)*f,0),P=1-E,I=i*p,Math.abs(E)<.001)for(d=0;d<i*r;d++)c[I+d]=L[d]+O[d],L[d]=O[d]=0;else for(d=0;d<i*r;d++)c[I+d]=L[d]+O[d]*P,L[d]=O[d]*E,O[d]=0;p++}else for(d=0;d<i*r;d++)L[d]+=O[d],O[d]=0}jsfeat.cache.put_buffer(_),jsfeat.cache.put_buffer(D),jsfeat.cache.put_buffer(M)},i=function(e,t,i,n,a,r,o,s){for(var l=0,c=0,u=0,f=0,h=0,d=0,p=0,m=0,g=0,v=r[0],S=0,y=n<<1,b=3*n,C=n<<2;l<a;++l){for(d=t[f],c=0;c<s;++c)e[c]=d;for(c=0;c<=n-2;c+=2)e[c+s]=t[f+c],e[c+s+1]=t[f+c+1];for(;c<n;++c)e[c+s]=t[f+c];for(d=t[f+n-1],c=n;c<s+n;++c)e[c+s]=d;for(c=0;c<=n-4;c+=4){for(d=e[c]*v,p=e[c+1]*v,m=e[c+2]*v,g=e[c+3]*v,u=1;u<o;++u)S=r[u],d+=e[u+c]*S,p+=e[u+c+1]*S,m+=e[u+c+2]*S,g+=e[u+c+3]*S;i[h+c]=Math.min(d>>8,255),i[h+c+1]=Math.min(p>>8,255),i[h+c+2]=Math.min(m>>8,255),i[h+c+3]=Math.min(g>>8,255)}for(;c<n;++c){for(d=e[c]*v,u=1;u<o;++u)d+=e[u+c]*r[u];i[h+c]=Math.min(d>>8,255)}f+=n,h+=n}for(l=0;l<n;++l){for(d=i[l],c=0;c<s;++c)e[c]=d;for(u=l,c=0;c<=a-2;c+=2,u+=y)e[c+s]=i[u],e[c+s+1]=i[u+n];for(;c<a;++c,u+=n)e[c+s]=i[u];for(d=i[(a-1)*n+l],c=a;c<s+a;++c)e[c+s]=d;for(h=l,c=0;c<=a-4;c+=4,h+=C){for(d=e[c]*v,p=e[c+1]*v,m=e[c+2]*v,g=e[c+3]*v,u=1;u<o;++u)S=r[u],d+=e[u+c]*S,p+=e[u+c+1]*S,m+=e[u+c+2]*S,g+=e[u+c+3]*S;i[h]=Math.min(d>>8,255),i[h+n]=Math.min(p>>8,255),i[h+y]=Math.min(m>>8,255),i[h+b]=Math.min(g>>8,255)}for(;c<a;++c,h+=n){for(d=e[c]*v,u=1;u<o;++u)d+=e[u+c]*r[u];i[h]=Math.min(d>>8,255)}}},n=function(e,t,i,n,a,r,o,s){for(var l=0,c=0,u=0,f=0,h=0,d=0,p=0,m=0,g=0,v=r[0],S=0,y=n<<1,b=3*n,C=n<<2;l<a;++l){for(d=t[f],c=0;c<s;++c)e[c]=d;for(c=0;c<=n-2;c+=2)e[c+s]=t[f+c],e[c+s+1]=t[f+c+1];for(;c<n;++c)e[c+s]=t[f+c];for(d=t[f+n-1],c=n;c<s+n;++c)e[c+s]=d;for(c=0;c<=n-4;c+=4){for(d=e[c]*v,p=e[c+1]*v,m=e[c+2]*v,g=e[c+3]*v,u=1;u<o;++u)S=r[u],d+=e[u+c]*S,p+=e[u+c+1]*S,m+=e[u+c+2]*S,g+=e[u+c+3]*S;i[h+c]=d,i[h+c+1]=p,i[h+c+2]=m,i[h+c+3]=g}for(;c<n;++c){for(d=e[c]*v,u=1;u<o;++u)d+=e[u+c]*r[u];i[h+c]=d}f+=n,h+=n}for(l=0;l<n;++l){for(d=i[l],c=0;c<s;++c)e[c]=d;for(u=l,c=0;c<=a-2;c+=2,u+=y)e[c+s]=i[u],e[c+s+1]=i[u+n];for(;c<a;++c,u+=n)e[c+s]=i[u];for(d=i[(a-1)*n+l],c=a;c<s+a;++c)e[c+s]=d;for(h=l,c=0;c<=a-4;c+=4,h+=C){for(d=e[c]*v,p=e[c+1]*v,m=e[c+2]*v,g=e[c+3]*v,u=1;u<o;++u)S=r[u],d+=e[u+c]*S,p+=e[u+c+1]*S,m+=e[u+c+2]*S,g+=e[u+c+3]*S;i[h]=d,i[h+n]=p,i[h+y]=m,i[h+b]=g}for(;c<a;++c,h+=n){for(d=e[c]*v,u=1;u<o;++u)d+=e[u+c]*r[u];i[h]=d}}};return{grayscale:function(e,t,i,n,a){"undefined"==typeof a&&(a=jsfeat.COLOR_RGBA2GRAY);var r=0,o=0,s=0,l=0,c=0,u=0,f=4899,h=9617,d=1868,p=4;a!=jsfeat.COLOR_BGRA2GRAY&&a!=jsfeat.COLOR_BGR2GRAY||(f=1868,d=4899),a!=jsfeat.COLOR_RGB2GRAY&&a!=jsfeat.COLOR_BGR2GRAY||(p=3);var m=p<<1,g=3*p|0;n.resize(t,i,1);var v=n.data;for(o=0;o<i;++o,l+=t,s+=t*p){for(r=0,c=s,u=l;r<=t-4;r+=4,c+=p<<2,u+=4)v[u]=e[c]*f+e[c+1]*h+e[c+2]*d+8192>>14,v[u+1]=e[c+p]*f+e[c+p+1]*h+e[c+p+2]*d+8192>>14,v[u+2]=e[c+m]*f+e[c+m+1]*h+e[c+m+2]*d+8192>>14,v[u+3]=e[c+g]*f+e[c+g+1]*h+e[c+g+2]*d+8192>>14;for(;r<t;++r,++u,c+=p)v[u]=e[c]*f+e[c+1]*h+e[c+2]*d+8192>>14}},resample:function(i,n,a,r){var o=i.rows,s=i.cols;o>r&&s>a&&(n.resize(a,r,i.channel),i.type&jsfeat.U8_t&&n.type&jsfeat.U8_t&&o*s/(r*a)<256?e(i,n,a,r):t(i,n,a,r))},box_blur_gray:function(e,t,i,n){"undefined"==typeof n&&(n=0);var a=e.cols,r=e.rows,o=r<<1,s=a<<1,l=0,c=0,u=0,f=0,h=(i<<1)+1|0,d=i+1|0,p=d+1|0,m=n&jsfeat.BOX_BLUR_NOSCALE?1:1/(h*h),g=jsfeat.cache.get_buffer(a*r<<2),v=0,S=0,y=0,b=0,C=0,T=g.i32,w=e.data,I=0;for(t.resize(a,r,e.channel),u=0;u<r;++u){for(S=u,v=d*w[y],l=y+1|0,f=y+i|0;l<=f;++l)v+=w[l];for(b=y+d|0,C=y,I=w[C],c=0;c<i;++c,S+=r)T[S]=v,v+=w[b]-I,b++;for(;c<a-p;c+=2,S+=o)T[S]=v,v+=w[b]-w[C],T[S+r]=v,v+=w[b+1]-w[C+1],b+=2,C+=2;for(;c<a-d;++c,S+=r)T[S]=v,v+=w[b]-w[C],b++,C++;for(I=w[b-1];c<a;++c,S+=r)T[S]=v,v+=I-w[C],C++;y+=a}if(y=0,w=t.data,1==m)for(u=0;u<a;++u){for(S=u,v=d*T[y],l=y+1|0,f=y+i|0;l<=f;++l)v+=T[l];for(b=y+d,C=y,I=T[C],c=0;c<i;++c,S+=a)w[S]=v,v+=T[b]-I,b++;for(;c<r-p;c+=2,S+=s)w[S]=v,v+=T[b]-T[C],w[S+a]=v,v+=T[b+1]-T[C+1],b+=2,C+=2;for(;c<r-d;++c,S+=a)w[S]=v,v+=T[b]-T[C],b++,C++;for(I=T[b-1];c<r;++c,S+=a)w[S]=v,v+=I-T[C],C++;y+=r}else for(u=0;u<a;++u){for(S=u,v=d*T[y],l=y+1|0,f=y+i|0;l<=f;++l)v+=T[l];for(b=y+d,C=y,I=T[C],c=0;c<i;++c,S+=a)w[S]=v*m,v+=T[b]-I,b++;for(;c<r-p;c+=2,S+=s)w[S]=v*m,v+=T[b]-T[C],w[S+a]=v*m,v+=T[b+1]-T[C+1],b+=2,C+=2;for(;c<r-d;++c,S+=a)w[S]=v*m,v+=T[b]-T[C],b++,C++;for(I=T[b-1];c<r;++c,S+=a)w[S]=v*m,v+=I-T[C],C++;y+=r}jsfeat.cache.put_buffer(g)},gaussian_blur:function(e,t,a,r){"undefined"==typeof r&&(r=0),"undefined"==typeof a&&(a=0),a=0==a?2*Math.max(1,4*r+1-1e-8)+1|0:a;var o=a>>1,s=e.cols,l=e.rows,c=e.type,u=c&jsfeat.U8_t;t.resize(s,l,e.channel);var f,h,d=e.data,p=t.data,m=a+Math.max(l,s)|0,g=jsfeat.cache.get_buffer(m<<2),v=jsfeat.cache.get_buffer(a<<2);u?(f=g.i32,h=v.i32):c&jsfeat.S32_t?(f=g.i32,h=v.f32):(f=g.f32,h=v.f32),jsfeat.math.get_gaussian_kernel(a,r,h,c),u?i(f,d,p,s,l,h,a,o):n(f,d,p,s,l,h,a,o),jsfeat.cache.put_buffer(g),jsfeat.cache.put_buffer(v)},pyrdown:function(e,t,i,n){"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0);var a=e.cols,r=e.rows,o=a>>1,s=r>>1,l=o-(i<<1),c=s-(n<<1),u=0,f=0,h=i+n*a,d=0,p=0,m=0;t.resize(o,s,e.channel);var g=e.data,v=t.data;for(f=0;f<c;++f){for(d=h,m=p,u=0;u<=l-2;u+=2,m+=2,d+=4)v[m]=g[d]+g[d+1]+g[d+a]+g[d+a+1]+2>>2,v[m+1]=g[d+2]+g[d+3]+g[d+a+2]+g[d+a+3]+2>>2;for(;u<l;++u,++m,d+=2)v[m]=g[d]+g[d+1]+g[d+a]+g[d+a+1]+2>>2;h+=a<<1,p+=o}},scharr_derivatives:function(e,t){var i,n,a,r,o,s,l,c,u=e.cols,f=e.rows,h=u<<1,d=0,p=0,m=0,g=0,v=0,S=0,y=0;t.resize(u,f,2);var b=e.data,C=t.data,T=jsfeat.cache.get_buffer(u+2<<2),w=jsfeat.cache.get_buffer(u+2<<2);for(e.type&jsfeat.U8_t||e.type&jsfeat.S32_t?(l=T.i32,c=w.i32):(l=T.f32,c=w.f32);p<f;++p,v+=u){for(g=(p>0?p-1:1)*u|0,S=(p<f-1?p+1:f-2)*u|0,y=p*h|0,d=0,m=1;d<=u-2;d+=2,
m+=2)i=b[g+d],n=b[S+d],l[m]=3*(i+n)+10*b[v+d],c[m]=n-i,i=b[g+d+1],n=b[S+d+1],l[m+1]=3*(i+n)+10*b[v+d+1],c[m+1]=n-i;for(;d<u;++d,++m)i=b[g+d],n=b[S+d],l[m]=3*(i+n)+10*b[v+d],c[m]=n-i;for(d=u+1|0,l[0]=l[1],l[d]=l[u],c[0]=c[1],c[d]=c[u],d=0;d<=u-4;d+=4)i=c[d+2],n=c[d+1],a=c[d+3],r=c[d+4],o=l[d+2],s=l[d+3],C[y++]=o-l[d],C[y++]=3*(i+c[d])+10*n,C[y++]=s-l[d+1],C[y++]=3*(a+n)+10*i,C[y++]=l[d+4]-o,C[y++]=3*(r+i)+10*a,C[y++]=l[d+5]-s,C[y++]=3*(c[d+5]+a)+10*r;for(;d<u;++d)C[y++]=l[d+2]-l[d],C[y++]=3*(c[d+2]+c[d])+10*c[d+1]}jsfeat.cache.put_buffer(T),jsfeat.cache.put_buffer(w)},sobel_derivatives:function(e,t){var i,n,a,r,o,s,l,c,u=e.cols,f=e.rows,h=u<<1,d=0,p=0,m=0,g=0,v=0,S=0,y=0;t.resize(u,f,2);var b=e.data,C=t.data,T=jsfeat.cache.get_buffer(u+2<<2),w=jsfeat.cache.get_buffer(u+2<<2);for(e.type&jsfeat.U8_t||e.type&jsfeat.S32_t?(l=T.i32,c=w.i32):(l=T.f32,c=w.f32);p<f;++p,v+=u){for(g=(p>0?p-1:1)*u|0,S=(p<f-1?p+1:f-2)*u|0,y=p*h|0,d=0,m=1;d<=u-2;d+=2,m+=2)i=b[g+d],n=b[S+d],l[m]=i+n+2*b[v+d],c[m]=n-i,i=b[g+d+1],n=b[S+d+1],l[m+1]=i+n+2*b[v+d+1],c[m+1]=n-i;for(;d<u;++d,++m)i=b[g+d],n=b[S+d],l[m]=i+n+2*b[v+d],c[m]=n-i;for(d=u+1|0,l[0]=l[1],l[d]=l[u],c[0]=c[1],c[d]=c[u],d=0;d<=u-4;d+=4)i=c[d+2],n=c[d+1],a=c[d+3],r=c[d+4],o=l[d+2],s=l[d+3],C[y++]=o-l[d],C[y++]=i+c[d]+2*n,C[y++]=s-l[d+1],C[y++]=a+n+2*i,C[y++]=l[d+4]-o,C[y++]=r+i+2*a,C[y++]=l[d+5]-s,C[y++]=c[d+5]+a+2*r;for(;d<u;++d)C[y++]=l[d+2]-l[d],C[y++]=c[d+2]+c[d]+2*c[d+1]}jsfeat.cache.put_buffer(T),jsfeat.cache.put_buffer(w)},compute_integral_image:function(e,t,i,n){var a=0|e.cols,r=0|e.rows,o=e.data,s=a+1|0,l=0,c=0,u=0,f=0,h=0,d=0,p=0,m=0;if(t&&i){for(;h<s;++h)t[h]=0,i[h]=0;for(u=s+1|0,f=1,h=0,m=0;h<r;++h,++u,++f){for(l=c=0,d=0;d<=a-2;d+=2,m+=2,u+=2,f+=2)p=o[m],l+=p,c+=p*p,t[u]=t[f]+l,i[u]=i[f]+c,p=o[m+1],l+=p,c+=p*p,t[u+1]=t[f+1]+l,i[u+1]=i[f+1]+c;for(;d<a;++d,++m,++u,++f)p=o[m],l+=p,c+=p*p,t[u]=t[f]+l,i[u]=i[f]+c}}else if(t){for(;h<s;++h)t[h]=0;for(u=s+1|0,f=1,h=0,m=0;h<r;++h,++u,++f){for(l=0,d=0;d<=a-2;d+=2,m+=2,u+=2,f+=2)l+=o[m],t[u]=t[f]+l,l+=o[m+1],t[u+1]=t[f+1]+l;for(;d<a;++d,++m,++u,++f)l+=o[m],t[u]=t[f]+l}}else if(i){for(;h<s;++h)i[h]=0;for(u=s+1|0,f=1,h=0,m=0;h<r;++h,++u,++f){for(c=0,d=0;d<=a-2;d+=2,m+=2,u+=2,f+=2)p=o[m],c+=p*p,i[u]=i[f]+c,p=o[m+1],c+=p*p,i[u+1]=i[f+1]+c;for(;d<a;++d,++m,++u,++f)p=o[m],c+=p*p,i[u]=i[f]+c}}if(n){for(h=0;h<s;++h)n[h]=0;for(u=s+1|0,f=0,h=0,m=0;h<r;++h,++u,++f){for(d=0;d<=a-2;d+=2,m+=2,u+=2,f+=2)n[u]=o[m]+n[f],n[u+1]=o[m+1]+n[f+1];for(;d<a;++d,++m,++u,++f)n[u]=o[m]+n[f]}for(u=s+a|0,f=a,h=0;h<r;++h,u+=s,f+=s)n[u]+=n[f];for(d=a-1;d>0;--d)for(u=d+r*s,f=u-s,h=r;h>0;--h,u-=s,f-=s)n[u]+=n[f]+n[f+1]}},equalize_histogram:function(e,t){var i=e.cols,n=e.rows,a=e.data;t.resize(i,n,e.channel);var r,o,s=t.data,l=i*n,c=0,u=0,f=jsfeat.cache.get_buffer(1024);for(r=f.i32;c<256;++c)r[c]=0;for(c=0;c<l;++c)++r[a[c]];for(u=r[0],c=1;c<256;++c)u=r[c]+=u;for(o=255/l,c=0;c<l;++c)s[c]=r[a[c]]*o+.5|0;jsfeat.cache.put_buffer(f)},canny:function(e,t,i,n){var a=e.cols,r=e.rows;e.data;t.resize(a,r,e.channel);var o=t.data,s=0,l=0,c=0,u=a<<1,f=0,h=0,d=0,p=0,m=0,g=0,v=0,S=0,y=jsfeat.cache.get_buffer(r*u<<2),b=jsfeat.cache.get_buffer(3*(a+2)<<2),C=jsfeat.cache.get_buffer((r+2)*(a+2)<<2),T=jsfeat.cache.get_buffer(r*a<<2),w=b.i32,I=C.i32,x=T.i32,A=y.i32,E=new jsfeat.matrix_t(a,r,jsfeat.S32C2_t,y.data),P=1,D=a+2+1|0,_=2*(a+2)+1|0,M=a+2|0,O=M+1|0,L=0;for(this.sobel_derivatives(e,E),i>n&&(s=i,i=n,n=s),s=3*(a+2)|0;--s>=0;)w[s]=0;for(s=(r+2)*(a+2)|0;--s>=0;)I[s]=0;for(;l<a;++l,c+=2)p=A[c],m=A[c+1],w[D+l]=(p^p>>31)-(p>>31)+((m^m>>31)-(m>>31));for(s=1;s<=r;++s,c+=u){if(s==r)for(l=_+a;--l>=_;)w[l]=0;else for(l=0;l<a;l++)p=A[c+(l<<1)],m=A[c+(l<<1)+1],w[_+l]=(p^p>>31)-(p>>31)+((m^m>>31)-(m>>31));for(f=c-u|0,I[O-1]=0,h=0,l=0;l<a;++l,f+=2){if(d=w[D+l],d>i)if(p=A[f],m=A[f+1],g=p^m,p=(p^p>>31)-(p>>31)|0,m=(m^m>>31)-(m>>31)|0,v=13573*p,S=v+(p+p<<15),m<<=15,m<v){if(d>w[D+l-1]&&d>=w[D+l+1]){d>n&&!h&&2!=I[O+l-M]?(I[O+l]=2,h=1,x[L++]=O+l):I[O+l]=1;continue}}else if(m>S){if(d>w[P+l]&&d>=w[_+l]){d>n&&!h&&2!=I[O+l-M]?(I[O+l]=2,h=1,x[L++]=O+l):I[O+l]=1;continue}}else if(g=g<0?-1:1,d>w[P+l-g]&&d>w[_+l+g]){d>n&&!h&&2!=I[O+l-M]?(I[O+l]=2,h=1,x[L++]=O+l):I[O+l]=1;continue}I[O+l]=0,h=0}I[O+a]=0,O+=M,l=P,P=D,D=_,_=l}for(l=O-M-1,s=0;s<M;++s,++l)I[l]=0;for(;L>0;)O=x[--L],O-=M+1,1==I[O]&&(I[O]=2,x[L++]=O),O+=1,1==I[O]&&(I[O]=2,x[L++]=O),O+=1,1==I[O]&&(I[O]=2,x[L++]=O),O+=M,1==I[O]&&(I[O]=2,x[L++]=O),O-=2,1==I[O]&&(I[O]=2,x[L++]=O),O+=M,1==I[O]&&(I[O]=2,x[L++]=O),O+=1,1==I[O]&&(I[O]=2,x[L++]=O),O+=1,1==I[O]&&(I[O]=2,x[L++]=O);for(O=M+1,P=0,s=0;s<r;++s,O+=M)for(l=0;l<a;++l)o[P++]=255*(2==I[O+l]);jsfeat.cache.put_buffer(y),jsfeat.cache.put_buffer(b),jsfeat.cache.put_buffer(C),jsfeat.cache.put_buffer(T)},warp_perspective:function(e,t,i,n){"undefined"==typeof n&&(n=0);for(var a=0|e.cols,r=0|e.rows,o=0|t.cols,s=0|t.rows,l=e.data,c=t.data,u=0,f=0,h=0,d=0,p=0,m=0,g=0,v=0,S=0,y=0,b=0,C=0,T=0,w=0,I=0,x=i.data,A=x[0],E=x[1],P=x[2],D=x[3],_=x[4],M=x[5],O=x[6],L=x[7],R=x[8],k=0;f<s;++f)for(v=E*f+P,S=_*f+M,y=L*f+R,u=0;u<o;++u,++k,v+=A,S+=D,y+=O)b=1/y,m=v*b,g=S*b,d=0|m,p=0|g,m>0&&g>0&&d<a-1&&p<r-1?(C=Math.max(m-d,0),T=Math.max(g-p,0),h=a*p+d|0,w=l[h]+C*(l[h+1]-l[h]),I=l[h+a]+C*(l[h+a+1]-l[h+a]),c[k]=w+T*(I-w)):c[k]=n},warp_affine:function(e,t,i,n){"undefined"==typeof n&&(n=0);for(var a=e.cols,r=e.rows,o=t.cols,s=t.rows,l=e.data,c=t.data,u=0,f=0,h=0,d=0,p=0,m=0,g=0,v=0,S=0,y=0,b=0,C=i.data,T=C[0],w=C[1],I=C[2],x=C[3],A=C[4],E=C[5],P=0;f<s;++f)for(m=w*f+I,g=A*f+E,u=0;u<o;++u,++P,m+=T,g+=x)d=0|m,p=0|g,d>=0&&p>=0&&d<a-1&&p<r-1?(v=m-d,S=g-p,h=a*p+d,y=l[h]+v*(l[h+1]-l[h]),b=l[h+a]+v*(l[h+a+1]-l[h+a]),c[P]=y+S*(b-y)):c[P]=n},skindetector:function(e,t){for(var i,n,a,r,o=e.width*e.height;o--;)r=4*o,i=e.data[r],n=e.data[r+1],a=e.data[r+2],i>95&&n>40&&a>20&&i>n&&i>a&&i-Math.min(n,a)>15&&Math.abs(i-n)>15?t[o]=255:t[o]=0}}}();e.imgproc=t}(jsfeat),function(e){var t=function(){var e=new Int32Array([0,3,1,3,2,2,3,1,3,0,3,-1,2,-2,1,-3,0,-3,-1,-3,-2,-2,-3,-1,-3,0,-3,1,-2,2,-1,3]),t=new Uint8Array(512),i=new Int32Array(25),n=new Int32Array(25),a=function(t,i,n){for(var a=0,r=e;a<n;++a)t[a]=r[a<<1]+r[(a<<1)+1]*i;for(;a<25;++a)t[a]=t[a-n]},r=function(e,t,i,n,a){for(var r=25,o=0,s=e[t],l=a,c=0,u=0,f=0;o<r;++o)n[o]=s-e[t+i[o]];for(o=0;o<16;o+=2)c=Math.min(n[o+1],n[o+2]),c=Math.min(c,n[o+3]),c<=l||(c=Math.min(c,n[o+4]),c=Math.min(c,n[o+5]),c=Math.min(c,n[o+6]),c=Math.min(c,n[o+7]),c=Math.min(c,n[o+8]),l=Math.max(l,Math.min(c,n[o])),l=Math.max(l,Math.min(c,n[o+9])));for(u=-l,o=0;o<16;o+=2)f=Math.max(n[o+1],n[o+2]),f=Math.max(f,n[o+3]),f=Math.max(f,n[o+4]),f=Math.max(f,n[o+5]),f>=u||(f=Math.max(f,n[o+6]),f=Math.max(f,n[o+7]),f=Math.max(f,n[o+8]),u=Math.min(u,Math.max(f,n[o])),u=Math.min(u,Math.max(f,n[o+9])));return-u-1},o=20;return{set_threshold:function(e){o=Math.min(Math.max(e,0),255);for(var i=-255;i<=255;++i)t[i+255]=i<-o?1:i>o?2:0;return o},detect:function(e,s,l){"undefined"==typeof l&&(l=3);var c,u=8,f=25,h=e.data,d=e.cols,p=e.rows,m=0,g=0,v=0,S=0,y=0,b=0,C=jsfeat.cache.get_buffer(3*d),T=jsfeat.cache.get_buffer(3*(d+1)<<2),w=C.u8,I=T.i32,x=i,A=n,E=Math.max(3,l),P=Math.min(p-2,p-l),D=Math.max(3,l),_=Math.min(d-3,d-l),M=0,O=0,L=r,R=t,k=o,F=0,U=0,G=0,N=0,j=0,B=0,H=0,V=0,K=0,W=0,z=0,q=0;a(x,d,16);var X=x[0],Y=x[1],Z=x[2],J=x[3],Q=x[4],$=x[5],ee=x[6],te=x[7],ie=x[8],ne=x[9],ae=x[10],re=x[11],oe=x[12],se=x[13],le=x[14],ce=x[15];for(m=0;m<3*d;++m)w[m]=0;for(m=E;m<P;++m){for(H=m*d+D|0,b=(m-3)%3,B=b*d|0,j=b*(d+1)|0,g=0;g<d;++g)w[B+g]=0;if(N=0,m<P-1)for(g=D;g<_;++g,++H)if(F=h[H],U=-F+255,G=R[U+h[H+X]]|R[U+h[H+ie]],0!=G&&(G&=R[U+h[H+Z]]|R[U+h[H+ae]],G&=R[U+h[H+Q]]|R[U+h[H+oe]],G&=R[U+h[H+ee]]|R[U+h[H+le]],0!=G)){if(G&=R[U+h[H+Y]]|R[U+h[H+ne]],G&=R[U+h[H+J]]|R[U+h[H+re]],G&=R[U+h[H+$]]|R[U+h[H+se]],G&=R[U+h[H+te]]|R[U+h[H+ce]],1&G)for(S=F-k,M=0,v=0;v<f;++v)if(y=h[H+x[v]],y<S){if(++M,M>u){++N,I[j+N]=g,w[B+g]=L(h,H,x,A,k);break}}else M=0;if(2&G)for(S=F+k,M=0,v=0;v<f;++v)if(y=h[H+x[v]],y>S){if(++M,M>u){++N,I[j+N]=g,w[B+g]=L(h,H,x,A,k);break}}else M=0}if(I[j+d]=N,m!=E)for(b=(m-4+3)%3,V=b*d|0,j=b*(d+1)|0,b=(m-5+3)%3,K=b*d|0,N=I[j+d],v=0;v<N;++v)g=I[j+v],W=g+1|0,z=g-1|0,q=w[V+g],q>w[V+W]&&q>w[V+z]&&q>w[K+z]&&q>w[K+g]&&q>w[K+W]&&q>w[B+z]&&q>w[B+g]&&q>w[B+W]&&(c=s[O],c.x=g,c.y=m-1,c.score=q,O++)}return jsfeat.cache.put_buffer(C),jsfeat.cache.put_buffer(T),O}}}();e.fast_corners=t,t.set_threshold(20)}(jsfeat),function(e){var t=function(){var e=function(e,t,i,n,a,r,o,s,l,c){var u=0,f=0,h=s*i+o|0,d=h;for(u=s;u<c;++u,h+=i,d=h)for(f=o;f<l;++f,++d)t[d]=-4*e[d]+e[d+a]+e[d-a]+e[d+r]+e[d-r]},t=function(e,t,i,n,a,r,o){var s=-2*e[t]+e[t+n]+e[t-n],l=-2*e[t]+e[t+a]+e[t-a],c=e[t+r]+e[t-r]-e[t+o]-e[t-o],u=0|Math.sqrt((s-l)*(s-l)+4*c*c);return Math.min(Math.abs(i-u),Math.abs(-(i+u)))};return{laplacian_threshold:30,min_eigen_value_threshold:25,detect:function(i,n,a){"undefined"==typeof a&&(a=5);var r,o=0,s=0,l=i.cols,c=i.rows,u=i.data,f=5,h=5*l|0,d=3+3*l|0,p=3-3*l|0,m=jsfeat.cache.get_buffer(l*c<<2),g=m.i32,v=0,S=0,y=0,b=0,C=0,T=this.laplacian_threshold,w=this.min_eigen_value_threshold,I=0|Math.max(5,a),x=0|Math.max(3,a),A=0|Math.min(l-5,l-a),E=0|Math.min(c-3,c-a);for(o=l*c;--o>=0;)g[o]=0;for(e(u,g,l,c,f,h,I,x,A,E),S=x*l+I|0,s=x;s<E;++s,S+=l)for(o=I,y=S;o<A;++o,++y)v=g[y],(v<-T&&v<g[y-1]&&v<g[y+1]&&v<g[y-l]&&v<g[y+l]&&v<g[y-l-1]&&v<g[y+l-1]&&v<g[y-l+1]&&v<g[y+l+1]||v>T&&v>g[y-1]&&v>g[y+1]&&v>g[y-l]&&v>g[y+l]&&v>g[y-l-1]&&v>g[y+l-1]&&v>g[y-l+1]&&v>g[y+l+1])&&(b=t(u,y,v,f,h,d,p),b>w&&(r=n[C],r.x=o,r.y=s,r.score=b,++C,++o,++y));return jsfeat.cache.put_buffer(m),C}}}();e.yape06=t}(jsfeat),function(e){var t=function(){var e=function(e,t,i){var n,a,r=0;for(n=i,a=0;a<n;a++,r++)n=Math.sqrt(i*i-a*a)+.5|0,t[r]=n+e*a;for(n--;n<a&&n>=0;n--,r++)a=Math.sqrt(i*i-n*n)+.5|0,t[r]=n+e*a;for(;-n<a;n--,r++)a=Math.sqrt(i*i-n*n)+.5|0,t[r]=n+e*a;for(a--;a>=0;a--,r++)n=-Math.sqrt(i*i-a*a)-.5|0,t[r]=n+e*a;for(;a>n;a--,r++)n=-Math.sqrt(i*i-a*a)-.5|0,t[r]=n+e*a;for(n++;n<=0;n++,r++)a=-Math.sqrt(i*i-n*n)-.5|0,t[r]=n+e*a;for(;n<-a;n++,r++)a=-Math.sqrt(i*i-n*n)-.5|0,t[r]=n+e*a;for(a++;a<0;a++,r++)n=Math.sqrt(i*i-a*a)+.5|0,t[r]=n+e*a;return t[r]=t[0],t[r+1]=t[1],r},t=function(e,t,i){var n=0;return 0!=e[t+1]&&n++,0!=e[t-1]&&n++,0!=e[t+i]&&n++,0!=e[t+i+1]&&n++,0!=e[t+i-1]&&n++,0!=e[t-i]&&n++,0!=e[t-i+1]&&n++,0!=e[t-i-1]&&n++,n},i=function(e,t,i,n,a){var r,o;if(i>0)for(t-=n*a,o=-a;o<=a;++o){for(r=-a;r<=a;++r)if(e[t+r]>i)return!1;t+=n}else for(t-=n*a,o=-a;o<=a;++o){for(r=-a;r<=a;++r)if(e[t+r]<i)return!1;t+=n}return!0},n=function(e,t,i,n,a,r,o,s){var l=0,c=0,u=o-1|0,f=0,h=0,d=0,p=0,m=0;if(f=e[t+r[c]],f<=a)if(f>=n)if(h=e[t+r[u]],h<=a){if(h>=n)return void(i[t]=0);if(u++,d=e[t+r[u]],d>a)if(u++,p=e[t+r[u]],p>a)m=3;else{if(!(p<n))return void(i[t]=0);m=6}else if(u++,p=e[t+r[u]],p>a)m=7;else{if(!(p<n))return void(i[t]=0);m=2}}else if(u++,d=e[t+r[u]],d>a)if(u++,p=e[t+r[u]],p>a)m=3;else{if(!(p<n))return void(i[t]=0);m=6}else{if(!(d<n))return void(i[t]=0);if(u++,p=e[t+r[u]],p>a)m=7;else{if(!(p<n))return void(i[t]=0);m=2}}else{if(h=e[t+r[u]],h>a)return void(i[t]=0);if(u++,d=e[t+r[u]],d>a)return void(i[t]=0);if(u++,p=e[t+r[u]],p>a)return void(i[t]=0);m=1}else{if(h=e[t+r[u]],h<n)return void(i[t]=0);if(u++,d=e[t+r[u]],d<n)return void(i[t]=0);if(u++,p=e[t+r[u]],p<n)return void(i[t]=0);m=0}for(c=1;c<=o;c++)switch(f=e[t+r[c]],m){case 0:if(f>a){if(d=p,u++,p=e[t+r[u]],p<n)return void(i[t]=0);l-=f+d,m=0;break}if(f<n){if(d>a)return void(i[t]=0);if(p>a)return void(i[t]=0);if(d=p,u++,p=e[t+r[u]],p>a)return void(i[t]=0);l-=f+d,m=8;break}if(d<=a)return void(i[t]=0);if(p<=a)return void(i[t]=0);if(d=p,u++,p=e[t+r[u]],p>a){l-=f+d,m=3;break}if(p<n){l-=f+d,m=6;break}return void(i[t]=0);case 1:if(f<n){if(d=p,u++,p=e[t+r[u]],p>a)return void(i[t]=0);l-=f+d,m=1;break}if(f>a){if(d<n)return void(i[t]=0);if(p<n)return void(i[t]=0);if(d=p,u++,p=e[t+r[u]],p<n)return void(i[t]=0);l-=f+d,m=9;break}if(d>=n)return void(i[t]=0);if(p>=n)return void(i[t]=0);if(d=p,u++,p=e[t+r[u]],p<n){l-=f+d,m=2;break}if(p>a){l-=f+d,m=7;break}return void(i[t]=0);case 2:if(f>a)return void(i[t]=0);if(d=p,u++,p=e[t+r[u]],f<n){if(p>a)return void(i[t]=0);l-=f+d,m=4;break}if(p>a){l-=f+d,m=7;break}if(p<n){l-=f+d,m=2;break}return void(i[t]=0);case 3:if(f<n)return void(i[t]=0);if(d=p,u++,p=e[t+r[u]],f>a){if(p<n)return void(i[t]=0);l-=f+d,m=5;break}if(p>a){l-=f+d,m=3;break}if(p<n){l-=f+d,m=6;break}return void(i[t]=0);case 4:if(f>a)return void(i[t]=0);if(f<n){if(d=p,u++,p=e[t+r[u]],p>a)return void(i[t]=0);l-=f+d,m=1;break}if(p>=n)return void(i[t]=0);if(d=p,u++,p=e[t+r[u]],p<n){l-=f+d,m=2;break}if(p>a){l-=f+d,m=7;break}return void(i[t]=0);case 5:if(f<n)return void(i[t]=0);if(f>a){if(d=p,u++,p=e[t+r[u]],p<n)return void(i[t]=0);l-=f+d,m=0;break}if(p<=a)return void(i[t]=0);if(d=p,u++,p=e[t+r[u]],p>a){l-=f+d,m=3;break}if(p<n){l-=f+d,m=6;break}return void(i[t]=0);case 7:if(f>a)return void(i[t]=0);if(f<n)return void(i[t]=0);if(d=p,u++,p=e[t+r[u]],p>a){l-=f+d,m=3;break}if(p<n){l-=f+d,m=6;break}return void(i[t]=0);case 6:if(f>a)return void(i[t]=0);if(f<n)return void(i[t]=0);if(d=p,u++,p=e[t+r[u]],p<n){l-=f+d,m=2;break}if(p>a){l-=f+d,m=7;break}return void(i[t]=0);case 8:if(f>a){if(p<n)return void(i[t]=0);if(d=p,u++,p=e[t+r[u]],p<n)return void(i[t]=0);l-=f+d,m=9;break}if(f<n){if(d=p,u++,p=e[t+r[u]],p>a)return void(i[t]=0);l-=f+d,m=1;break}return void(i[t]=0);case 9:if(f<n){if(p>a)return void(i[t]=0);if(d=p,u++,p=e[t+r[u]],p>a)return void(i[t]=0);l-=f+d,m=8;break}if(f>a){if(d=p,u++,p=e[t+r[u]],p<n)return void(i[t]=0);l-=f+d,m=0;break}return void(i[t]=0)}i[t]=l+s*e[t]},a=function(){function t(t,i,n){this.dirs=new Int32Array(1024),this.dirs_count=0|e(t,this.dirs,n),this.scores=new Int32Array(t*i),this.radius=0|n}return t}();return{level_tables:[],tau:7,init:function(e,t,i,n){"undefined"==typeof n&&(n=1);var r;for(i=Math.min(i,7),i=Math.max(i,3),r=0;r<n;++r)this.level_tables[r]=new a(e>>r,t>>r,i)},detect:function(e,a,r){"undefined"==typeof r&&(r=4);var o,s=this.level_tables[0],l=0|s.radius,c=l-1|0,u=s.dirs,f=0|s.dirs_count,h=f>>1,d=e.data,p=0|e.cols,m=0|e.rows,g=p>>1,v=s.scores,S=0,y=0,b=0,C=0,T=0,w=0,I=0,x=0,A=0|this.tau,E=0,P=0|Math.max(l+1,r),D=0|Math.max(l+1,r),_=0|Math.min(p-l-2,p-r),M=0|Math.min(m-l-2,m-r);for(b=D*p+P|0,y=D;y<M;++y,b+=p)for(S=P,C=b;S<_;++S,++C)T=d[C]+A,w=d[C]-A,w<d[C+l]&&d[C+l]<T&&w<d[C-l]&&d[C-l]<T?v[C]=0:n(d,C,v,w,T,u,h,f);for(b=D*p+P|0,y=D;y<M;++y,b+=p)for(S=P,C=b;S<_;++S,++C)x=v[C],I=Math.abs(x),I<5?(++S,++C):t(v,C,p)>=3&&i(v,C,x,g,l)&&(o=a[E],o.x=S,o.y=y,o.score=I,++E,S+=c,C+=c);return E}}}();e.yape=t}(jsfeat),function(e){var t=function(){var e=new Int32Array([8,-3,9,5,4,2,7,-12,-11,9,-8,2,7,-12,12,-13,2,-13,2,12,1,-7,1,6,-2,-10,-2,-4,-13,-13,-11,-8,-13,-3,-12,-9,10,4,11,9,-13,-8,-8,-9,-11,7,-9,12,7,7,12,6,-4,-5,-3,0,-13,2,-12,-3,-9,0,-7,5,12,-6,12,-1,-3,6,-2,12,-6,-13,-4,-8,11,-13,12,-8,4,7,5,1,5,-3,10,-3,3,-7,6,12,-8,-7,-6,-2,-2,11,-1,-10,-13,12,-8,10,-7,3,-5,-3,-4,2,-3,7,-10,-12,-6,11,5,-12,6,-7,5,-6,7,-1,1,0,4,-5,9,11,11,-13,4,7,4,12,2,-1,4,4,-4,-12,-2,7,-8,-5,-7,-10,4,11,9,12,0,-8,1,-13,-13,-2,-8,2,-3,-2,-2,3,-6,9,-4,-9,8,12,10,7,0,9,1,3,7,-5,11,-10,-13,-6,-11,0,10,7,12,1,-6,-3,-6,12,10,-9,12,-4,-13,8,-8,-12,-13,0,-8,-4,3,3,7,8,5,7,10,-7,-1,7,1,-12,3,-10,5,6,2,-4,3,-10,-13,0,-13,5,-13,-7,-12,12,-13,3,-11,8,-7,12,-4,7,6,-10,12,8,-9,-1,-7,-6,-2,-5,0,12,-12,5,-7,5,3,-10,8,-13,-7,-7,-4,5,-3,-2,-1,-7,2,9,5,-11,-11,-13,-5,-13,-1,6,0,-1,5,-3,5,2,-4,-13,-4,12,-9,-6,-9,6,-12,-10,-8,-4,10,2,12,-3,7,12,12,12,-7,-13,-6,5,-4,9,-3,4,7,-1,12,2,-7,6,-5,1,-13,11,-12,5,-3,7,-2,-6,7,-8,12,-7,-13,-7,-11,-12,1,-3,12,12,2,-6,3,0,-4,3,-2,-13,-1,-13,1,9,7,1,8,-6,1,-1,3,12,9,1,12,6,-1,-9,-1,3,-13,-13,-10,5,7,7,10,12,12,-5,12,9,6,3,7,11,5,-13,6,10,2,-12,2,3,3,8,4,-6,2,6,12,-13,9,-12,10,3,-8,4,-7,9,-11,12,-4,-6,1,12,2,-8,6,-9,7,-4,2,3,3,-2,6,3,11,0,3,-3,8,-8,7,8,9,3,-11,-5,-6,-4,-10,11,-5,10,-5,-8,-3,12,-10,5,-9,0,8,-1,12,-6,4,-6,6,-11,-10,12,-8,7,4,-2,6,7,-2,0,-2,12,-5,-8,-5,2,7,-6,10,12,-9,-13,-8,-8,-5,-13,-5,-2,8,-8,9,-13,-9,-11,-9,0,1,-8,1,-2,7,-4,9,1,-2,1,-1,-4,11,-6,12,-11,-12,-9,-6,4,3,7,7,12,5,5,10,8,0,-4,2,8,-9,12,-5,-13,0,7,2,12,-1,2,1,7,5,11,7,-9,3,5,6,-8,-13,-4,-8,9,-5,9,-3,-3,-4,-7,-3,-12,6,5,8,0,-7,6,-6,12,-13,6,-5,-2,1,-10,3,10,4,1,8,-4,-2,-2,2,-13,2,-12,12,12,-2,-13,0,-6,4,1,9,3,-6,-10,-3,-5,-3,-13,-1,1,7,5,12,-11,4,-2,5,-7,-13,9,-9,-5,7,1,8,6,7,-8,7,6,-7,-4,-7,1,-8,11,-7,-8,-13,6,-12,-8,2,4,3,9,10,-5,12,3,-6,-5,-6,7,8,-3,9,-8,2,-12,2,8,-11,-2,-10,3,-12,-13,-7,-9,-11,0,-10,-5,5,-3,11,8,-2,-13,-1,12,-1,-8,0,9,-13,-11,-12,-5,-10,-2,-10,11,-3,9,-2,-13,2,-3,3,2,-9,-13,-4,0,-4,6,-3,-10,-4,12,-2,-7,-6,-11,-4,9,6,-3,6,11,-13,11,-5,5,11,11,12,6,7,-5,12,-2,-1,12,0,7,-4,-8,-3,-2,-7,1,-6,7,-13,-12,-8,-13,-7,-2,-6,-8,-8,5,-6,-9,-5,-1,-4,5,-13,7,-8,10,1,5,5,-13,1,0,10,-13,9,12,10,-1,5,-8,10,-9,-1,11,1,-13,-9,-3,-6,2,-1,-10,1,12,-13,1,-8,-10,8,-11,10,-6,2,-13,3,-6,7,-13,12,-9,-10,-10,-5,-7,-10,-8,-8,-13,4,-6,8,5,3,12,8,-13,-4,2,-3,-3,5,-13,10,-12,4,-13,5,-1,-9,9,-4,3,0,3,3,-9,-12,1,-6,1,3,2,4,-8,-10,-10,-10,9,8,-13,12,12,-8,-12,-6,-5,2,2,3,7,10,6,11,-8,6,8,8,-12,-7,10,-6,5,-3,-9,-3,9,-1,-13,-1,5,-3,-7,-3,4,-8,-2,-8,3,4,2,12,12,2,-5,3,11,6,-9,11,-13,3,-1,7,12,11,-1,12,4,-3,0,-3,6,4,-11,4,12,2,-4,2,1,-10,-6,-8,1,-13,7,-11,1,-13,12,-11,-13,6,0,11,-13,0,-1,1,4,-13,3,-9,-2,-9,8,-6,-3,-13,-6,-8,-2,5,-9,8,10,2,7,3,-9,-1,-6,-1,-1,9,5,11,-2,11,-3,12,-8,3,0,3,5,-1,4,0,10,3,-6,4,5,-13,0,-10,5,5,8,12,11,8,9,9,-6,7,-4,8,-12,-10,4,-10,9,7,3,12,4,9,-7,10,-2,7,0,12,-2,-1,-6,0,-11]),t=new jsfeat.matrix_t(3,3,jsfeat.F32_t|jsfeat.C1_t),i=new jsfeat.matrix_t(32,32,jsfeat.U8_t|jsfeat.C1_t),n=function(e,i,n,a,r,o){var s=Math.cos(n),l=Math.sin(n);t.data[0]=s,t.data[1]=-l,t.data[2]=(-s+l)*o*.5+a,t.data[3]=l,t.data[4]=s,t.data[5]=(-l-s)*o*.5+r,jsfeat.imgproc.warp_affine(e,i,t,128)};return{describe:function(t,a,r,o){var s=32,l=0,c=0,u=0,f=0,h=0,d=0,p=0,m=0,g=(t.data,t.cols,t.rows,i.data),v=528,S=0;o.type&jsfeat.U8_t?o.resize(s,r,1):(o.type=jsfeat.U8_t,o.cols=s,o.rows=r,o.channel=1,o.allocate());var y=o.data,b=0;for(l=0;l<r;++l){for(u=a[l].x,f=a[l].y,h=a[l].angle,n(t,i,h,u,f,32),S=0,c=0;c<s;++c)d=g[v+32*e[S+1]+e[S]],S+=2,p=g[v+32*e[S+1]+e[S]],S+=2,m=d<p|0,d=g[v+32*e[S+1]+e[S]],S+=2,p=g[v+32*e[S+1]+e[S]],S+=2,m|=(d<p)<<1,d=g[v+32*e[S+1]+e[S]],S+=2,p=g[v+32*e[S+1]+e[S]],S+=2,m|=(d<p)<<2,d=g[v+32*e[S+1]+e[S]],S+=2,p=g[v+32*e[S+1]+e[S]],S+=2,m|=(d<p)<<3,d=g[v+32*e[S+1]+e[S]],S+=2,p=g[v+32*e[S+1]+e[S]],S+=2,m|=(d<p)<<4,d=g[v+32*e[S+1]+e[S]],S+=2,p=g[v+32*e[S+1]+e[S]],S+=2,m|=(d<p)<<5,d=g[v+32*e[S+1]+e[S]],S+=2,p=g[v+32*e[S+1]+e[S]],S+=2,m|=(d<p)<<6,d=g[v+32*e[S+1]+e[S]],S+=2,p=g[v+32*e[S+1]+e[S]],S+=2,m|=(d<p)<<7,y[b+c]=m;b+=s}}}}();e.orb=t}(jsfeat),function(e){var t=function(){var e=jsfeat.imgproc.scharr_derivatives;return{track:function(t,i,n,a,r,o,s,l,c,u){"undefined"==typeof s&&(s=30),"undefined"==typeof l&&(l=new Uint8Array(r)),"undefined"==typeof c&&(c=.01),"undefined"==typeof u&&(u=1e-4);var f=.5*(o-1),h=o*o|0,d=h<<1,p=t.data,m=i.data,g=p[0].data,v=m[0].data,S=p[0].cols,y=p[0].rows,b=0,C=0,T=jsfeat.cache.get_buffer(h<<2),w=jsfeat.cache.get_buffer(d<<2),I=jsfeat.cache.get_buffer(y*(S<<1)<<2),x=new jsfeat.matrix_t(S,y,jsfeat.S32C2_t,I.data),A=T.i32,E=w.i32,P=I.i32,D=0,_=0,M=0,O=0,L=0,R=0,k=0,F=0,U=0,G=0,N=0,j=0,B=0,H=0,V=0,K=0,W=0,z=0,q=0,X=0,Y=0,Z=0,J=0,Q=0,$=0,ee=0,te=0,ie=0,ne=0,ae=0,re=0,oe=0,se=0,le=14,ce=14,ue=ce-5,fe=1<<ue-1,he=1<<le,de=1<<ce-1,pe=1/(1<<20),me=0,ge=0,ve=0,Se=0,ye=0,be=0,Ce=0,Te=0,we=0,Ie=0,xe=0,Ae=0,Ee=1.1920929e-7;for(c*=c;X<r;++X)l[X]=1;var Pe=t.levels-1|0;for(Q=Pe;Q>=0;--Q)for(k=1/(1<<Q),b=S>>Q,C=y>>Q,D=b<<1,g=p[Q].data,v=m[Q].data,ie=b-o|0,ne=C-o|0,e(p[Q],x),$=0;$<r;++$)if(X=$<<1,Y=X+1,F=n[X]*k,U=n[Y]*k,Q==Pe?(G=F,N=U):(G=2*a[X],N=2*a[Y]),a[X]=G,a[Y]=N,F-=f,U-=f,K=0|F,W=0|U,Z=K<=te|K>=ie|W<=te|W>=ne,0==Z){for(ae=F-K,re=U-W,me=(1-ae)*(1-re)*he+.5|0,ge=ae*(1-re)*he+.5|0,ve=(1-ae)*re*he+.5|0,Se=he-me-ge-ve,Te=0,we=0,Ie=0,J=0;J<o;++J)for(_=(J+W)*b+K|0,M=_<<1,O=J*o|0,L=O<<1,Z=0;Z<o;++Z,++_,++O,M+=2)ye=g[_]*me+g[_+1]*ge+g[_+b]*ve+g[_+b+1]*Se,ye=ye+fe>>ue,be=P[M]*me+P[M+2]*ge+P[M+D]*ve+P[M+D+2]*Se,be=be+de>>ce,Ce=P[M+1]*me+P[M+3]*ge+P[M+D+1]*ve+P[M+D+3]*Se,Ce=Ce+de>>ce,A[O]=ye,E[L++]=be,E[L++]=Ce,Te+=be*be,we+=be*Ce,Ie+=Ce*Ce;if(Te*=pe,we*=pe,Ie*=pe,xe=Te*Ie-we*we,Ae=(Ie+Te-Math.sqrt((Te-Ie)*(Te-Ie)+4*we*we))/d,Ae<u||xe<Ee)0==Q&&(l[$]=0);else for(xe=1/xe,G-=f,N-=f,j=0,B=0,ee=0;ee<s;++ee){if(z=0|G,q=0|N,Z=z<=te|z>=ie|q<=te|q>=ne,0!=Z){0==Q&&(l[$]=0);break}for(ae=G-z,re=N-q,me=(1-ae)*(1-re)*he+.5|0,ge=ae*(1-re)*he+.5|0,ve=(1-ae)*re*he+.5|0,Se=he-me-ge-ve,oe=0,se=0,J=0;J<o;++J)for(R=(J+q)*b+z|0,O=J*o|0,L=O<<1,Z=0;Z<o;++Z,++R,++O)ye=v[R]*me+v[R+1]*ge+v[R+b]*ve+v[R+b+1]*Se,ye=ye+fe>>ue,ye-=A[O],oe+=ye*E[L++],se+=ye*E[L++];if(oe*=pe,se*=pe,H=(we*se-Ie*oe)*xe,V=(we*oe-Te*se)*xe,G+=H,N+=V,a[X]=G+f,a[Y]=N+f,H*H+V*V<=c)break;if(ee>0&&Math.abs(H+j)<.01&&Math.abs(V+B)<.01){a[X]-=.5*H,a[Y]-=.5*V;break}j=H,B=V}}else 0==Q&&(l[$]=0);jsfeat.cache.put_buffer(T),jsfeat.cache.put_buffer(w),jsfeat.cache.put_buffer(I)}}}();e.optical_flow_lk=t}(jsfeat),function(e){var t=function(){var e=function(e,t){var i=.25*e.width+.5|0;return t.x<=e.x+i&&t.x>=e.x-i&&t.y<=e.y+i&&t.y>=e.y-i&&t.width<=1.5*e.width+.5|0&&1.5*t.width+.5|0>=e.width};return{edges_density:.07,detect_single_scale:function(e,t,i,n,a,r,o,s){var l,c,u,f,h,d,p,m,g,v,S,y,b,C,T,w,I,x,A,E,P,D,_,M,O,L,R=s.size[0]*o|0,k=s.size[1]*o|0,F=.5*o+1.5|0,U=F,G=a-R|0,N=r-k|0,j=a+1|0,B=1/(R*k),H=!0,V=0,K=R,W=k*j,z=W+R,q=R*k*255*this.edges_density|0,X=[];for(h=0;h<N;h+=U)for(V=h*j,f=0;f<G;f+=F,V+=F)if(p=e[V]-e[V+K]-e[V+W]+e[V+z],n&&(d=n[V]-n[V+K]-n[V+W]+n[V+z],d<q||p<20))f+=F,V+=F;else{for(p*=B,m=(t[V]-t[V+K]-t[V+W]+t[V+z])*B-p*p,g=m>0?Math.sqrt(m):1,v=s.complexClassifiers,C=v.length,H=!0,l=0;l<C;++l){for(S=v[l],I=S.threshold,y=S.simpleClassifiers,T=y.length,x=0,c=0;c<T;++c){if(b=y[c],A=0,P=b.features,w=P.length,1===b.tilted)for(u=0;u<w;++u)E=P[u],D=~~(f+E[0]*o)+~~(h+E[1]*o)*j,O=~~(E[2]*o),L=~~(E[3]*o),_=O*j,M=L*j,A+=(i[D]-i[D+O+_]-i[D-L+M]+i[D+O-L+_+M])*E[4];else for(u=0;u<w;++u)E=P[u],D=~~(f+E[0]*o)+~~(h+E[1]*o)*j,O=~~(E[2]*o),L=~~(E[3]*o),M=L*j,A+=(e[D]-e[D+O]-e[D+M]+e[D+M+O])*E[4];x+=A*B<b.threshold*g?b.left_val:b.right_val}if(x<I){H=!1;break}}H&&(X.push({x:f,y:h,width:R,height:k,neighbor:1,confidence:x}),f+=F,V+=F)}return X},detect_multi_scale:function(e,t,i,n,a,r,o,s,l){"undefined"==typeof s&&(s=1.2),"undefined"==typeof l&&(l=1);for(var c=o.size[0],u=o.size[1],f=[];l*c<a&&l*u<r;)f=f.concat(this.detect_single_scale(e,t,i,n,a,r,l,o)),l*=s;return f},group_rectangles:function(t,i){"undefined"==typeof i&&(i=1);var n,a,r=t.length,o=[];for(n=0;n<r;++n)o[n]={parent:-1,element:t[n],rank:0};for(n=0;n<r;++n)if(o[n].element){for(var s=n;o[s].parent!=-1;)s=o[s].parent;for(a=0;a<r;++a)if(n!=a&&o[a].element&&e(o[n].element,o[a].element)){for(var l=a;o[l].parent!=-1;)l=o[l].parent;if(l!=s){o[s].rank>o[l].rank?o[l].parent=s:(o[s].parent=l,o[s].rank==o[l].rank&&o[l].rank++,s=l);for(var c,u=a;o[u].parent!=-1;)c=u,u=o[u].parent,o[c].parent=s;for(u=n;o[u].parent!=-1;)c=u,u=o[u].parent,o[c].parent=s}}}var f=[],h=0;for(n=0;n<r;n++){a=-1;var d=n;if(o[d].element){for(;o[d].parent!=-1;)d=o[d].parent;o[d].rank>=0&&(o[d].rank=~h++),a=~o[d].rank}f[n]=a}var p=[];for(n=0;n<h+1;++n)p[n]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(n=0;n<r;++n){var m=t[n],g=f[n];0==p[g].neighbors&&(p[g].confidence=m.confidence),++p[g].neighbors,p[g].x+=m.x,p[g].y+=m.y,p[g].width+=m.width,p[g].height+=m.height,p[g].confidence=Math.max(p[g].confidence,m.confidence)}var v=[];for(n=0;n<h;++n)r=p[n].neighbors,r>=i&&v.push({x:(2*p[n].x+r)/(2*r),y:(2*p[n].y+r)/(2*r),width:(2*p[n].width+r)/(2*r),height:(2*p[n].height+r)/(2*r),neighbors:p[n].neighbors,confidence:p[n].confidence});var S=[];for(r=v.length,n=0;n<r;++n){var m=v[n],y=!0;for(a=0;a<r;++a){var b=v[a],C=.25*b.width+.5|0;if(n!=a&&m.x>=b.x-C&&m.y>=b.y-C&&m.x+m.width<=b.x+b.width+C&&m.y+m.height<=b.y+b.height+C&&(b.neighbors>Math.max(3,m.neighbors)||m.neighbors<3)){y=!1;break}}y&&S.push(m)}return S}}}();e.haar=t}(jsfeat),function(e){var t=function(){var e=function(e,t){var i=.25*e.width+.5|0;return t.x<=e.x+i&&t.x>=e.x-i&&t.y<=e.y+i&&t.y>=e.y-i&&t.width<=1.5*e.width+.5|0&&1.5*t.width+.5|0>=e.width},t=new jsfeat.pyramid_t(1);return{interval:4,scale:1.1486,next:5,scale_to:1,prepare_cascade:function(e){for(var t=e.stage_classifier.length,i=0;i<t;i++)for(var n=e.stage_classifier[i].feature,a=e.stage_classifier[i].count,r=e.stage_classifier[i]._feature=new Array(a),o=0;o<a;o++)r[o]={size:n[o].size,px:new Array(n[o].size),pz:new Array(n[o].size),nx:new Array(n[o].size),nz:new Array(n[o].size)}},build_pyramid:function(e,i,n,a){"undefined"==typeof a&&(a=4);var r=e.cols,o=e.rows,s=0,l=0,c=0,u=!1,f=e,h=e,d=jsfeat.U8_t|jsfeat.C1_t;this.interval=a,this.scale=Math.pow(2,1/(this.interval+1)),this.next=this.interval+1|0,this.scale_to=Math.log(Math.min(r/i,o/n))/Math.log(this.scale)|0;var p=4*(this.scale_to+2*this.next)|0;for(t.levels!=p&&(t.levels=p,t.data=new Array(p),u=!0,t.data[0]=e),s=1;s<=this.interval;++s)l=r/Math.pow(this.scale,s)|0,c=o/Math.pow(this.scale,s)|0,f=t.data[s<<2],(u||l!=f.cols||c!=f.rows)&&(t.data[s<<2]=new jsfeat.matrix_t(l,c,d),f=t.data[s<<2]),jsfeat.imgproc.resample(e,f,l,c);for(s=this.next;s<this.scale_to+2*this.next;++s)h=t.data[(s<<2)-(this.next<<2)],f=t.data[s<<2],l=h.cols>>1,c=h.rows>>1,(u||l!=f.cols||c!=f.rows)&&(t.data[s<<2]=new jsfeat.matrix_t(l,c,d),f=t.data[s<<2]),jsfeat.imgproc.pyrdown(h,f);for(s=2*this.next;s<this.scale_to+2*this.next;++s)h=t.data[(s<<2)-(this.next<<2)],l=h.cols>>1,c=h.rows>>1,f=t.data[(s<<2)+1],(u||l!=f.cols||c!=f.rows)&&(t.data[(s<<2)+1]=new jsfeat.matrix_t(l,c,d),f=t.data[(s<<2)+1]),jsfeat.imgproc.pyrdown(h,f,1,0),f=t.data[(s<<2)+2],(u||l!=f.cols||c!=f.rows)&&(t.data[(s<<2)+2]=new jsfeat.matrix_t(l,c,d),f=t.data[(s<<2)+2]),jsfeat.imgproc.pyrdown(h,f,0,1),f=t.data[(s<<2)+3],(u||l!=f.cols||c!=f.rows)&&(t.data[(s<<2)+3]=new jsfeat.matrix_t(l,c,d),f=t.data[(s<<2)+3]),jsfeat.imgproc.pyrdown(h,f,1,1);return t},detect:function(e,t){var i,n,a,r,o,s=(this.interval,this.scale),l=this.next,c=this.scale_to,u=0,f=0,h=0,d=0,p=0,m=0,g=0,v=0,S=0,y=0,b=0,C=0,T=0,w=0,I=0,x=0,A=0,E=0,P=!0,D=!0,_=1,M=1,O=[0,1,0,1],L=[0,0,1,1],R=[],k=e.data,F=1,U=2,G=4,N=[],j=[0,0,0],B=[0,0,0],H=[0,0,0];for(u=0;u<c;u++){for(I=u<<2,x=k[I+(l<<3)].cols-(t.width>>2),A=k[I+(l<<3)].rows-(t.height>>2),B[0]=k[I].cols*F,B[1]=k[I+(l<<2)].cols*F,B[2]=k[I+(l<<3)].cols*F,H[0]=k[I].cols*G-x*G,H[1]=k[I+(l<<2)].cols*U-x*U,H[2]=k[I+(l<<3)].cols*F-x*F,v=t.stage_classifier.length,f=0;f<v;f++)for(a=t.stage_classifier[f].feature,n=t.stage_classifier[f]._feature,S=t.stage_classifier[f].count,h=0;h<S;h++)for(r=n[h],o=a[h],y=0|o.size,g=0;g<y;g++)r.px[g]=o.px[g]*F+o.py[g]*B[o.pz[g]],r.pz[g]=o.pz[g],r.nx[g]=o.nx[g]*F+o.ny[g]*B[o.nz[g]],r.nz[g]=o.nz[g];for(N[0]=k[I].data,N[1]=k[I+(l<<2)].data,g=0;g<4;g++)for(N[2]=k[I+(l<<3)+g].data,j[0]=O[g]*U+L[g]*(k[I].cols*U),j[1]=O[g]*F+L[g]*(k[I+(l<<2)].cols*F),j[2]=0,m=0;m<A;m++){for(p=0;p<x;p++){for(E=0,P=!0,v=t.stage_classifier.length,f=0;f<v;f++){for(E=0,i=t.stage_classifier[f].alpha,n=t.stage_classifier[f]._feature,S=t.stage_classifier[f].count,h=0;h<S;h++)if(r=n[h],C=N[r.pz[0]][j[r.pz[0]]+r.px[0]],T=N[r.nz[0]][j[r.nz[0]]+r.nx[0]],C<=T)E+=i[h<<1];else{for(D=!0,y=r.size,w=1;w<y;w++){if(r.pz[w]>=0&&(b=N[r.pz[w]][j[r.pz[w]]+r.px[w]],b<C)){if(b<=T){D=!1;break}C=b}if(r.nz[w]>=0&&(d=N[r.nz[w]][j[r.nz[w]]+r.nx[w]],d>T)){if(C<=d){D=!1;break}T=d}}E+=D?i[(h<<1)+1]:i[h<<1]}if(E<t.stage_classifier[f].threshold){P=!1;break}}P&&(R.push({x:(4*p+2*O[g])*_,y:(4*m+2*L[g])*M,width:t.width*_,height:t.height*M,neighbor:1,confidence:E}),++p,j[0]+=G,j[1]+=U,j[2]+=F),j[0]+=G,j[1]+=U,j[2]+=F}j[0]+=H[0],j[1]+=H[1],j[2]+=H[2]}_*=s,M*=s}return R},group_rectangles:function(t,i){"undefined"==typeof i&&(i=1);var n,a,r=t.length,o=[];for(n=0;n<r;++n)o[n]={parent:-1,element:t[n],rank:0};for(n=0;n<r;++n)if(o[n].element){for(var s=n;o[s].parent!=-1;)s=o[s].parent;for(a=0;a<r;++a)if(n!=a&&o[a].element&&e(o[n].element,o[a].element)){for(var l=a;o[l].parent!=-1;)l=o[l].parent;if(l!=s){o[s].rank>o[l].rank?o[l].parent=s:(o[s].parent=l,o[s].rank==o[l].rank&&o[l].rank++,s=l);for(var c,u=a;o[u].parent!=-1;)c=u,u=o[u].parent,o[c].parent=s;for(u=n;o[u].parent!=-1;)c=u,u=o[u].parent,o[c].parent=s}}}var f=[],h=0;for(n=0;n<r;n++){a=-1;var d=n;if(o[d].element){for(;o[d].parent!=-1;)d=o[d].parent;o[d].rank>=0&&(o[d].rank=~h++),a=~o[d].rank}f[n]=a}var p=[];for(n=0;n<h+1;++n)p[n]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(n=0;n<r;++n){var m=t[n],g=f[n];0==p[g].neighbors&&(p[g].confidence=m.confidence),++p[g].neighbors,p[g].x+=m.x,p[g].y+=m.y,p[g].width+=m.width,p[g].height+=m.height,p[g].confidence=Math.max(p[g].confidence,m.confidence)}var v=[];for(n=0;n<h;++n)r=p[n].neighbors,r>=i&&v.push({x:(2*p[n].x+r)/(2*r),y:(2*p[n].y+r)/(2*r),width:(2*p[n].width+r)/(2*r),height:(2*p[n].height+r)/(2*r),neighbors:p[n].neighbors,confidence:p[n].confidence});var S=[];for(r=v.length,n=0;n<r;++n){var m=v[n],y=!0;for(a=0;a<r;++a){var b=v[a],C=.25*b.width+.5|0;if(n!=a&&m.x>=b.x-C&&m.y>=b.y-C&&m.x+m.width<=b.x+b.width+C&&m.y+m.height<=b.y+b.height+C&&(b.neighbors>Math.max(3,m.neighbors)||m.neighbors<3)){y=!1;break}}y&&S.push(m)}return S}}}();e.bbf=t}(jsfeat),function(e){"undefined"==typeof module||"undefined"==typeof module.exports?window.jsfeat=e:module.exports=e}(jsfeat),/*
The MIT License (MIT)

Copyright (c) 2014, 2015 hMatoba(https://github.com/hMatoba)

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/
function(){"use strict";function e(e){return JSON.parse(JSON.stringify(e))}function t(e){for(var t=f(e);"\xff\xe0"<=t[1].slice(0,2)&&t[1].slice(0,2)<="\xff\xef";)t=[t[0]].concat(t.slice(2));return t.join("")}function i(e){return l(">"+u("B",e.length),e)}function n(e){return l(">"+u("H",e.length),e)}function a(e){return l(">"+u("L",e.length),e)}function r(e,t,r){var o,s,c,f,h="",d="";if("Byte"==t)o=e.length,o<=4?d=i(e)+u("\0",4-o):(d=l(">L",[r]),h=i(e));else if("Short"==t)o=e.length,o<=2?d=n(e)+u("\0\0",2-o):(d=l(">L",[r]),h=n(e));else if("Long"==t)o=e.length,o<=1?d=a(e):(d=l(">L",[r]),h=a(e));else if("Ascii"==t)s=e+"\0",o=s.length,o>4?(d=l(">L",[r]),h=s):d=s+u("\0",4-o);else if("Rational"==t){if("number"==typeof e[0])o=1,c=e[0],f=e[1],s=l(">L",[c])+l(">L",[f]);else{o=e.length,s="";for(var p=0;p<o;p++)c=e[p][0],f=e[p][1],s+=l(">L",[c])+l(">L",[f])}d=l(">L",[r]),h=s}else if("SRational"==t){if("number"==typeof e[0])o=1,c=e[0],f=e[1],s=l(">l",[c])+l(">l",[f]);else{o=e.length,s="";for(var p=0;p<o;p++)c=e[p][0],f=e[p][1],s+=l(">l",[c])+l(">l",[f])}d=l(">L",[r]),h=s}else"Undefined"==t&&(o=e.length,o>4?(d=l(">L",[r]),h=e):d=e+u("\0",4-o));var m=l(">L",[o]);return[m,d,h]}function o(e,t,i){var n,a=8,o=Object.keys(e).length,s=l(">H",[o]);n=["0th","1st"].indexOf(t)>-1?2+12*o+4:2+12*o;var c,u="",f="";for(var c in e)if("string"==typeof c&&(c=parseInt(c)),!("0th"==t&&[34665,34853].indexOf(c)>-1||"Exif"==t&&40965==c||"1st"==t&&[513,514].indexOf(c)>-1)){var h=e[c],d=l(">H",[c]),p=S[t][c].type,m=l(">H",[v[p]]);"number"==typeof h&&(h=[h]);var g=a+n+i+f.length,y=r(h,p,g),b=y[0],C=y[1],T=y[2];u+=d+m+b+C,f+=T}return[s+u,f]}function s(e){var t,i;if("\xff\xd8"==e.slice(0,2))t=f(e),i=h(t),i?this.tiftag=i.slice(10):this.tiftag=null;else if(["II","MM"].indexOf(e.slice(0,2))>-1)this.tiftag=e;else{if("Exif"!=e.slice(0,4))throw"Given file is neither JPEG nor TIFF.";this.tiftag=e.slice(6)}}function l(e,t){if(!(t instanceof Array))throw"'pack' error. Got invalid type argument.";if(e.length-1!=t.length)throw"'pack' error. "+(e.length-1)+" marks, "+t.length+" elements.";var i;if("<"==e[0])i=!0;else{if(">"!=e[0])throw"";i=!1}for(var n="",a=1,r=null,o=null,s=null;o=e[a];){if("b"==o.toLowerCase()){if(r=t[a-1],"b"==o&&r<0&&(r+=256),r>255||r<0)throw"'pack' error.";s=String.fromCharCode(r)}else if("H"==o){if(r=t[a-1],r>65535||r<0)throw"'pack' error.";s=String.fromCharCode(Math.floor(r%65536/256))+String.fromCharCode(r%256),i&&(s=s.split("").reverse().join(""))}else{if("l"!=o.toLowerCase())throw"'pack' error.";if(r=t[a-1],"l"==o&&r<0&&(r+=4294967296),r>4294967295||r<0)throw"'pack' error.";s=String.fromCharCode(Math.floor(r/16777216))+String.fromCharCode(Math.floor(r%16777216/65536))+String.fromCharCode(Math.floor(r%65536/256))+String.fromCharCode(r%256),i&&(s=s.split("").reverse().join(""))}n+=s,a+=1}return n}function c(e,t){if("string"!=typeof t)throw"'unpack' error. Got invalid type argument.";for(var i=0,n=1;n<e.length;n++)if("b"==e[n].toLowerCase())i+=1;else if("h"==e[n].toLowerCase())i+=2;else{if("l"!=e[n].toLowerCase())throw"'unpack' error. Got invalid mark.";i+=4}if(i!=t.length)throw"'unpack' error. Mismatch between symbol and string length. "+i+":"+t.length;var a;if("<"==e[0])a=!0;else{if(">"!=e[0])throw"'unpack' error.";a=!1}for(var r=[],o=0,s=1,l=null,c=null,u=null,f="";c=e[s];){if("b"==c.toLowerCase())u=1,f=t.slice(o,o+u),l=f.charCodeAt(0),"b"==c&&l>=128&&(l-=256);else if("H"==c)u=2,f=t.slice(o,o+u),a&&(f=f.split("").reverse().join("")),l=256*f.charCodeAt(0)+f.charCodeAt(1);else{if("l"!=c.toLowerCase())throw"'unpack' error. "+c;u=4,f=t.slice(o,o+u),a&&(f=f.split("").reverse().join("")),l=16777216*f.charCodeAt(0)+65536*f.charCodeAt(1)+256*f.charCodeAt(2)+f.charCodeAt(3),"l"==c&&l>=2147483648&&(l-=4294967296)}r.push(l),o+=u,s+=1}return r}function u(e,t){for(var i="",n=0;n<t;n++)i+=e;return i}function f(e){if("\xff\xd8"!=e.slice(0,2))throw"Given data isn't JPEG.";for(var t=2,i=["\xff\xd8"];;){if("\xff\xda"==e.slice(t,t+2)){i.push(e.slice(t));break}var n=c(">H",e.slice(t+2,t+4))[0],a=t+n+2;if(i.push(e.slice(t,a)),t=a,t>=e.length)throw"Wrong JPEG data."}return i}function h(e){for(var t,i=0;i<e.length;i++)if(t=e[i],"\xff\xe1"==t.slice(0,2))return t;return null}function d(e,t){return"\xff\xe0"==e[1].slice(0,2)&&"\xff\xe1"==e[2].slice(0,2)?t?(e[2]=t,e=["\xff\xd8",t].concat(e.slice(2))):e=null==t?e.slice(0,2).concat(e.slice(3)):e.slice(0).concat(e.slice(2)):"\xff\xe0"==e[1].slice(0,2)?t&&(e[1]=t):"\xff\xe1"==e[1].slice(0,2)?t?e[1]=t:null==t&&(e=e.slice(0).concat(e.slice(2))):t&&(e=[e[0],t].concat(e.slice(1))),e.join("")}var p={};if(p.remove=function(e){var t=!1;if("\xff\xd8"==e.slice(0,2));else{if("data:image/jpeg;base64,"!=e.slice(0,23))throw"Given data is not jpeg.";e=g(e.split(",")[1]),t=!0}var i=f(e);if("\xff\xe1"==i[1].slice(0,2))i=[i[0]].concat(i.slice(2));else{if("\xff\xe1"!=i[2].slice(0,2))throw"Exif not found.";i=i.slice(0,2).concat(i.slice(3))}var n=i.join("");return t&&(n="data:image/jpeg;base64,"+m(n)),n},p.insert=function(e,t){var i=!1;if("Exif\0\0"!=e.slice(0,6))throw"Given data is not exif.";if("\xff\xd8"==t.slice(0,2));else{if("data:image/jpeg;base64,"!=t.slice(0,23))throw"Given data is not jpeg.";t=g(t.split(",")[1]),i=!0}var n="\xff\xe1"+l(">H",[e.length+2])+e,a=f(t),r=d(a,n);return i&&(r="data:image/jpeg;base64,"+m(r)),r},p.load=function(e){var t;if("string"!=typeof e)throw"'load' gots invalid type argument.";if("\xff\xd8"==e.slice(0,2))t=e;else if("data:image/jpeg;base64,"==e.slice(0,23))t=g(e.split(",")[1]);else{if("Exif"!=e.slice(0,4))throw"'load' gots invalid file data.";t=e.slice(6)}var i={"0th":{},Exif:{},GPS:{},Interop:{},"1st":{},thumbnail:null},n=new s(t);if(null===n.tiftag)return i;"II"==n.tiftag.slice(0,2)?n.endian_mark="<":n.endian_mark=">";var a=c(n.endian_mark+"L",n.tiftag.slice(4,8))[0];i["0th"]=n.get_ifd(a,"0th");var r=i["0th"].first_ifd_pointer;if(delete i["0th"].first_ifd_pointer,34665 in i["0th"]&&(a=i["0th"][34665],i.Exif=n.get_ifd(a,"Exif")),34853 in i["0th"]&&(a=i["0th"][34853],i.GPS=n.get_ifd(a,"GPS")),40965 in i.Exif&&(a=i.Exif[40965],i.Interop=n.get_ifd(a,"Interop")),"\0\0\0\0"!=r&&(a=c(n.endian_mark+"L",r)[0],i["1st"]=n.get_ifd(a,"1st"),513 in i["1st"]&&514 in i["1st"])){var o=i["1st"][513]+i["1st"][514],l=n.tiftag.slice(i["1st"][513],o);i.thumbnail=l}return i},p.dump=function(i){var n,a,r,s,c,u=8,f=e(i),h="Exif\0\0MM\0*\0\0\0\b",d=!1,p=!1,m=!1,g=!1;n="0th"in f?f["0th"]:{},("Exif"in f&&Object.keys(f.Exif).length||"Interop"in f&&Object.keys(f.Interop).length)&&(n[34665]=1,d=!0,a=f.Exif,"Interop"in f&&Object.keys(f.Interop).length&&(a[40965]=1,m=!0,r=f.Interop)),"GPS"in f&&Object.keys(f.GPS).length&&(n[34853]=1,p=!0,s=f.GPS),"1st"in f&&"thumbnail"in f&&null!=f.thumbnail&&(g=!0,f["1st"][513]=1,f["1st"][514]=1,c=f["1st"]);var S,y,b,C,T,w=o(n,"0th",0),I=w[0].length+12*d+12*p+4+w[1].length,x="",A=0,E="",P=0,D="",_=0,M="";if(d&&(S=o(a,"Exif",I),A=S[0].length+12*m+S[1].length),p&&(y=o(s,"GPS",I+A),E=y.join(""),P=E.length),m){var O=I+A+P;b=o(r,"Interop",O),D=b.join(""),_=D.length}if(g){var O=I+A+P+_;if(C=o(c,"1st",O),T=t(f.thumbnail),T.length>64e3)throw"Given thumbnail is too large. max 64kB"}var L="",R="",k="",F="\0\0\0\0";if(d){var U=u+I,G=l(">L",[U]),N=34665,j=l(">H",[N]),B=l(">H",[v.Long]),H=l(">L",[1]);L=j+B+H+G}if(p){var U=u+I+A,G=l(">L",[U]),N=34853,j=l(">H",[N]),B=l(">H",[v.Long]),H=l(">L",[1]);R=j+B+H+G}if(m){var U=u+I+A+P,G=l(">L",[U]),N=40965,j=l(">H",[N]),B=l(">H",[v.Long]),H=l(">L",[1]);k=j+B+H+G}if(g){var U=u+I+A+P+_;F=l(">L",[U]);var V=U+C[0].length+24+4+C[1].length,K="\x02\x01\0\x04\0\0\0\x01"+l(">L",[V]),W="\x02\x02\0\x04\0\0\0\x01"+l(">L",[T.length]);M=C[0]+K+W+"\0\0\0\0"+C[1]+T}var z=w[0]+L+R+F+w[1];return d&&(x=S[0]+k+S[1]),h+z+x+E+D+M},s.prototype={get_ifd:function(e,t){var i,n={},a=c(this.endian_mark+"H",this.tiftag.slice(e,e+2))[0],r=e+2;i=["0th","1st"].indexOf(t)>-1?"Image":t;for(var o=0;o<a;o++){e=r+12*o;var s=c(this.endian_mark+"H",this.tiftag.slice(e,e+2))[0],l=c(this.endian_mark+"H",this.tiftag.slice(e+2,e+4))[0],u=c(this.endian_mark+"L",this.tiftag.slice(e+4,e+8))[0],f=this.tiftag.slice(e+8,e+12),h=[l,u,f];s in S[i]&&(n[s]=this.convert_value(h))}return"0th"==t&&(e=r+12*a,n.first_ifd_pointer=this.tiftag.slice(e,e+4)),n},convert_value:function(e){var t,i=null,n=e[0],a=e[1],r=e[2];if(1==n)a>4?(t=c(this.endian_mark+"L",r)[0],i=c(this.endian_mark+u("B",a),this.tiftag.slice(t,t+a))):i=c(this.endian_mark+u("B",a),r.slice(0,a));else if(2==n)a>4?(t=c(this.endian_mark+"L",r)[0],i=this.tiftag.slice(t,t+a-1)):i=r.slice(0,a-1);else if(3==n)a>2?(t=c(this.endian_mark+"L",r)[0],i=c(this.endian_mark+u("H",a),this.tiftag.slice(t,t+2*a))):i=c(this.endian_mark+u("H",a),r.slice(0,2*a));else if(4==n)a>1?(t=c(this.endian_mark+"L",r)[0],i=c(this.endian_mark+u("L",a),this.tiftag.slice(t,t+4*a))):i=c(this.endian_mark+u("L",a),r);else if(5==n)if(t=c(this.endian_mark+"L",r)[0],a>1){i=[];for(var o=0;o<a;o++)i.push([c(this.endian_mark+"L",this.tiftag.slice(t+8*o,t+4+8*o))[0],c(this.endian_mark+"L",this.tiftag.slice(t+4+8*o,t+8+8*o))[0]])}else i=[c(this.endian_mark+"L",this.tiftag.slice(t,t+4))[0],c(this.endian_mark+"L",this.tiftag.slice(t+4,t+8))[0]];else if(7==n)a>4?(t=c(this.endian_mark+"L",r)[0],i=this.tiftag.slice(t,t+a)):i=r.slice(0,a);else{if(10!=n)throw"Exif might be wrong. Got incorrect value type to decode. type:"+n;if(t=c(this.endian_mark+"L",r)[0],a>1){i=[];for(var o=0;o<a;o++)i.push([c(this.endian_mark+"l",this.tiftag.slice(t+8*o,t+4+8*o))[0],c(this.endian_mark+"l",this.tiftag.slice(t+4+8*o,t+8+8*o))[0]])}else i=[c(this.endian_mark+"l",this.tiftag.slice(t,t+4))[0],c(this.endian_mark+"l",this.tiftag.slice(t+4,t+8))[0]]}return i instanceof Array&&1==i.length?i[0]:i}},"undefined"==typeof m)var m=function(e){for(var t,i,n,a,r,o,s,l="",c=0,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";c<e.length;)t=e.charCodeAt(c++),i=e.charCodeAt(c++),n=e.charCodeAt(c++),a=t>>2,r=(3&t)<<4|i>>4,o=(15&i)<<2|n>>6,s=63&n,isNaN(i)?o=s=64:isNaN(n)&&(s=64),l=l+u.charAt(a)+u.charAt(r)+u.charAt(o)+u.charAt(s);return l};if("undefined"==typeof g)var g=function(e){var t,i,n,a,r,o,s,l="",c=0,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<e.length;)a=u.indexOf(e.charAt(c++)),r=u.indexOf(e.charAt(c++)),o=u.indexOf(e.charAt(c++)),s=u.indexOf(e.charAt(c++)),t=a<<2|r>>4,i=(15&r)<<4|o>>2,n=(3&o)<<6|s,l+=String.fromCharCode(t),64!=o&&(l+=String.fromCharCode(i)),64!=s&&(l+=String.fromCharCode(n));return l};var v={Byte:1,Ascii:2,Short:3,Long:4,Rational:5,Undefined:7,SLong:9,SRational:10},S={Image:{11:{name:"ProcessingSoftware",type:"Ascii"},254:{name:"NewSubfileType",type:"Long"},255:{name:"SubfileType",type:"Short"},256:{name:"ImageWidth",type:"Long"},257:{name:"ImageLength",type:"Long"},258:{name:"BitsPerSample",type:"Short"},259:{name:"Compression",type:"Short"},262:{name:"PhotometricInterpretation",type:"Short"},263:{name:"Threshholding",type:"Short"},264:{name:"CellWidth",type:"Short"},265:{name:"CellLength",type:"Short"},266:{name:"FillOrder",type:"Short"},269:{name:"DocumentName",type:"Ascii"},270:{name:"ImageDescription",type:"Ascii"},271:{name:"Make",type:"Ascii"},272:{name:"Model",type:"Ascii"},273:{name:"StripOffsets",type:"Long"},274:{name:"Orientation",type:"Short"},277:{name:"SamplesPerPixel",type:"Short"},278:{name:"RowsPerStrip",type:"Long"},279:{name:"StripByteCounts",type:"Long"},282:{name:"XResolution",type:"Rational"},283:{name:"YResolution",type:"Rational"},284:{name:"PlanarConfiguration",type:"Short"},290:{name:"GrayResponseUnit",type:"Short"},291:{name:"GrayResponseCurve",type:"Short"},292:{name:"T4Options",type:"Long"},293:{name:"T6Options",type:"Long"},296:{name:"ResolutionUnit",type:"Short"},301:{name:"TransferFunction",type:"Short"},305:{name:"Software",type:"Ascii"},306:{name:"DateTime",type:"Ascii"},315:{name:"Artist",type:"Ascii"},316:{name:"HostComputer",type:"Ascii"},317:{name:"Predictor",type:"Short"},318:{name:"WhitePoint",type:"Rational"},319:{name:"PrimaryChromaticities",type:"Rational"},320:{name:"ColorMap",type:"Short"},321:{name:"HalftoneHints",type:"Short"},322:{name:"TileWidth",type:"Short"},323:{name:"TileLength",type:"Short"},324:{name:"TileOffsets",type:"Short"},325:{name:"TileByteCounts",type:"Short"},330:{name:"SubIFDs",type:"Long"},332:{name:"InkSet",type:"Short"},333:{name:"InkNames",type:"Ascii"},334:{name:"NumberOfInks",type:"Short"},336:{name:"DotRange",type:"Byte"},337:{name:"TargetPrinter",type:"Ascii"},338:{name:"ExtraSamples",type:"Short"},339:{name:"SampleFormat",type:"Short"},340:{name:"SMinSampleValue",type:"Short"},341:{name:"SMaxSampleValue",type:"Short"},342:{name:"TransferRange",type:"Short"},343:{name:"ClipPath",type:"Byte"},344:{name:"XClipPathUnits",type:"Long"},345:{name:"YClipPathUnits",type:"Long"},346:{name:"Indexed",type:"Short"},347:{name:"JPEGTables",type:"Undefined"},351:{name:"OPIProxy",type:"Short"},512:{name:"JPEGProc",type:"Long"},513:{name:"JPEGInterchangeFormat",type:"Long"},514:{name:"JPEGInterchangeFormatLength",type:"Long"},515:{name:"JPEGRestartInterval",type:"Short"},517:{name:"JPEGLosslessPredictors",type:"Short"},518:{name:"JPEGPointTransforms",type:"Short"},519:{name:"JPEGQTables",type:"Long"},520:{name:"JPEGDCTables",type:"Long"},521:{name:"JPEGACTables",type:"Long"},529:{name:"YCbCrCoefficients",type:"Rational"},530:{name:"YCbCrSubSampling",type:"Short"},531:{name:"YCbCrPositioning",type:"Short"},532:{name:"ReferenceBlackWhite",type:"Rational"},700:{name:"XMLPacket",type:"Byte"},18246:{name:"Rating",type:"Short"},18249:{name:"RatingPercent",type:"Short"},32781:{name:"ImageID",type:"Ascii"},33421:{name:"CFARepeatPatternDim",type:"Short"},33422:{name:"CFAPattern",type:"Byte"},33423:{name:"BatteryLevel",type:"Rational"},33432:{name:"Copyright",type:"Ascii"},33434:{name:"ExposureTime",type:"Rational"},34377:{name:"ImageResources",type:"Byte"},34665:{name:"ExifTag",type:"Long"},34675:{name:"InterColorProfile",type:"Undefined"},34853:{name:"GPSTag",type:"Long"},34857:{name:"Interlace",type:"Short"},34858:{name:"TimeZoneOffset",type:"Long"},34859:{name:"SelfTimerMode",type:"Short"},37387:{name:"FlashEnergy",type:"Rational"},37388:{name:"SpatialFrequencyResponse",type:"Undefined"},37389:{name:"Noise",type:"Undefined"},37390:{name:"FocalPlaneXResolution",type:"Rational"},37391:{name:"FocalPlaneYResolution",type:"Rational"},37392:{name:"FocalPlaneResolutionUnit",type:"Short"},37393:{name:"ImageNumber",type:"Long"},37394:{name:"SecurityClassification",type:"Ascii"},37395:{name:"ImageHistory",type:"Ascii"},37397:{name:"ExposureIndex",type:"Rational"},37398:{name:"TIFFEPStandardID",type:"Byte"},37399:{name:"SensingMethod",type:"Short"},40091:{name:"XPTitle",type:"Byte"},40092:{name:"XPComment",type:"Byte"},40093:{name:"XPAuthor",type:"Byte"},40094:{name:"XPKeywords",type:"Byte"},40095:{name:"XPSubject",type:"Byte"},50341:{name:"PrintImageMatching",type:"Undefined"},50706:{name:"DNGVersion",type:"Byte"},50707:{name:"DNGBackwardVersion",type:"Byte"},50708:{name:"UniqueCameraModel",type:"Ascii"},50709:{name:"LocalizedCameraModel",type:"Byte"},50710:{name:"CFAPlaneColor",type:"Byte"},50711:{name:"CFALayout",type:"Short"},50712:{name:"LinearizationTable",type:"Short"},50713:{name:"BlackLevelRepeatDim",type:"Short"},50714:{name:"BlackLevel",type:"Rational"},50715:{name:"BlackLevelDeltaH",type:"SRational"},50716:{name:"BlackLevelDeltaV",type:"SRational"},50717:{name:"WhiteLevel",type:"Short"},50718:{name:"DefaultScale",type:"Rational"},50719:{name:"DefaultCropOrigin",type:"Short"},50720:{name:"DefaultCropSize",type:"Short"},50721:{name:"ColorMatrix1",type:"SRational"},50722:{name:"ColorMatrix2",type:"SRational"},50723:{name:"CameraCalibration1",type:"SRational"},50724:{name:"CameraCalibration2",type:"SRational"},50725:{name:"ReductionMatrix1",type:"SRational"},50726:{name:"ReductionMatrix2",type:"SRational"},50727:{name:"AnalogBalance",type:"Rational"},50728:{name:"AsShotNeutral",type:"Short"},50729:{name:"AsShotWhiteXY",type:"Rational"},50730:{name:"BaselineExposure",type:"SRational"},50731:{name:"BaselineNoise",type:"Rational"},50732:{name:"BaselineSharpness",type:"Rational"},50733:{name:"BayerGreenSplit",type:"Long"},50734:{name:"LinearResponseLimit",type:"Rational"},50735:{name:"CameraSerialNumber",type:"Ascii"},50736:{name:"LensInfo",type:"Rational"},50737:{name:"ChromaBlurRadius",type:"Rational"},50738:{name:"AntiAliasStrength",type:"Rational"},50739:{name:"ShadowScale",type:"SRational"},50740:{name:"DNGPrivateData",type:"Byte"},50741:{name:"MakerNoteSafety",type:"Short"},50778:{name:"CalibrationIlluminant1",type:"Short"},50779:{name:"CalibrationIlluminant2",type:"Short"},50780:{name:"BestQualityScale",type:"Rational"},50781:{name:"RawDataUniqueID",type:"Byte"},50827:{name:"OriginalRawFileName",type:"Byte"},50828:{name:"OriginalRawFileData",type:"Undefined"},50829:{name:"ActiveArea",type:"Short"},50830:{name:"MaskedAreas",type:"Short"},50831:{name:"AsShotICCProfile",type:"Undefined"},50832:{name:"AsShotPreProfileMatrix",type:"SRational"},50833:{name:"CurrentICCProfile",type:"Undefined"},50834:{name:"CurrentPreProfileMatrix",type:"SRational"},50879:{name:"ColorimetricReference",type:"Short"},50931:{name:"CameraCalibrationSignature",type:"Byte"},50932:{name:"ProfileCalibrationSignature",type:"Byte"},50934:{name:"AsShotProfileName",type:"Byte"},50935:{name:"NoiseReductionApplied",type:"Rational"},50936:{name:"ProfileName",type:"Byte"},50937:{name:"ProfileHueSatMapDims",type:"Long"},50938:{name:"ProfileHueSatMapData1",type:"Float"},50939:{name:"ProfileHueSatMapData2",type:"Float"},50940:{name:"ProfileToneCurve",type:"Float"},50941:{name:"ProfileEmbedPolicy",type:"Long"},50942:{name:"ProfileCopyright",type:"Byte"},50964:{name:"ForwardMatrix1",type:"SRational"},50965:{name:"ForwardMatrix2",type:"SRational"},50966:{name:"PreviewApplicationName",type:"Byte"},50967:{name:"PreviewApplicationVersion",type:"Byte"},50968:{name:"PreviewSettingsName",type:"Byte"},50969:{name:"PreviewSettingsDigest",type:"Byte"},50970:{name:"PreviewColorSpace",type:"Long"},50971:{name:"PreviewDateTime",type:"Ascii"},50972:{name:"RawImageDigest",type:"Undefined"},50973:{name:"OriginalRawFileDigest",type:"Undefined"},50974:{name:"SubTileBlockSize",type:"Long"},50975:{name:"RowInterleaveFactor",type:"Long"},50981:{name:"ProfileLookTableDims",type:"Long"},50982:{name:"ProfileLookTableData",type:"Float"},51008:{name:"OpcodeList1",type:"Undefined"},51009:{name:"OpcodeList2",type:"Undefined"},51022:{name:"OpcodeList3",type:"Undefined"}},Exif:{33434:{name:"ExposureTime",type:"Rational"},33437:{name:"FNumber",type:"Rational"},34850:{name:"ExposureProgram",type:"Short"},34852:{name:"SpectralSensitivity",type:"Ascii"},34855:{name:"ISOSpeedRatings",type:"Short"},34856:{name:"OECF",type:"Undefined"},34864:{name:"SensitivityType",type:"Short"},34865:{name:"StandardOutputSensitivity",type:"Long"},34866:{name:"RecommendedExposureIndex",type:"Long"},34867:{name:"ISOSpeed",type:"Long"},34868:{name:"ISOSpeedLatitudeyyy",type:"Long"},34869:{name:"ISOSpeedLatitudezzz",type:"Long"},36864:{name:"ExifVersion",type:"Undefined"},36867:{name:"DateTimeOriginal",type:"Ascii"},36868:{name:"DateTimeDigitized",type:"Ascii"},37121:{name:"ComponentsConfiguration",type:"Undefined"},37122:{name:"CompressedBitsPerPixel",type:"Rational"},37377:{name:"ShutterSpeedValue",type:"SRational"},37378:{name:"ApertureValue",type:"Rational"},37379:{name:"BrightnessValue",type:"SRational"},37380:{name:"ExposureBiasValue",type:"SRational"},37381:{name:"MaxApertureValue",type:"Rational"},37382:{name:"SubjectDistance",type:"Rational"},37383:{name:"MeteringMode",type:"Short"},37384:{name:"LightSource",type:"Short"},37385:{name:"Flash",type:"Short"},37386:{name:"FocalLength",type:"Rational"},37396:{name:"SubjectArea",type:"Short"},37500:{name:"MakerNote",type:"Undefined"},37510:{name:"UserComment",type:"Ascii"},37520:{name:"SubSecTime",type:"Ascii"},37521:{name:"SubSecTimeOriginal",type:"Ascii"},37522:{name:"SubSecTimeDigitized",type:"Ascii"},40960:{name:"FlashpixVersion",type:"Undefined"},40961:{name:"ColorSpace",type:"Short"},40962:{name:"PixelXDimension",type:"Long"},40963:{name:"PixelYDimension",type:"Long"},40964:{name:"RelatedSoundFile",type:"Ascii"},40965:{name:"InteroperabilityTag",type:"Long"},41483:{name:"FlashEnergy",type:"Rational"},41484:{name:"SpatialFrequencyResponse",type:"Undefined"},41486:{name:"FocalPlaneXResolution",type:"Rational"},41487:{name:"FocalPlaneYResolution",type:"Rational"},41488:{name:"FocalPlaneResolutionUnit",type:"Short"},41492:{name:"SubjectLocation",type:"Short"},41493:{name:"ExposureIndex",type:"Rational"},41495:{name:"SensingMethod",type:"Short"},41728:{name:"FileSource",type:"Undefined"},41729:{name:"SceneType",type:"Undefined"},41730:{name:"CFAPattern",type:"Undefined"},41985:{name:"CustomRendered",type:"Short"},41986:{name:"ExposureMode",type:"Short"},41987:{name:"WhiteBalance",type:"Short"},41988:{name:"DigitalZoomRatio",type:"Rational"},41989:{name:"FocalLengthIn35mmFilm",type:"Short"},41990:{name:"SceneCaptureType",type:"Short"},41991:{name:"GainControl",type:"Short"},41992:{name:"Contrast",type:"Short"},41993:{name:"Saturation",type:"Short"},41994:{name:"Sharpness",type:"Short"},41995:{name:"DeviceSettingDescription",type:"Undefined"},41996:{name:"SubjectDistanceRange",type:"Short"},42016:{name:"ImageUniqueID",type:"Ascii"},42032:{name:"CameraOwnerName",type:"Ascii"},42033:{name:"BodySerialNumber",type:"Ascii"},42034:{name:"LensSpecification",type:"Rational"},42035:{name:"LensMake",type:"Ascii"},42036:{name:"LensModel",type:"Ascii"},42037:{name:"LensSerialNumber",type:"Ascii"},42240:{name:"Gamma",type:"Rational"}},GPS:{0:{name:"GPSVersionID",type:"Byte"},1:{name:"GPSLatitudeRef",type:"Ascii"},2:{name:"GPSLatitude",type:"Rational"},3:{name:"GPSLongitudeRef",type:"Ascii"},4:{name:"GPSLongitude",type:"Rational"},5:{name:"GPSAltitudeRef",type:"Byte"},6:{name:"GPSAltitude",type:"Rational"},7:{name:"GPSTimeStamp",type:"Rational"},8:{name:"GPSSatellites",type:"Ascii"},9:{name:"GPSStatus",type:"Ascii"},10:{name:"GPSMeasureMode",type:"Ascii"},11:{name:"GPSDOP",type:"Rational"},12:{name:"GPSSpeedRef",type:"Ascii"},13:{name:"GPSSpeed",type:"Rational"},14:{name:"GPSTrackRef",type:"Ascii"},15:{name:"GPSTrack",type:"Rational"},16:{name:"GPSImgDirectionRef",type:"Ascii"},17:{name:"GPSImgDirection",type:"Rational"},18:{name:"GPSMapDatum",type:"Ascii"},19:{name:"GPSDestLatitudeRef",type:"Ascii"},20:{name:"GPSDestLatitude",type:"Rational"},21:{name:"GPSDestLongitudeRef",type:"Ascii"},22:{name:"GPSDestLongitude",type:"Rational"},23:{name:"GPSDestBearingRef",type:"Ascii"},24:{name:"GPSDestBearing",type:"Rational"},25:{name:"GPSDestDistanceRef",type:"Ascii"},26:{name:"GPSDestDistance",type:"Rational"},27:{name:"GPSProcessingMethod",type:"Undefined"},28:{name:"GPSAreaInformation",type:"Undefined"},29:{name:"GPSDateStamp",type:"Ascii"},30:{name:"GPSDifferential",type:"Short"},31:{name:"GPSHPositioningError",type:"Rational"}},Interop:{1:{name:"InteroperabilityIndex",type:"Ascii"}}};S["0th"]=S.Image,S["1st"]=S.Image,p.TAGS=S,p.ImageIFD={ProcessingSoftware:11,NewSubfileType:254,SubfileType:255,ImageWidth:256,ImageLength:257,BitsPerSample:258,Compression:259,PhotometricInterpretation:262,Threshholding:263,CellWidth:264,CellLength:265,FillOrder:266,DocumentName:269,ImageDescription:270,Make:271,Model:272,StripOffsets:273,Orientation:274,SamplesPerPixel:277,RowsPerStrip:278,StripByteCounts:279,XResolution:282,YResolution:283,PlanarConfiguration:284,GrayResponseUnit:290,GrayResponseCurve:291,T4Options:292,T6Options:293,ResolutionUnit:296,TransferFunction:301,Software:305,DateTime:306,Artist:315,HostComputer:316,Predictor:317,WhitePoint:318,PrimaryChromaticities:319,ColorMap:320,HalftoneHints:321,TileWidth:322,TileLength:323,TileOffsets:324,TileByteCounts:325,SubIFDs:330,InkSet:332,InkNames:333,NumberOfInks:334,DotRange:336,TargetPrinter:337,ExtraSamples:338,SampleFormat:339,SMinSampleValue:340,SMaxSampleValue:341,TransferRange:342,ClipPath:343,XClipPathUnits:344,YClipPathUnits:345,Indexed:346,JPEGTables:347,OPIProxy:351,JPEGProc:512,JPEGInterchangeFormat:513,JPEGInterchangeFormatLength:514,JPEGRestartInterval:515,JPEGLosslessPredictors:517,JPEGPointTransforms:518,JPEGQTables:519,JPEGDCTables:520,JPEGACTables:521,YCbCrCoefficients:529,YCbCrSubSampling:530,YCbCrPositioning:531,ReferenceBlackWhite:532,XMLPacket:700,Rating:18246,RatingPercent:18249,ImageID:32781,CFARepeatPatternDim:33421,CFAPattern:33422,BatteryLevel:33423,Copyright:33432,ExposureTime:33434,ImageResources:34377,ExifTag:34665,InterColorProfile:34675,GPSTag:34853,Interlace:34857,TimeZoneOffset:34858,SelfTimerMode:34859,FlashEnergy:37387,SpatialFrequencyResponse:37388,Noise:37389,FocalPlaneXResolution:37390,FocalPlaneYResolution:37391,FocalPlaneResolutionUnit:37392,ImageNumber:37393,SecurityClassification:37394,ImageHistory:37395,ExposureIndex:37397,TIFFEPStandardID:37398,SensingMethod:37399,XPTitle:40091,XPComment:40092,XPAuthor:40093,XPKeywords:40094,XPSubject:40095,PrintImageMatching:50341,DNGVersion:50706,DNGBackwardVersion:50707,UniqueCameraModel:50708,LocalizedCameraModel:50709,CFAPlaneColor:50710,CFALayout:50711,LinearizationTable:50712,BlackLevelRepeatDim:50713,BlackLevel:50714,BlackLevelDeltaH:50715,BlackLevelDeltaV:50716,WhiteLevel:50717,DefaultScale:50718,DefaultCropOrigin:50719,DefaultCropSize:50720,ColorMatrix1:50721,ColorMatrix2:50722,CameraCalibration1:50723,CameraCalibration2:50724,ReductionMatrix1:50725,ReductionMatrix2:50726,AnalogBalance:50727,AsShotNeutral:50728,AsShotWhiteXY:50729,BaselineExposure:50730,BaselineNoise:50731,BaselineSharpness:50732,BayerGreenSplit:50733,LinearResponseLimit:50734,CameraSerialNumber:50735,LensInfo:50736,ChromaBlurRadius:50737,AntiAliasStrength:50738,ShadowScale:50739,DNGPrivateData:50740,MakerNoteSafety:50741,CalibrationIlluminant1:50778,CalibrationIlluminant2:50779,BestQualityScale:50780,RawDataUniqueID:50781,OriginalRawFileName:50827,OriginalRawFileData:50828,ActiveArea:50829,MaskedAreas:50830,AsShotICCProfile:50831,AsShotPreProfileMatrix:50832,CurrentICCProfile:50833,CurrentPreProfileMatrix:50834,ColorimetricReference:50879,CameraCalibrationSignature:50931,ProfileCalibrationSignature:50932,AsShotProfileName:50934,NoiseReductionApplied:50935,ProfileName:50936,ProfileHueSatMapDims:50937,ProfileHueSatMapData1:50938,ProfileHueSatMapData2:50939,ProfileToneCurve:50940,ProfileEmbedPolicy:50941,ProfileCopyright:50942,ForwardMatrix1:50964,ForwardMatrix2:50965,PreviewApplicationName:50966,PreviewApplicationVersion:50967,PreviewSettingsName:50968,PreviewSettingsDigest:50969,PreviewColorSpace:50970,PreviewDateTime:50971,RawImageDigest:50972,OriginalRawFileDigest:50973,SubTileBlockSize:50974,RowInterleaveFactor:50975,ProfileLookTableDims:50981,ProfileLookTableData:50982,OpcodeList1:51008,OpcodeList2:51009,OpcodeList3:51022,NoiseProfile:51041},p.ExifIFD={ExposureTime:33434,FNumber:33437,ExposureProgram:34850,SpectralSensitivity:34852,ISOSpeedRatings:34855,OECF:34856,SensitivityType:34864,StandardOutputSensitivity:34865,RecommendedExposureIndex:34866,ISOSpeed:34867,ISOSpeedLatitudeyyy:34868,ISOSpeedLatitudezzz:34869,ExifVersion:36864,DateTimeOriginal:36867,DateTimeDigitized:36868,ComponentsConfiguration:37121,CompressedBitsPerPixel:37122,ShutterSpeedValue:37377,ApertureValue:37378,BrightnessValue:37379,ExposureBiasValue:37380,MaxApertureValue:37381,SubjectDistance:37382,MeteringMode:37383,LightSource:37384,Flash:37385,FocalLength:37386,SubjectArea:37396,MakerNote:37500,UserComment:37510,SubSecTime:37520,SubSecTimeOriginal:37521,SubSecTimeDigitized:37522,FlashpixVersion:40960,ColorSpace:40961,PixelXDimension:40962,PixelYDimension:40963,RelatedSoundFile:40964,InteroperabilityTag:40965,FlashEnergy:41483,SpatialFrequencyResponse:41484,FocalPlaneXResolution:41486,FocalPlaneYResolution:41487,FocalPlaneResolutionUnit:41488,SubjectLocation:41492,ExposureIndex:41493,SensingMethod:41495,FileSource:41728,SceneType:41729,CFAPattern:41730,CustomRendered:41985,ExposureMode:41986,WhiteBalance:41987,DigitalZoomRatio:41988,FocalLengthIn35mmFilm:41989,SceneCaptureType:41990,GainControl:41991,Contrast:41992,Saturation:41993,Sharpness:41994,DeviceSettingDescription:41995,SubjectDistanceRange:41996,ImageUniqueID:42016,CameraOwnerName:42032,BodySerialNumber:42033,LensSpecification:42034,LensMake:42035,LensModel:42036,LensSerialNumber:42037,Gamma:42240},p.GPSIFD={GPSVersionID:0,GPSLatitudeRef:1,GPSLatitude:2,GPSLongitudeRef:3,GPSLongitude:4,GPSAltitudeRef:5,GPSAltitude:6,GPSTimeStamp:7,GPSSatellites:8,GPSStatus:9,GPSMeasureMode:10,GPSDOP:11,GPSSpeedRef:12,GPSSpeed:13,GPSTrackRef:14,GPSTrack:15,GPSImgDirectionRef:16,GPSImgDirection:17,GPSMapDatum:18,GPSDestLatitudeRef:19,GPSDestLatitude:20,GPSDestLongitudeRef:21,GPSDestLongitude:22,GPSDestBearingRef:23,GPSDestBearing:24,GPSDestDistanceRef:25,GPSDestDistance:26,GPSProcessingMethod:27,GPSAreaInformation:28,GPSDateStamp:29,GPSDifferential:30,GPSHPositioningError:31},p.InteropIFD={InteroperabilityIndex:1},window.piexif=p}();var KfxWebSDK=KfxWebSDK||{version:"3.8.0.0.0.72",libsPath:"",resourcesPath:"",modelsPath:"",imagesPath:"",openCVCDNRepository:"",document:{/** Type of USA driver license */
MOBILE_ID:0,CHECK:1,BILL_PAY:2,PASSPORT:3},resolution:{RES_FULL_HD:"1920x1080",RES_4K:"3840x2160"},orientation:{LANDSCAPE:"LANDSCAPE",PORTRAIT:"PORTRAIT"},ERROR_CODE_STATE:0,ERROR_CODE_VALIDATION:1,ERROR_CODE_RUNTIME:2,ERROR_CODE_MEDIA:3,ERROR_CODE_CAPTURE:4,ERROR_CODE_PROCESS:5,ERROR_CODE_SELFIECAPTURE:6},Module;!function(){var e=e||{};!function(){var t="KfxWebSDK.js",i="KfxWebSDKInternal.js",n=document.getElementsByTagName("script");e.rootPath="";for(var a,r=0;r<n.length;r++){if(a=n[r].src,a.indexOf(i)>-1){e.rootPath=a.replace(i,"")+"../";break}if(a.indexOf(t)>-1){e.rootPath=a.replace(t,"");break}}}(),e.Color=function(){"use strict";function e(e){return null!==e.match(r)}function t(e){return null!==e.match(o)}function i(e){return null!==e.match(s)}function n(e){return l.indexOf(e)>=0}function a(a){return e(a)||t(a)||i(a)||n(a)}var r=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,o=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,s=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,l=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"];return{isColor:a,isHexColor:e,isRgbaColor:t,isHslaColor:i,isCss3Color:n}}(),function(){"use strict";function t(e,t){this.code=e,this.name="InternalError",this.message=t||"",this.stack=(new Error).stack}function i(e){t.call(this,KfxWebSDK.ERROR_CODE_VALIDATION,e),this.name="ValidationError"}function n(e){t.call(this,KfxWebSDK.ERROR_CODE_STATE,e),this.name="StateError"}function a(e){t.call(this,KfxWebSDK.ERROR_CODE_MEDIA,e),this.name="UserMediaError"}function r(e){t.call(this,KfxWebSDK.ERROR_CODE_CAPTURE,e),this.name="CaptureError"}function o(e){t.call(this,KfxWebSDK.ERROR_CODE_PROCESS,e),this.name="ProcessError"}function s(e){t.call(this,KfxWebSDK.ERROR_CODE_SELFIECAPTURE,e),this.name="SelfieCaptureError"}function l(e,i){var n={message:i.message,code:i instanceof t?i.code:KfxWebSDK.ERROR_CODE_RUNTIME,toString:function(){return i.message}};n.code===KfxWebSDK.ERROR_CODE_RUNTIME&&(n.stack=i.stack),e(n)}t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,i.prototype=Object.create(t.prototype),i.prototype.constructor=i,n.prototype=Object.create(t.prototype),n.prototype.constructor=n,a.prototype=Object.create(t.prototype),a.prototype.constructor=a,r.prototype=Object.create(t.prototype),r.prototype.constructor=r,o.prototype=Object.create(t.prototype),o.prototype.constructor=o,s.prototype=Object.create(t.prototype),s.prototype.constructor=s,e.InternalError=t,e.ValidationError=i,e.StateError=n,e.UserMediaError=a,e.CaptureError=r,e.ProcessError=o,e.SelfieCaptureError=s,e.report=l}(),e.EXIF=function(){"use strict";function e(e,t,i,n,a){switch(a){case 5:case 6:case 7:case 8:e.width=n,e.height=i;break;default:e.width=i,e.height=n}switch(a){case 2:t.translate(i,0),t.scale(-1,1);break;case 3:t.translate(i,n),t.rotate(Math.PI);break;case 4:t.translate(0,n),t.scale(1,-1);break;case 5:t.rotate(.5*Math.PI),t.scale(1,-1);break;case 6:t.rotate(.5*Math.PI),t.translate(0,-n);break;case 7:t.rotate(.5*Math.PI),t.translate(i,-n),t.scale(-1,1);break;case 8:t.rotate(-.5*Math.PI),t.translate(-i,0)}}return{transformCoordinate:e}}(),function(){"use strict";e.Math={},e.Math.isNaN=function(e){return void 0===Number.isNaN?isNaN(e):Number.isNaN(e)},e.Math.isFinite=function(e){return void 0===Number.isNaN?isFinite(e):Number.isFinite(e)},e.Math.getXY=function(e,t){var i=Math.floor(e/t);return[e-i*t,i]},e.Math.getIx=function(e,t,i){return t*i+e},e.Math.getLongToShortAspectRatio=function(e){return 0===e?0:e>=1?e:1/e}}(),e.Type=function(){"use strict";function t(e){return"string"==typeof e}function i(e){return t(e)&&e.length>0}function n(e){return"boolean"==typeof e}function a(e){return"number"==typeof e}function r(e){return"[object Array]"===Object.prototype.toString.call(e)}function o(e){return"[object Object]"===Object.prototype.toString.call(e)}function s(e){return"function"==typeof e}function l(e){for(var t in u)if(u.hasOwnProperty(t)&&u[t](e))return t}function c(t,i){return e.Utils.isSet(t)&&t.toString().indexOf(i)>=0}var u={string:t,number:a,array:r,object:o,"boolean":n,"function":s};return{getType:l,checkInstance:c,isString:t,isNotEmptyString:i,isNumber:a,isArray:r,isObject:o,isBoolean:n,isFunction:s}}(),e.Utils=function(){"use strict";function t(t,n){if("[object Object]"!==Object.prototype.toString.call(t))throw new e.ValidationError("Options argument is not an key - value object instance");for(var a in t){var r=n[a];if(t.hasOwnProperty(a)&&void 0!==r&&void 0!==r.type){var o=t[a],s=typeof o;if(g(o)||void 0===r["default"]||null===r["default"]||(t[a]=r["default"]),!g(o))throw new e.ValidationError("Option "+a+" is not set");var l=r.type;if("string"==typeof l&&l!==s)throw new e.ValidationError("Option "+a+" is not a "+l+" type");if("object"==typeof l&&l.indexOf(s)<0)throw new e.ValidationError("Option "+a+" is not one of the following types "+l);if("object"===s&&r.color===!0){var c=o.toString();if(c.indexOf("CanvasPattern")<0&&c.indexOf("CanvasGradient")<0)throw new e.ValidationError("Option "+a+" value "+o+" is not a gradient or pattern object")}if("string"===s&&r.color===!0&&!e.Color.isColor(o))throw new e.ValidationError("Option "+a+" value "+o+" is not a valid color representation");if(("string"===s||"number"===s)&&Array.isArray(r.options)&&r.options.indexOf(o)<0)throw new e.ValidationError("Option "+a+" value "+o+" is not one of the following: "+r.options);if("string"===s&&"[object Object]"===Object.prototype.toString.call(r.html)){var u=document.getElementById(o);if(!u)throw new e.ValidationError("Option "+a+" value "+o+" no html element with such id found");if("string"==typeof r.html.tag&&u.tagName.toLowerCase()!==r.html.tag)throw new e.ValidationError("Option "+a+" value "+o+" is not a "+r.html.tag+" element");if(r.html.hasChild===!1&&u.childElementCount>0)throw new e.ValidationError("Option "+a+" value "+o+" html element with this id is not empty, it has "+u.childElementCount+" child elements")}if("number"===s){if(e.Math.isNaN(o))throw new e.ValidationError("Option "+a+" value "+o+" is not a number");if(!e.Math.isFinite(o))throw new e.ValidationError("Option "+a+" value "+o+" is a non-finite number");var f=void 0===r.min?void 0:r.min.value,h=void 0===r.max?void 0:r.max.value,d=void 0===r.min?void 0:r.min.include,p=void 0===r.max?void 0:r.max.include;i(a,o,f,d,h,p)}}}for(var a in n){var r=n[a],o=t[a];if(n.hasOwnProperty(a))if(g(o)||void 0===r["default"]||null===r["default"]){if(!g(o)&&r.mandatory===!0)throw new e.ValidationError("Mandatory option "+a+" is not set")}else t[a]=r["default"]}}function i(t,i,n,a,r,o){if(void 0!==n||void 0!==r){var s="Option "+t+" value "+i+" must be";if(void 0!==n&&void 0!==r?s+=" in the range "+n+(a?" <= ":" < ")+"value"+(o?" <= ":" < ")+r:void 0!==n&&void 0===r?s+=(a?" >= ":" > ")+n:void 0===n&&void 0!==r&&(s+=(o?" <= ":" < ")+r),void 0!==n)if(a){if(i<n)throw new e.ValidationError(s)}else if(i<=n)throw new e.ValidationError(s);if(void 0!==r)if(o){if(i>r)throw new e.ValidationError(s)}else if(i>=r)throw new e.ValidationError(s)}}function n(e){var t={};for(var i in e)e.hasOwnProperty(i)&&("object"==typeof e[i]?t[i]=n(e[i]):t[i]=e[i]);return t}function a(e,t,i){if(void 0!==t)for(var n in e)if(e.hasOwnProperty(n))if("object"!=typeof e[n]){if(void 0===t[n]?e[n]=void 0===e[n]?i[n]:e[n]:e[n]=t[n],void 0===e[n])throw new Error("Parameter "+n+" is not defined")}else a(e[n],t[n],i[n])}function r(e,t){for(var i in e)if(e.hasOwnProperty(i)&&(e[i]=t[i],void 0===e[i]))throw new Error("Parameter "+i+" is not defined")}function o(e,t){if(void 0===e||0===Object.keys(e).length)throw new Error("Callbacks are not defined");if(void 0===t){for(var i in e)if(e.hasOwnProperty(i)&&"function"!=typeof e[i])throw new Error("Callback "+i+" is not defined")}else for(var n=0;n<t.length;n++)if("function"!=typeof e[t[n]])throw new Error("Callback "+t[n]+" is not defined")}function s(t,i){return e.Type.isNotEmptyString(i)&&Object.prototype.toString.call(t).indexOf(i)>=0}function l(t,i,n){if(void 0===i||null===i)throw new e.ValidationError("Argument "+t+" is undefined or null");if(!s(i,n))throw new e.ValidationError("Argument "+t+" is not a "+n+" instance")}function c(t,i){if(l(t,i,"ImageData"),i.width<=0||i.height<=0)throw new e.ValidationError("Argument "+t+" is image data with invalid dimensions, width and height must be > 0")}function u(t,i){if(l(t,i,"HTMLImageElement"),i.width<=0||i.height<=0)throw new e.ValidationError("Argument "+t+" is html image element with invalid dimensions, width and height must be > 0")}function f(e){return null!==e&&"undefined"!=typeof e&&0!=e.length}function h(e,t){d(e,"kfx-hidden",!t)}function d(e,t,i){if("undefined"==typeof i)return void e.classList.toggle(t);var n=i?"add":"remove";e.classList[n](t)}function p(e,t){var i=document.createElement(e);return i.className=t,i}function m(e){for(var t=0;t<e.length;++t){var i=e[t];i()}}function g(e){return void 0!==e&&null!==e}function v(t){return""!==KfxWebSDK.imagesPath?KfxWebSDK.imagesPath+"/"+t:e.rootPath+"Images/"+t}function S(t){return""!==KfxWebSDK.modelsPath?KfxWebSDK.modelsPath+"/"+t:e.rootPath+"Models/"+t}function y(t){return""!==KfxWebSDK.libsPath?KfxWebSDK.libsPath+"/"+t:e.rootPath+"Libs/"+t}function b(e){if(e)for(;e.firstChild;)e.removeChild(e.firstChild)}function C(){var e=null;e=new Date;var t=e.getUTCFullYear(),i=e.getUTCMonth()+1;1==i.length&&(i="0"+i);var n=e.getUTCDate();return 1==n.length&&(n="0"+n),t+"-"+i+"-"+n+" "+e.getUTCHours()+":"+e.getUTCMinutes()+":"+e.getUTCSeconds()+"."+e.getUTCMilliseconds()}function T(){var e=new Date,t=e.toTimeString();return t=t.substring(t.lastIndexOf("(")+1,t.lastIndexOf(")"))}function w(){var e=navigator.appVersion,t=e.substring(e.indexOf("(")+1,e.indexOf(")"));return t}function I(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function x(e){try{JSON.parse(e)}catch(t){return!1}return!0}function A(){if(/iP(hone|od|ad)/.test(navigator.platform)){var e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return[parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3]||0,10)]}}function E(){var e=(/iPad|iPhone|iPod/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&!window.MSStream;return e}function P(e,t,i,n){var a=new XMLHttpRequest;a.open("GET",t,!0),a.responseType="arraybuffer",a.onload=function(t){if(4===a.readyState)if(200===a.status)try{var r=new Uint8Array(a.response);cv.FS_createDataFile("/",e,r,!0,!1,!1),i()}catch(o){n()}else n();else n()},a.send()}function D(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e}function _(){var e={options:[],header:[navigator.platform,navigator.userAgent,navigator.appVersion,navigator.vendor,window.opera],dataos:[{name:"Windows Phone",value:"Windows Phone",version:"OS"},{name:"Windows",value:"Win",version:"NT"},{name:"iPhone",value:"iPhone",version:"OS"},{name:"iPad",value:"iPad",version:"OS"},{name:"Kindle",value:"Silk",version:"Silk"},{name:"Android",value:"Android",version:"Android"},{name:"PlayBook",value:"PlayBook",version:"OS"},{name:"BlackBerry",value:"BlackBerry",version:"/"},{name:"Macintosh",value:"Mac",version:"OS X"},{name:"Linux",value:"Linux",version:"rv"},{name:"Palm",value:"Palm",version:"PalmOS"}],databrowser:[{name:"Chrome",value:"Chrome",version:"Chrome"},{name:"Firefox",value:"Firefox",version:"Firefox"},{name:"Safari",value:"Safari",version:"Version"},{name:"Internet Explorer",value:"MSIE",version:"MSIE"},{name:"Opera",value:"Opera",version:"Opera"},{name:"BlackBerry",value:"CLDC",version:"CLDC"},{name:"Mozilla",value:"Mozilla",version:"Mozilla"}],init:function(){var e=this.header.join(" "),t=this.matchItem(e,this.dataos),i=this.matchItem(e,this.databrowser);return{os:t,browser:i}},matchItem:function(e,t){var i,n,a,r,o,s=0,l=0;for(s=0;s<t.length;s+=1)if(i=new RegExp(t[s].value,"i"),a=i.test(e)){if(n=new RegExp(t[s].version+"[- /:;]([\\d._]+)","i"),r=e.match(n),o="",r&&r[1]&&(r=r[1]),r)for(r=r.split(/[._]+/),l=0;l<r.length;l+=1)o+=0===l?r[l]+".":r[l];else o="0";return{name:t[s].name,version:parseFloat(o)}}return{name:"unknown",version:0}}},t=e.init();return t}function M(e,t,i){for(var n=0,a=t.split(" "),r="",o=0;o<a.length;o++){var s=r+a[o]+" ",l=e.measureText(s),c=l.width;c>i?(n+=1,r=a[o]+" "):r=s}return n}function O(e,t,i,n,a){var r="",o=t.split(" "),s=0,l=(a==KfxWebSDK.orientation.PORTRAIT?e.canvas.height:-e.canvas.width)-24*M(e,t,i)>>1;a==KfxWebSDK.orientation.LANDSCAPE&&e.rotate(90*Math.PI/180);for(var c=0;c<o.length;c++){var u=r+o[c]+" ",f=e.measureText(u);if(s=f.width,s>i){var h=e.measureText(r);e.fillText(r,(a==KfxWebSDK.orientation.PORTRAIT?e.canvas.width:e.canvas.height)-h.width>>1,l),r=o[c]+" ",f=e.measureText(r),s=f.width,l+=n}else r=u}e.fillText(r,(a==KfxWebSDK.orientation.PORTRAIT?e.canvas.width:e.canvas.height)-s>>1,l)}return{toggleElement:h,toggleClass:d,createElement:p,getOptions:n,setOptions:a,resetOptions:r,isSet:g,isClassInstance:s,verifyArgument:l,verifyCallbacks:o,verifyImageData:c,verifyHtmlImageElement:u,validateOptions:t,verifyString:f,notifyListeners:m,getImageUrl:v,getModelsUrl:S,getLibsUrl:y,removeAllChildren:b,getDeviceModel:w,getCurrentDateTime:C,getTimeZone:T,guid:I,isJSONValid:x,isiOSDevice:E,createFileFromUrl:P,isMobileOrTablet:D,getDeviceDetails:_,getiOSVersion:A,drawMultiLineTextOnCanvas:O}}(),e.Visibility=function(){"use strict";var e,t,i,n={hidden:"visibilitychange",webkitHidden:"webkitvisibilitychange",mozHidden:"mozvisibilitychange",msHidden:"msvisibilitychange"};for(e in n)if(e in document){t=n[e];break}var a=function(e){e&&(i=e,document.addEventListener(t,i))},r=function(){return!document[e]},o=function(){i&&document.removeEventListener(t,i)};return{addListener:a,removeListener:o,status:r}}(),e.ImageUtils=function(){"use strict";function e(e,t){var i=document.createElement("canvas");return i.width=e,i.height=t,i}function t(t,i){var n=e(t,i);return n.getContext("2d").getImageData(0,0,t,i)}function i(t){var i=e(t.width,t.height);return i.getContext("2d").putImageData(t,0,0),i}function n(t,i,n){var a=Math.sqrt(t*i/n),r=1/a,o=Math.floor(t/a),s=Math.floor(i/a),l=e(o,s),c=l.getContext("2d");return c.scale(r,r),{scaleFactor:a,context:c,width:o,height:s}}function a(e,t){var a=e.width,r=e.height,o={},s=n(a,r,t);o.scaleFactor=s.scaleFactor;var l=s.context,c=i(e);return l.drawImage(c,0,0,a,r),o.imageData=l.getImageData(0,0,s.width,s.height),o}function r(e){var t=e.mean;return o(e,Math.max(0,Math.floor(.15*t)),Math.min(255,Math.floor(.87*t)))}function o(e,t,i){jsfeat.imgproc.canny(e,e,t,i);for(var n=e.cols*e.rows,a=new Array(n),r=0;r<n;r++)a[r]=e.data[r];return a}function s(e,t){var i=new jsfeat.matrix_t(e.width,e.height,jsfeat.U8C1_t),n=new jsfeat.matrix_t(e.width,e.height,jsfeat.U8C1_t),a=new jsfeat.matrix_t(e.width,e.height,jsfeat.U8C1_t),r=e.data,o=r.length,s=e.width,l=e.height;i.resize(s,l,1),n.resize(s,l,1),a.resize(s,l,1);for(var c=i.data,u=n.data,f=a.data,h=[],d=0,p=0,m=0,g=s*l,v=0,S=0;v<o;v+=4,S++)c[S]=r[v],d+=c[S],u[S]=r[v+1],p+=u[S],f[S]=r[v+2],m+=f[S],h[S]=0;return jsfeat.imgproc.gaussian_blur(i,i,t),jsfeat.imgproc.gaussian_blur(n,n,t),jsfeat.imgproc.gaussian_blur(a,a,t),i.mean=Math.round(d/g),n.mean=Math.round(p/g),a.mean=Math.round(m/g),[i,n,a,h]}function l(e,t,i){for(var n=Number.MAX_VALUE,a=-n,r=Number.MAX_VALUE,o=-r,s=0;s<i;s++)for(var l=0;l<t;l++)e[s*t+l]>0&&(n=Math.min(n,l),a=Math.max(a,l),r=Math.min(r,s),o=Math.max(o,s));return[[n,r],[a,o]]}function c(e,t,i,n){var a=void 0===n?0:n,r=Math.ceil(Math.max(0,i[0][0]-a)),o=Math.ceil(Math.max(0,i[0][1]-a)),s=Math.floor(Math.min(e,i[1][0]+a)),l=Math.floor(Math.min(t,i[1][1]+a));return[r,o,s-r,l-o]}function u(e,t,i){if(e*t<i)throw new Error("Image size "+e+" * "+t+" is less than required "+i)}return{adaptiveCanny:r,getRgbWithBlur:s,getScalingData:n,scaleToPixelSize:a,createEmptyCanvas:e,convertImageDataToCanvas:i,createEmptyImageData:t,getROICropData:c,getBound:l,checkMinSize:u}}(),function(){"use strict";e.LineUtils={},e.LineUtils.getDivineAngle=function(t,i,n){var a=e.LineUtils.getLinesAngle(i,t),r=e.LineUtils.getLinesAngle(n,t);return Math.min(Math.abs(a-r),Math.abs(180-a-r))},e.LineUtils.getParallelLineByPoint=function(t,i){return i.checkPoint(t)?i:new e.LinePolar(t[0]*i.cos+t[1]*i.sin,i.angle)},e.LineUtils.getPointsOnLineByLengthFromAnotherPoint=function(e,t,i){var n=t[0],a=t[1];if(e.isHorizontal)return[[n-i,a],[n+i,a]];if(e.isVertical)return[[n,a-i],[n,a+i]];var r=e.k,o=e.b,s=o-a,l=r*r+1,c=2*(s*r-n),u=s*s+n*n-i*i,f=Math.sqrt(c*c-4*l*u),h=(-c+f)/(2*l),d=r*h+o,p=(-c-f)/(2*l),m=r*p+o;return[[h,d],[p,m]]},e.LineUtils.getLinesDistance=function(e,t){var i;return i=e.north&&t.south||t.north&&e.south?Math.abs(t.rho)+Math.abs(e.rho):Math.abs(Math.abs(t.rho)-Math.abs(e.rho))},e.LineUtils.getLinePolarByPoints=function(t,i){if(i[0]===t[0])return new e.LinePolar(t[0],0);if(i[1]===t[1])return new e.LinePolar(t[1],Math.PI/2);var n=(i[1]-t[1])/(i[0]-t[0]),a=Math.atan(n)+Math.PI/2,r=i[1]-n*i[0],o=r*Math.sin(a);return new e.LinePolar(o,a)},e.LineUtils.getLinesAngle=function(e,t){var i=Math.abs(e.t-t.t);return Math.min(i,180-i)},e.LineUtils.getLinesByAngle=function(e,t,i){for(var n,a=[],r=0;r<e.length;r++)n=Math.abs(e[r].t-t),Math.min(n,180-n)<=i&&a.push(e[r]);return a}}(),function(){"use strict";e.PointUtils={};var t=function(e,t){var i=e[0]-t[0],n=e[1]-t[1];return i*i+n*n},i=function(e,i){return Math.sqrt(t(e,i))};e.PointUtils.getDistance=i,e.PointUtils.getSquareDistance=t,e.PointUtils.getBound=function(e){for(var t,i,n,a=Number.MAX_VALUE,r=-a,o=Number.MAX_VALUE,s=-o,l=0;l<e.length;l++)t=e[l],i=t[0],n=t[1],a=Math.min(a,i),r=Math.max(r,i),o=Math.min(o,n),s=Math.max(s,n);return[[a,o],[r,s]]},e.PointUtils.roundToPoint=function(e,i){for(var n,a,r=Math.floor(e[0]),o=Math.ceil(e[0]),s=Math.floor(e[1]),l=Math.ceil(e[1]),c=[[r,s],[r,l],[o,s],[o,l]],u=0,f=Number.MAX_VALUE;u<c.length;u++)a=t(c[u],i),f>a&&(n=c[u],f=a);return n},e.PointUtils.getOutOfSpaceLength=function(e,t,i){var n=e[0],a=e[1];return Math.max(n<0?-n:n>t?n-t:0,a<0?-a:a>i?a-i:0)},e.PointUtils.scale=function(e,t){return void 0===t&&(t=1),[t*e[0],t*e[1]]},e.PointUtils.scaleAll=function(t,i){for(var n=[],a=e.PointUtils.scale,r=0;r<t.length;r++)n.push(a(t[r],i));return n},e.PointUtils.equals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},e.PointUtils.approximatePointToLineDistance=function(e,t,i){return(t[0]-e[0])*(i[1]-e[1])-(t[1]-e[1])*(i[0]-e[0])},e.PointUtils.subtract=function(e,t){var n=i(e,t);return[(e[0]-t[0])/n,(e[1]-t[1])/n]},e.PointUtils.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]}}(),function(){"use strict";function t(){this.shutterSound=document.createElement("audio"),this.shutterSound.onloadeddata=function(){i=!0};var e=this,t=function(){i||e.shutterSound.load(),window.removeEventListener("keydown",t),window.removeEventListener("mousedown",t),window.removeEventListener("touchstart",t)};window.addEventListener("keydown",t),window.addEventListener("mousedown",t),window.addEventListener("touchstart",t)}var i=!1;t.prototype.playShutterSound=function(){""!==KfxWebSDK.resourcesPath?this.shutterSound.src=KfxWebSDK.resourcesPath+"/shutter.mp3":this.shutterSound.src=e.rootPath+"Resources/shutter.mp3",i||this.shutterSound.load(),this.shutterSound.play()},t.prototype.pauseShutterSound=function(){this.shutterSound.pause()},e.AutoLoadAudio=t}(),e.Resources=function(){"use strict";function t(e,t){o?r.enumerateDevices().then(i.bind(arguments))["catch"](t):a?MediaStreamTrack.getSources(n.bind(arguments)):t()}function i(e){for(var t,i,n,a=0,r=0,o=0;o<e.length;o++)if(n=e[o],"videoinput"===n.kind){if(a++,t=n.deviceId,void 0===n.label||0===n.label.length){r++;continue}(n.label.toLowerCase().indexOf("back")>=0||n.label.toLowerCase().indexOf("rear")>=0)&&(i=n.deviceId)}var s=void 0===i?t:i;this[0](s,a>0&&a===r)}function n(e){for(var t,i,n,a=0;a<e.length;a++)n=e[a],"video"===n.kind&&(t=n.id,"environment"===n.facing&&(i=n.id));var r=void 0===i?t:i;this[0](r,!1)}var a,r=navigator.mediaDevices,o=void 0!==r&&e.Type.isFunction(r.enumerateDevices);try{a=e.Type.isFunction(MediaStreamTrack.getSources)}catch(s){a=!1}return{load:t}}(),function(){"use strict";function t(e){this.stream=e,this.firefoxStreamTimeout=null}function i(e,t){var i=this,n=i.stream.currentTime;i.firefoxStreamTimeout=setTimeout(function(){(n===i.stream.currentTime?t:e)(),i.firefoxStreamTimeout=null},100)}var n="Camera has been disabled because of security policies";t.prototype.configure=function(e,t,a){try{e.srcObject=this.stream}catch(r){e.src=compatibility.URL.createObjectURL(this.stream)}var o=this,s=o.stream;e.onloadedmetadata=function(r){if(null!=o.stream){if(s.active===!1)return void a(n);if(void 0===s.active&&void 0!==s.currentTime){var l=function(){t(e.videoWidth,e.videoHeight)},c=function(){a(n)};return void i(l,c).call(o)}t()}}},t.prototype.destroy=function(){if(this.stream)for(var e=this.stream.getTracks(),t=0;t<e.length;t++)e[t].stop();this.firefoxStreamTimeout&&clearTimeout(this.firefoxStreamTimeout),this.stream=null,this.firefoxStreamTimeout=null},e.Stream=t}(),function(){function t(e){this.video=e,this.stream=null}function i(){var e=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return e?parseInt(e[2],10):61}function n(){return window.navigator.userAgent.indexOf("Windows")!=-1}function a(t,l){if(c>=s.length)return void l(p?v:g);var u=s[c],h={video:{mandatory:{minWidth:p&&void 0===o?2*u.width:u.width,minHeight:p&&void 0===o?2*u.height:u.height}},audio:!1};navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&i()>60&&!n()?h={video:{width:{exact:p&&void 0===o?2*u.width:u.width},height:{exact:p&&void 0===o?2*u.height:u.height},facingMode:{exact:"environment"},deviceId:{exact:r}},audio:!1}:void 0===r||f?(r&&(h.video.optional=[{sourceId:r}]),h.video.facingMode={exact:"environment"}):h.video.optional=[{sourceId:r}];var d=this,S=function(i){setTimeout(function(){return p===!0&&void 0===o&&(o=!0),d.stream=new e.Stream(i),console.log("Stream active is "+i.active),p===!0&&i.active===!1&&m===!0?(console.log("Stream active is "+i.active),d.stream.destroy(),d.stream=null,void a.call(d,t,l)):void d.stream.configure(d.video,t,l)},1e3)},y=function(e){return p===!0&&void 0===o&&(o=!1),p===!0&&o===!1&&m===!0?void a.call(d,t,l):(c++,void a.call(d,t,l))};try{compatibility.getUserMedia(h,S,y)}catch(b){y()}}var r,o,s=[{width:1920,height:1080}],l=[{width:640,height:480}],c=0,u=0,f=!1,h=!1,d=!1,p=!1,m=!1,g="Camera can not be configured for FHD resolution",v="Camera can not be configured for 4K resolution",S="Camera can not be configured for 640*480 resolution";t.prototype.configure=function(t,i,n,s){if(p!==n&&(c=0,h=!1,d=!1),n&&(o=void 0),h)return void i(p?v:g);var l=this;p=n,m=s,d?a.call(l,t,i):e.Resources.load(function(e,n){r=e,f=n,d=!0,a.call(l,t,i)},function(){h=!0,d=!0})},t.prototype.configureForSelfie=function(t,i){if(u>=l.length)return void i(S);var n=l[u],a={video:{facingMode:{exact:"user"},width:n.width,height:n.height},audio:!1},r=this,o=function(n){r.stream=new e.Stream(n),r.stream.configure(r.video,t,i)},s=function(e){u++,r.configureForSelfie(t,i)};try{compatibility.getUserMedia(a,o,s)}catch(c){s(c)}},t.prototype.destroy=function(){null!==this.stream&&this.stream.destroy(),this.stream=null,this.video.pause(),this.video.srcObject=null,this.video.src="",this.video=null},e.UserMediaManager=t}(),function(){"use strict";function t(e){removeEventListener("deviceorientation",t,!1),n=e&&null!==e.alpha}function i(){function e(e){if(e=Math.abs(e),e>90&&(e=180-e),e<0||e>90)throw new Error("LevelSensor: wrong angle calculations");return e}function i(t){for(var i=e(t.beta),n=e(t.gamma),a=Math.max(i,n),r=0;r<u.length;++r){var o=u[r];o({angle:a,beta:t.beta,gamma:t.gamma})}}function a(){addEventListener("deviceorientation",i,!1)}function r(){removeEventListener("deviceorientation",i,!1)}function o(e){u.indexOf(e)===-1&&(u.push(e),n?1===u.length&&a():e(null))}function s(e){var t=u.indexOf(e);t!==-1&&(u.splice(t,1),0===u.length&&r())}function l(){DeviceOrientationEvent.requestPermission().then(function(e){"granted"==e?(addEventListener("deviceorientation",t,!1),1===u.length&&a()):n=!1})["catch"]()}function c(){return n}var u=[];this.addListener=o,this.removeListener=s,this.requestPermission=l,this.getIsAvailable=c}var n=null;addEventListener("deviceorientation",t,!1),"function"==typeof DeviceOrientationEvent.requestPermission&&DeviceOrientationEvent.requestPermission().then(function(e){"granted"!=e&&(n=!1)})["catch"](function(){n=null}),e.LevelSensor=i}(),e.AppStats=function(){"use strict";function s(){this.SessionKey=null,this.EnvironmentID="",this.DismissalTime="",this.InstanceID="",this.InstanceType=null,this.CreationTime=null}function l(){function e(){this.Environments=[],this.SessionEvents=[],this.Images=[],this.Instances=[],this.CaptureEvents=[],this.FieldChangeEvents=[],this.ImageProcessorEvents=[]}this.AppStatisticsVersion="",this.AppStatisticsTables=new e}function c(){this.Type="",this.SessionKey="test",this.EnvironmentID="",this.DocumentID=null,this.Category="",this.Response="",this.EventTime="",this.ID=""}function u(){this.OSVersion="",this.Carrier="",this.Model="",this.SDKVersion="",this.OSName="HTML5",this.TimeZone="",this.Memory="",this.Language="",this.Manufacturer="",this.ID="",this.DeviceID=""}function S(e){if(d&&d.length>0)for(var t=0;t<d.length;t++)e.AppStatisticsTables.Environments.push(d[t])}function b(e){if(p&&p.length>0)for(var t=0;t<p.length;t++)e.AppStatisticsTables.SessionEvents.push(p[t])}function T(e){if(y&&y.length>0)for(var t=0;t<y.length;t++)e.AppStatisticsTables.Images.push(y[t])}function I(e){if(m&&m.length>0)for(var t=0;t<m.length;t++)e.AppStatisticsTables.Instances.push(m[t])}function x(e){if(v&&v.length>0)for(var t=0;t<v.length;t++)e.AppStatisticsTables.CaptureEvents.push(v[t])}function E(e){if(g&&g.length>0)for(var t=0;t<g.length;t++)e.AppStatisticsTables.FieldChangeEvents.push(g[t])}function P(e){if(C&&C.length>0)for(var t=0;t<C.length;t++)e.AppStatisticsTables.ImageProcessorEvents.push(C[t])}var _=null,M=function(e,t){d&&d.length>0&&(d=[]),d.push(R()),D=A.APP_STATS_INITIALIZED,"function"==typeof e&&e(D)},O=function(a,r,o){var s=new c;s.Type=a,s.SessionKey=t,s.EnvironmentID=n,o?s.DocumentID=o:s.DocumentID="",s.Category=i,s.Response=r,s.EventTime=e.Utils.getCurrentDateTime(),s.ID=e.Utils.guid(),"BeginSession"===a&&(f=s.ID),p.push(s)},L=function(e,t){var i=new l;i.AppStatisticsVersion=KfxWebSDK.version,S(i),b(i),T(i),I(i),x(i),E(i),P(i),"function"==typeof e&&(D=A.APP_STATS_INITIALIZED,e(i),F())},R=function(){return _=new u,_.OSVersion="",_.Carrier="",_.Model=e.Utils.getDeviceModel(),_.SDKVersion=KfxWebSDK.version,_.OSName="HTML5",_.TimeZone=e.Utils.getTimeZone(),_.Memory="",_.Language=navigator.language,_.Manufacturer="",_.ID=e.Utils.guid(),_.DeviceID="",n=_.ID,_},k=function(i){if(h){var l=new s;t?l.SessionKey=t:l.SessionKey="",l.EnvironmentID=n,l.DismissalTime="",l.InstanceID=e.Utils.guid(),i&&(l.InstanceType=i,i===w.CAPTURE?a=l.InstanceID:i===w.PROCESS?o=l.InstanceID:i===w.SELFIE_CAPTURE&&(r=l.InstanceID)),l.CreationTime=e.Utils.getCurrentDateTime(),m.push(l)}},F=function(){p&&p.length>0&&(p=[]),m&&m.length>0&&(m=[]),d&&d.length>0&&(d=[]),f="",e.CaptureEventAppStats.cleanUpData(),e.LogisticsEventAppStats.cleanUpData(),e.SelfieCaptureEventAppStats.cleanUpData(),e.ProcessEventAppStats.cleanUpData()};return{initAppStats:M,logSessionEvent:O,exportAppStats:L,prepareEnvironment:R,prepareInstance:k,cleanUpData:F}}();var t,i,n,a,r,o,s,l,c,u,f,h=!1,d=[],p=[],m=[],g=[],v=[],S=[],y=[],b=[],C=[],T={BITONAL:"Process Bitonal",AUTOCROP:"Process AutoCrop",SETDPI:"Process SetDPI",SCALE:"Process Scale"},w={CAPTURE:"Image Capture",PROCESS:"Image Processor",SELFIE_CAPTURE:"Selfie Capture"},I={ADVANCE_CAPTURE:"Web Capture",CAPTURE_FALLBACK:"CaptureFallback",FORCE_TAKE_PICTURE:"Force Take Picture"},x={ADVANCE_CAPTURE:"Selfie Capture",SELFIE_FALLBACK:"SelfieFallback",FORCE_TAKE_SELFIE:"Force Take Selfie"};e.CaptureEventAppStats=function(){"use strict";function i(){this.EventType=null,this.SessionKey=null,this.ImageID=null,this.Value="",this.EventTime="",this.InstanceID="",this.ID=""}function r(){this.SessionKey="",this.EnvironmentID="",this.StoragePath="",this.DocumentID=null,this.FileSize="",this.Source=null,
this.ID="",this.CreationTime=null}function o(){y&&y.length>0&&(y=[]),v&&v.length>0&&(v=[])}var s=function(n,r,o){if(h){var s=new i;n&&(s.EventType=n),t?s.SessionKey=t:s.SessionKey="",r?s.ImageID=r:s.ImageID="",o?s.Value=o:s.Value="",s.EventTime=e.Utils.getCurrentDateTime(),s.InstanceID=a,s.ID=e.Utils.guid(),v&&v.push(s)}},l=function(i,a,o,s){if(h){var l=new r;t?l.SessionKey=t:l.SessionKey="",n?l.EnvironmentID=n:l.EnvironmentID="",o?l.StoragePath=o:l.StoragePath="",l.DocumentID="",s?l.FileSize=s:l.FileSize="",a?l.Source=a:l.Source="",i?l.ID=i:l.ID="",l.CreationTime=e.Utils.getCurrentDateTime(),y&&y.push(l)}},c=function(t,i,n){h&&(t===e.Hints.FILL_AREA?s("FILL_AREA",i,1):t===e.Hints.ZOOM_IN?s("ZOOM_IN",i,1):t===e.Hints.ZOOM_OUT?s("ZOOM_OUT",i,1):t===e.Hints.CENTER?s("CENTER",i,1):t===e.Hints.ROTATE?s("ROTATE",i,1):t===e.Hints.HOLD_LEVEL?s("HOLD_LEVEL",i,1):t===e.Hints.HOLD_STEADY?s("HOLD_STEADY",i,1):t===e.Hints.CAPTURE_OK&&s("CAPTURE_OK",i,1))};return{logCaptureGuidanceEvents:c,logAppStats:s,logImageObject:l,cleanUpData:o}}(),e.LogisticsEventAppStats=function(){"use strict";function t(){this.IsValid="",this.ErrorDescription="",this.FormattingFailed=null,this.SessionEventID="",this.DocumentID="",this.FieldName="",this.EventTime="",this.ID="",this.OriginalValue="",this.Confidence=null,this.ChangedValue=""}function i(){g&&g.length>0&&(g=[])}var n=function(i){if(h&&(e.Utils.validateOptions(i,{IsValid:{type:"number",mandatory:!0,min:{value:0,include:!0},max:{value:1,include:!0}},ErrorDescription:{type:"string",mandatory:!1},DocumentID:{type:"string",mandatory:!0},FieldName:{type:"string",mandatory:!0},OriginalValue:{type:"string",mandatory:!0},Confidence:{type:"number",mandatory:!0,min:{value:0,include:!0},max:{value:100,include:!0}},ChangedValue:{type:"string",mandatory:!0}}),i)){var n=new t;n.IsValid=i.IsValid,i.ErrorDescription?n.ErrorDescription=i.ErrorDescription:n.ErrorDescription="",n.FormattingFailed="",f?n.SessionEventID=f:n.SessionEventID="",i.DocumentID?n.DocumentID=i.DocumentID:n.DocumentID="",i.FieldName?n.FieldName=i.FieldName:n.FieldName="",n.EventTime=e.Utils.getCurrentDateTime(),n.ID=e.Utils.guid(),i.OriginalValue?n.OriginalValue=i.OriginalValue:n.OriginalValue="",n.Confidence=i.Confidence,i.ChangedValue?n.ChangedValue=i.ChangedValue:n.ChangedValue="",g&&g.push(n)}};return{logAppStats:n,cleanUpData:i}}(),e.ProcessEventAppStats=function(){"use strict";function i(){this.StartTime=null,this.ProcessingProfile="",this.SessionKey=null,this.StopTime=null,this.ResultCode="",this.ProcessedImageID="",this.InstanceID="",this.ID="",this.SourceImageID=""}function n(){C&&C.length>0&&(C=[])}var a=function(t){h&&(e.AppStats.prepareInstance(w.PROCESS),t===T.BITONAL?s=e.Utils.getCurrentDateTime():t===T.AUTOCROP?l=e.Utils.getCurrentDateTime():t===T.SETDPI?c=e.Utils.getCurrentDateTime():t===T.SCALE&&(u=e.Utils.getCurrentDateTime()))},r=function(n){if(h&&(e.CaptureEventAppStats.logImageObject("","Image",""),n)){var a=new i;n.ProcessingProfile===T.BITONAL?a.StartTime=s:n.ProcessingProfile===T.AUTOCROP?a.StartTime=l:n.ProcessingProfile===T.SETDPI?a.StartTime=c:n.ProcessingProfile===T.SCALE&&(a.StartTime=u),n.ProcessingProfile?a.ProcessingProfile=n.ProcessingProfile:a.ProcessingProfile="",t?a.SessionKey=t:a.SessionKey="",a.StopTime=e.Utils.getCurrentDateTime(),n.ResultCode?a.ResultCode=n.ResultCode:a.ResultCode="",n.ProcessedImageID?a.ProcessedImageID=n.ProcessedImageID:a.ProcessedImageID="",a.InstanceID=o,n.SourceImageID?a.SourceImageID=n.SourceImageID:a.SourceImageID="",a.ID=e.Utils.guid(),C&&C.push(a)}};return{ImageProcessorEventJSON:i,logProcessStartTime:a,logAppStats:r,cleanUpData:n}}(),e.SelfieCaptureEventAppStats=function(){"use strict";function i(){this.EventType=null,this.SessionKey=null,this.ImageID=null,this.Value="",this.EventTime="",this.InstanceID="",this.ID=""}function a(){this.SessionKey="",this.EnvironmentID="",this.StoragePath="",this.DocumentID=null,this.FileSize="",this.Source=null,this.ID="",this.CreationTime=null}function o(){b&&b.length>0&&(b=[]),S&&S.length>0&&(S=[])}var s=function(n,a,o){if(h){var s=new i;n&&(s.EventType=n),t?s.SessionKey=t:s.SessionKey="",a?s.ImageID=a:s.ImageID="",o?s.Value=o:s.Value="",s.EventTime=e.Utils.getCurrentDateTime(),s.InstanceID=r,s.ID=e.Utils.guid(),v&&S.push(s)}},l=function(i,r,o,s){if(h){var l=new a;t?l.SessionKey=t:l.SessionKey="",n?l.EnvironmentID=n:l.EnvironmentID="",o?l.StoragePath=o:l.StoragePath="",l.DocumentID="",s?l.FileSize=s:l.FileSize="",r?l.Source=r:l.Source="",i?l.ID=i:l.ID="",l.CreationTime=e.Utils.getCurrentDateTime(),b&&b.push(l)}},c=function(t,i,n){h&&(t===e.Hints.CENTER_FACE?s("CENTER_FACE",i,1):t===e.Hints.BLINK_NOW?s("BLINK_NOW",i,1):t===e.Hints.HOLD_STEADY?s("HOLD_STEADY",i,1):t===e.Hints.CAPTURE_OK&&s("CAPTURE_OK",i,1))};return{logSelfieCaptureGuidanceEvents:c,logAppStats:s,logImageObject:l,cleanUpData:o}}(),function(){function t(){this.state=r}var i="STATE_CREATED",n="STATE_STARTED",a="STATE_STOPPED",r="STATE_DESTROYED",o={create:[r],setOptions:[i,a],forceTakePicture:[n],forceTakeSelfie:[n],choosePictureAsBase64:[i,a],takePicture:[i,a],takeSelfie:[i,a],stopCapture:[n],destroy:[i,a]};t.prototype.setCreatedState=function(){this.state=i},t.prototype.setStartedState=function(){this.state=n},t.prototype.setStoppedState=function(){this.state=a},t.prototype.setDestroyedState=function(){this.state=r},t.prototype.checkAction=function(t){if(o[t].indexOf(this.state)<0)throw new e.StateError("Call "+t+" is not allowed in state "+this.state)},e.StateManager=t}(),function(){"use strict";function t(e){this._image=e}function i(){}function n(){this._alphaExtractor=new i}function a(e){this._image=e,this._alphaExtractor=new i,this._sizeCalculator=new r(e)}function r(e){this._image=e,this._alphaExtractor=new i,this._width=null,this._height=null}function o(e,t){this._blob=e,this._options=t,this._subsamplingDetector=new n}var s=window.URL||window.webkitURL;t.prototype.draw=function(e,t,i){e.drawImage(this._image,0,0,t,i)},t.prototype.naturalWidth=function(){return this._image.naturalWidth},t.prototype.naturalHeight=function(){return this._image.naturalHeight},i.prototype.extract=function(e,t,i,n,a){var r=document.createElement("canvas");r.width=n,r.height=a;var o=r.getContext("2d");o.drawImage(e,-t,-i);for(var s=o.getImageData(0,0,r.width,r.height),l=s.data,c=new Uint8ClampedArray(n*a),u=3,f=0;u<l.length;u+=4,f+=1)c[f]=l[u];return o.clearRect(0,0,r.width,r.height),o=null,r=null,c},n.prototype.isSubsampled=function(e,t){if(!this._isIos())return!1;if("image/jpeg"!==t)return!1;var i=this._alphaExtractor,n=e.naturalWidth,a=e.naturalHeight;if(n*a<=1048576)return!1;var r=i.extract(e,n-1,a-1,1,1);return 0===r[0]},n.prototype._isIos=function(){return window.navigator&&window.navigator.platform&&/iP(hone|od|ad)/.test(window.navigator.platform)},a.prototype.hasData=function(){var e=this._alphaExtractor.extract(this._image,0,0,1,1);return e[0]>0},a.prototype.width=function(){return this._sizeCalculator.width()},a.prototype.height=function(){return this._sizeCalculator.height()},a.prototype.scale=function(){var e=this.width()/this._image.naturalWidth,t=this.height()/this._image.naturalHeight;return Math.min(e,t)},a.prototype.naturalWidth=function(){return this._image.naturalWidth*this.scale()},a.prototype.naturalHeight=function(){return this._image.naturalHeight*this.scale()},a.prototype.draw=function(e){e.drawImage(this._image,0,0,this.width(),this.height(),0,0,this.naturalWidth(),this.naturalHeight())},r.prototype.width=function(){if(null===this._width){var e=this._alpha(0,0,this._image.width,1);this._width=this._size(e)}return this._width},r.prototype.height=function(){if(null===this._height){var e=this._alpha(0,0,1,this._image.height);this._height=this._size(e)}return this._height},r.prototype._size=function(e){for(var t=e.length-1;t>=0;t-=1)if(0!==e[t])return t+1;return 0},r.prototype._alpha=function(e,t,i,n){return this._alphaExtractor.extract(this._image,e,t,i,n)},o.prototype._urlUsingFileReader=function(e,t){var i=new FileReader;i.onload=function(t){e(t.target.result)},i.onerror=function(e){t(e.target.error)},i.readAsDataURL(this._blob)},o.prototype._url=function(e,t){return s?e(s.createObjectURL(this._blob)):this._urlUsingFileReader(e,t)},o.prototype._revokeUrl=function(e){s&&s.revokeObjectURL(e)},o.prototype._exifData=function(e,t){var i=this._blob;EXIF.getData(i,function(){var t=i.exifdata;e(t)})},o.prototype._image=function(e,t){function i(i){var a=new Image;a.onload=function(){n._revokeUrl(i),e(a)},a.enerror=function(){var e=new Error("Unable to load image");t(e)},a.src=i}var n=this;this._url(i,t)},o.prototype.imageData=function(i,n){function r(n,r){var o=c.isSubsampled(n,s.type);n=o?new a(n):new t(n);var u=document.createElement("canvas"),f=u.getContext("2d"),h=n.naturalWidth(),d=n.naturalHeight(),p=2;"number"==typeof l.downscaleSize&&(p=l.downscaleSize);var m=1024*p*1024,g=h*d;if(g>m){var v=Math.sqrt(m/g);h*=v,d*=v}e.EXIF.transformCoordinate(u,f,h,d,r),n.draw(f,h,d);var S=f.getImageData(0,0,u.width,u.height);return f.clearRect(0,0,u.width,u.height),u.width=0,u.height=0,f=null,u=null,i(S)}var o=this,s=this._blob,l=this._options,c=this._subsamplingDetector;o._exifData(function(e){var t=e.Orientation;o._image(function(e){r(e,t)},n)},n)},e.BlobConverter=o}(),e.CaptureFallback=function(){"use strict";function t(t,i,n){(l||"STATE_STOPPED"===c.state)&&a(),c.checkAction("create"),o=document.createElement("input"),o.setAttribute("accept","image/*"),"camera"===t.preference&&o.setAttribute("capture",t.preference),o.setAttribute("type","file"),s=new e.FileInputCapture(o,t),c.setCreatedState(),i()}function i(e,t){function i(){r(),e.apply(this,arguments)}function n(){r(),t.apply(this,arguments)}l&&r(),c.checkAction("takePicture"),l=!0,s.start(i,n),c.setStartedState(),o.click()}function n(e,t){l&&r(),c.checkAction("choosePictureAsBase64"),s.setBase64Format(),i(e,t)}function a(){l&&r(),c.checkAction("destroy"),null!==s&&(s=null),o=null,c.setDestroyedState()}function r(){c.checkAction("stopCapture"),s.stop(),l=!1,c.setStoppedState()}var o=null,s=null,l=!1,c=new e.StateManager;return{configure:t,choosePicture:i,choosePictureAsBase64:n,destroy:a}}(),function(){"use strict";function t(){var t=e.Utils.createElement("div","kfx-layout kfx-capture"),a=new i;t.appendChild(a.element);var r=new n;t.appendChild(r.element),this.element=t,this.videoView=a,this.canvas=a.canvas,this.video=a.video,this.toolbarView=r}function i(){var t=document.createElement("div");t.className="kfx-content";var i=document.createElement("div"),n=document.createElement("video");n.setAttribute("playsinline",!0),i.appendChild(n);var a=document.createElement("canvas");e.Utils.isiOSDevice()?a.setAttribute("role","img"):a.setAttribute("role",""),a.setAttribute("aria-live","assertive"),i.appendChild(a),t.appendChild(i),this.element=t,this.canvas=a,this.video=n}function n(){function t(e,t){var n=i("button","kfx-button "+e),a=i("div","kfx-icon");return a.style.backgroundImage=t,n.appendChild(a),n}var i=e.Utils.createElement,n=i("div","kfx-toolbar kfx-invisible"),a=t("kfx-force-capture","url("+e.Utils.getImageUrl("camera_icon.png")+")");n.appendChild(a);var r=t("kfx-gallery","url("+e.Utils.getImageUrl("gallery_icon.png")+")");n.appendChild(r);var o=i("input","kfx-hidden");o.type="file",o.accept="image/*",r.addEventListener("click",function(){var e=new MouseEvent("click",{});o.dispatchEvent(e)}),n.appendChild(o),this.element=n,this.forceCaptureButton=a,this.forceCaptureTimeoutId=null,this.galleryButton=r,this.galleryInput=o}t.prototype.resize=function(){this.videoView.resize()},t.prototype.stop=function(e){this.stopToolbar()},t.prototype.startToolbar=function(e){this.toolbarView.start(e)},t.prototype.stopToolbar=function(e){this.toolbarView.stop()},t.prototype.enableToolbar=function(){this.toolbarView.enable()},t.prototype.disableToolbar=function(){this.toolbarView.disable()},i.prototype.resize=function(){var e=this.element.clientWidth,t=this.element.clientHeight;if(0!==e&&0!==t){var i=this.video.videoWidth,n=this.video.videoHeight;if(0===i||0===n)return this.canvas.width=e,this.canvas.height=t,this.video.width=e,void(this.video.height=t);var a=e/i,r=t/n,o=Math.min(a,r),s=i*o|0,l=n*o|0;this.canvas.width===s&&this.canvas.height===l||(this.canvas.width=s,this.canvas.height=l,this.video.width=s,this.video.height=l)}},n.prototype.start=function(t){this.setUpForceCapture(t.forceCapture),e.Utils.toggleElement(this.galleryButton,t.gallery),this.enable()},n.prototype.stop=function(e){this.disable(),clearTimeout(this.forceCaptureTimeoutId),this.forceCaptureTimeoutId=null},n.prototype.enable=function(){e.Utils.toggleClass(this.element,"kfx-invisible",!1)},n.prototype.disable=function(){e.Utils.toggleClass(this.element,"kfx-invisible",!0)},n.prototype.setUpForceCapture=function(e){var t=this.enableForceCaptureButton.bind(this),i="number"==typeof e&&e,n=e===!0||0===i;t(n),i&&(this.forceCaptureTimeoutId=setTimeout(t,1e3*i))},n.prototype.enableForceCaptureButton=function(t){t="undefined"==typeof t||t,e.Utils.toggleElement(this.forceCaptureButton,t)},e.CaptureView=t}(),function(){"use strict";function t(e){function t(e){(!e||e.angle>i)&&(s=!1,a())}function n(){s=!0,o.addListener(t)}function a(){s=!1,o.removeListener(t)}function r(){return s}var o=e,s=!1;this.start=n,this.stop=a,this.isNeeded=r}var i=45;e.ContinuousCaptureReset=t}(),function(){"use strict";function t(t){function i(){f||(f=!0,e.Utils.notifyListeners(c))}function n(){f&&(f=!1,e.Utils.notifyListeners(u))}function a(e){c.push(e)}function r(e){u.push(e)}function o(){t.addEventListener("click",i),t.addEventListener("change",n),document.body.addEventListener("focus",n,!0),f=!1}function s(){t.removeEventListener("click",i),t.removeEventListener("change",n),document.body.removeEventListener("focus",n,!0)}function l(){f=!1}var c=[],u=[],f=!1;this.onOpen=a,this.onClose=r,this.start=o,this.stop=s,this.resetIsOpen=l}function i(i,n){function a(e){var t=e.target,i=t.files;i.length&&(u(i[0]),t.value="")}function r(t){t.id=e.Utils.guid(),e.CaptureEventAppStats.logImageObject(t.id,"Image","",t.data.length),e.CaptureEventAppStats.logAppStats("Image Captured",t.id,1),v(t)}function o(e,t){var i=new FileReader;i.onload=function(e){t(e.target.result)},i.readAsDataURL(e)}function s(e,t){var i=new Image;i.onload=function(){EXIF.getData(i,function(){var e=i.exifdata;w=e.Orientation}),t(i)},i.src=e}function l(t){var i=document.createElement("canvas"),n=t.naturalWidth,a=t.naturalHeight;return n>a&&e.Utils.isiOSDevice()&&6===w?(T=!0,I=90,i.width=a,i.height=n):n>a&&e.Utils.isiOSDevice()&&8===w?(T=!0,I=-90,i.width=a,i.height=n):a>n&&e.Utils.isiOSDevice()&&3===w?(T=!0,I=180,i.width=a,i.height=n):(T=!1,i.width=n,i.height=a),i}function c(e){o(e,function(e){s(e,function(e){var t=l(e),i=t.getContext("2d");T?(6===w?i.translate(t.width,0):3===w?i.translate(t.width,t.height):i.translate(0,t.height),i.rotate(I*Math.PI/180),i.drawImage(e,0,0,i.canvas.height,i.canvas.width)):i.drawImage(e,0,0,t.width,t.height);var n=i.getImageData(0,0,t.width,t.height);i.clearRect(0,0,t.width,t.height),t.width=0,t.height=0,i=null,t=null,r(n)})})}function u(t){return 0===t.size?void alert("Image chosen is not valid"):void(b?o(t,function(e){var t=e.replace(/^data:image\/(jpeg|png|jpg);base64,/,"");return v(t)}):C.isSelfieCapture?c(t):new e.BlobConverter(t,n).imageData(function(e){r(e)},S))}function f(e,t){v=e,S=t,i.addEventListener("change",a),y.start()}function h(){v=null,S=null,i.removeEventListener("change",a),y.stop()}function d(e){y.onOpen(e)}function p(e){y.onClose(e)}function m(){b=!0}function g(){y.resetIsOpen()}var v=null,n=n,S=null,y=new t(i),b=!1,C=this,T=!1,w=0,I=0;if("input"!==i.tagName.toLowerCase())throw new Error("Wrong element. Expected input, got "+i.tagName);this.start=f,this.stop=h,this.setBase64Format=m,this.onDialogOpen=d,this.onDialogClose=p,this.resetOpenState=g,this.isSelfieCapture=!1}e.FileInputCapture=i}(),function(){"use strict";function t(){}t.prototype.start=function(){},t.prototype.stop=function(){},t.prototype.isNeeded=function(){return!1},e.NoOpContinuousCaptureReset=t}(),e.SelfieCapture=function(){"use strict";function t(t,i){var n=z("lbpcascade_frontalface.xml"),a=z("haarcascade_eye.xml");e.Utils.createFileFromUrl("lbpcascade_face.xml",n,function(){e.Utils.createFileFromUrl("haarcascade_eye.xml",a,function(){try{ee=!0,O=new cv.CascadeClassifier,R=new cv.CascadeClassifier,O.load("lbpcascade_face.xml"),R.load("haarcascade_eye.xml"),t()}catch(n){ee=!1,i(new e.SelfieCaptureError(n.message))}},function(){ee=!1,i(new e.SelfieCaptureError("There was an issue while loading models. Please try again."))})},function(){ee=!1,i(new e.SelfieCaptureError("There was an issue while loading models. Please try again."))})}function i(){Q.resize();var t=Q.canvas.width,i=Q.canvas.height;_===t&&M===i||(_=t,M=i,P=new e.SelfieFrame(_,M,X),W=new e.BlinkDetector(P),W.classifier=O,W.eyeCascade=R,j.configure(P,W,X,function(){}))}function n(t){if(D=void 0,X.enableAutoCapture===!1){var i=Object.create(X);i.framePadding=X.framePadding+15,P=new e.SelfieFrame(_,M,void 0===V?X:i)}else P=new e.SelfieFrame(_,M,X);W=new e.BlinkDetector(P),W.classifier=O,W.eyeCascade=R;var n=function(){if(t){var i=function(){E=void 0,k()},n=function(t){e.report(F,new e.UserMediaError(t))};se=new e.UserMediaManager(C),se.configureForSelfie(i,n)}};j.configure(P,W,X,n)}function a(){if(E=compatibility.requestAnimationFrame(a),C.readyState===C.HAVE_ENOUGH_DATA&&void 0===N){if(i(),w.clearRect(0,0,T.width,T.height),re)return w.drawImage(C,0,0,_,M),r(),void b();if(!G){if(ae.isNeeded())return void r();"none"===C.style.display&&(C.style.display="block");try{var t=W.findFaceRectangle(C);if(e.SelfieGuidance.processRectangle(t[0]),o(),X.showEdges){I.width!==T.width&&(I.width=T.width,I.height=T.height,A.translate(I.width,0),A.scale(-1,1)),A.clearRect(0,0,I.width,I.height);for(var n=0;n<t.length;n++){var s=t[n];A.beginPath(),A.strokeStyle=X.edgesColor,A.lineWidth=X.edgesWidth,A.moveTo(s[0][0],s[0][1]);for(var l=1;l<s.length;l++)A.lineTo(s[l][0],s[l][1]);A.closePath(),A.stroke()}w.drawImage(I,0,0,T.width,T.height)}}catch(c){j.resetBlinkDetection(!1),e.SelfieGuidance.processGuidance(e.SelfieHints.CENTER_FACE),o()}}}}function r(){P.draw(w,D,j.delay(),j.currentHint())}function o(){r(),j.draw(w,D,L)}function s(t,i){try{me(t,i)}catch(n){e.report(i,n)}}function l(e,t){if(null===ne)X.enableAutoCapture===!1?t(V,K):t(e);else{var i=function(){if(X.enableAutoCapture===!1)if(ne.toolbarView.acceptButton.classList.contains("kfx-next")){var i=ne.canvas.getContext("2d");i.putImageData(K,0,0)}else t(V,K);else t(e)},a=function(){V=void 0,K=void 0,G=!1,j.resetBlinkDetection(!1),ae.stop(),X.enableAutoCapture===!1&&n(!1)};X.enableAutoCapture===!1?(ne.toolbarView.acceptButton.classList.add("kfx-next"),ne.review(V,i,a)):ne.review(e,i,a)}}function c(t){e.Utils.validateOptions(t,Z),void 0!==t.lookAndFeel&&e.Utils.validateOptions(t.lookAndFeel,Z),void 0!==t.centerFaceInstruction&&e.Utils.validateOptions(t.centerFaceInstruction,Z),void 0!==t.moveCloserInstruction&&e.Utils.validateOptions(t.moveCloserInstruction,Z),void 0!==t.moveBackInstruction&&e.Utils.validateOptions(t.moveBackInstruction,Z),void 0!==t.blinkSlowlyInstruction&&e.Utils.validateOptions(t.blinkSlowlyInstruction,Z),void 0!==t.tapToCaptureInstruction&&e.Utils.validateOptions(t.tapToCaptureInstruction,Z),void 0!==t.holdSteadyInstruction&&e.Utils.validateOptions(t.holdSteadyInstruction,Z),void 0!==t.doneInstruction&&e.Utils.validateOptions(t.doneInstruction,Z),void 0!==t.capturePauseInstruction&&e.Utils.validateOptions(t.capturePauseInstruction,Z)}function u(){return e.Utils.getOptions(X)}function f(){return e.Utils.getOptions(Y)}function h(t,i){c(t),void 0!==t.criteria&&e.SelfieGuidance.setOptions(t.criteria),e.Utils.setOptions(X,t,Y),n(i)}function d(e){e.enableAutoCapture===!1&&(Q.element.classList.add("kfx-disableac"),Q.element.removeChild(Q.toolbarView.element)),h(e,!1)}function p(){e.Utils.resetOptions(X,Y)}function m(){return ie.checkAction("setOptions")}function g(){re=!0,C.pause(),X.enableAutoCapture!==!0&&void 0!==X.enableAutoCapture||Q.disableToolbar()}function v(){re=!1,C.play(),X.enableAutoCapture!==!0&&void 0!==X.enableAutoCapture||Q.enableToolbar()}function S(){if(re)return void v()}function y(){X.enableAutoCapture===!1&&D===e.SelfieHints.BLINK_NOW&&(e.SelfieCaptureEventAppStats.logAppStats(x.FORCE_TAKE_SELFIE,"",1),s(B,H))}function b(){if(X.capturePauseInstruction.visible){var t=getComputedStyle(J),i=X.capturePauseInstruction.text,n=["20px",t.getPropertyValue("font-family")].join(" ");try{w.canvas.setAttribute("aria-label",X.capturePauseInstruction.accessibilityText),w.save(),w.font=n,w.fillStyle=X.instructionsTextColor;var a=24;e.Utils.drawMultiLineTextOnCanvas(w,i,P.width,a,"PORTRAIT")}finally{w.restore()}}}var C,T,w,I,A,E,P,D,_,M,O,L,R,k,F,U,G,N,j,B,H,V,K,W,z=e.Utils.getModelsUrl,q=e.Utils.getLibsUrl,X={frameAspectRatio:0,framePadding:10,frameThickness:10,frameColor:"#FF0000",outOfFrameColor:"#FFFFFF",instructionsBackgroundColor:"#000000",outOfFrameTransparency:1,showEdges:!1,edgesColor:"#FFFF00",preview:!1,edgesWidth:4,guidanceSize:150,guidanceTransparency:.5,drawInstructionsAsText:!1,instructionsTextColor:"#FFFFFF",forceCaptureButtonAccessibilityText:"Force capture",centerFaceInstruction:{visible:!0,text:"Center face",accessibilityText:"Center face"},moveCloserInstruction:{visible:!0,text:"Move closer",accessibilityText:"Move closer"},moveBackInstruction:{visible:!0,text:"Move back",accessibilityText:"Move back"},blinkSlowlyInstruction:{visible:!0,text:"Blink slowly",accessibilityText:"Blink slowly"},tapToCaptureInstruction:{visible:!0,text:"Tap to capture",accessibilityText:"Tap to capture"},holdSteadyInstruction:{visible:!0,text:"Hold steady",accessibilityText:"Hold steady"},doneInstruction:{visible:!0,text:"Done",accessibilityText:"Done"},capturePauseInstruction:{visible:!0,text:"Capture is Paused. Tap to Continue.",accessibilityText:"Capture is Paused. Tap to Continue."},enableAutoCapture:!0,enableBlinkDetection:!0,lookAndFeel:{forceCapture:10}},Y={frameAspectRatio:0,framePadding:10,frameThickness:10,frameColor:"#FF0000",outOfFrameColor:"#FFFFFF",instructionsBackgroundColor:"#000000",outOfFrameTransparency:1,showEdges:!1,edgesColor:"#FFFF00",preview:!1,edgesWidth:4,guidanceSize:150,guidanceTransparency:.5,drawInstructionsAsText:!1,instructionsTextColor:"#FFFFFF",forceCaptureButtonAccessibilityText:"Force capture",centerFaceInstruction:{visible:!0,text:"Center face",accessibilityText:"Center face"},moveCloserInstruction:{visible:!0,text:"Move closer",accessibilityText:"Move closer"},moveBackInstruction:{visible:!0,text:"Move back",accessibilityText:"Move back"},blinkSlowlyInstruction:{visible:!0,text:"Blink slowly",accessibilityText:"Blink slowly"},tapToCaptureInstruction:{visible:!0,text:"Tap to capture",accessibilityText:"Tap to capture"},holdSteadyInstruction:{visible:!0,text:"Hold steady",accessibilityText:"Hold steady"},doneInstruction:{visible:!0,text:"Done",accessibilityText:"Done"},capturePauseInstruction:{visible:!0,text:"Capture is Paused. Tap to Continue.",accessibilityText:"Capture is Paused. Tap to Continue."},enableAutoCapture:!0,enableBlinkDetection:!0,lookAndFeel:{forceCapture:10}},Z={frameAspectRatio:{type:"number",min:{value:0,include:!0}},framePadding:{type:"number",min:{value:0,include:!0},max:{value:49,include:!0}},frameThickness:{type:"number",min:{value:0,include:!0}},frameColor:{type:["string","object"],color:!0},instructionsTextColor:{type:["string","object"],color:!0},instructionsBackgroundColor:{type:["string","object"],color:!0},outOfFrameColor:{type:["string","object"],color:!0},outOfFrameTransparency:{type:"number",min:{value:0,include:!0},max:{value:1,include:!0}},guidanceTransparency:{type:"number",min:{value:0,include:!0},max:{value:1,include:!0}},showEdges:{type:"boolean"},text:{type:"string"},visible:{type:"boolean"},accessibilityText:{type:"string"},forceCaptureButtonAccessibilityText:{type:"string"},drawInstructionsAsText:{type:"boolean"},enableAutoCapture:{type:"boolean"},enableBlinkDetection:{type:"boolean"},preview:{type:"boolean"},edgesColor:{type:["string","object"],color:!0},edgesWidth:{type:"number",min:{value:0,include:!1}},guidanceSize:{type:"number",min:{value:100,include:!0}},forceCapture:{type:["boolean","number"],min:{value:0,include:!0}}},J=null,Q=null,$=!1,ee=!1,te=new e.AutoLoadAudio,ie=new e.StateManager,ne=null,ae=null,re=!1,oe=!1,se=null,le=function(t,i,n){try{if(!ee)return void n(new e.SelfieCaptureError("Models were not loaded"));ie.checkAction("create"),J=document.getElementById(t.containerId),Q=new e.SelfieCaptureView,J.appendChild(Q.element),Q.resize(),C=Q.video,_=C.width,M=C.height,T=Q.canvas,w=T.getContext("2d"),oe=!1,re=!1;var a=getComputedStyle(J);L=[a.getPropertyValue("font-size"),a.getPropertyValue("font-family")],I=document.createElement("canvas"),A=I.getContext("2d"),k=function(){ie.setCreatedState(),i()},F=function(e){pe(),n(e)},T.addEventListener("click",S),T.addEventListener("touchend",S),Q.element.addEventListener("click",y),Q.element.addEventListener("touchend",y),j=e.SelfieGuidance,ne=t.preview===!0?new KfxWebSDK.ReviewControl(t.containerId,t):null,h(t,!0),t.enableAutoCapture===!1&&(Q.element.classList.add("kfx-disableac"),Q.element.removeChild(Q.toolbarView.element)),e.Visibility.addListener(function(){e.Visibility.status()?oe&&e.Utils.isiOSDevice()&&(w.clearRect(0,0,T.width,T.height),oe=!1):"STATE_STARTED"===ie.state&&(g(),oe=!0)})}catch(r){pe(),n(r)}},ce=function(i,n,a){if(void 0!==a&&null!==a&&"boolean"!=typeof a&&""===KfxWebSDK.openCVCDNRepository)throw new Error("Parameter loadOpenCVAsWebAssembly is not boolean type");if(ee)return void i();void 0!==a&&null!==a||(a=!1),void 0!==KfxWebSDK.openCVCDNRepository&&null!==KfxWebSDK.openCVCDNRepository&&"string"==typeof KfxWebSDK.openCVCDNRepository||(KfxWebSDK.openCVCDNRepository="");var r=""===KfxWebSDK.openCVCDNRepository?q("OpenCV_JS/opencv.js"):KfxWebSDK.openCVCDNRepository;a&&""===KfxWebSDK.openCVCDNRepository&&(Module={wasmBinaryFile:q("OpenCV_WASM/opencv_js.wasm")},r=q("OpenCV_WASM/opencv.js"));var o=document.getElementsByTagName("head")[0],s=document.createElement("script");s.onload=function(){function e(){cv.getBuildInformation&&!$&&($=!0,clearInterval(r),t(i,n))}if("undefined"!=typeof cv.CascadeClassifier||a&&""===KfxWebSDK.openCVCDNRepository)if(a&&""===KfxWebSDK.openCVCDNRepository){if(a&&""===KfxWebSDK.openCVCDNRepository){var r=setInterval(e,1e3);$=!1}}else t(i,n);else cv.onRuntimeInitialized=function(){t(i,n)}},s.onerror=function(){n(new e.SelfieCaptureError("There was an issue while loading opencv. Please try again."))},s.type="text/javascript",s.setAttribute("async",""),s.src=r,o.appendChild(s)},ue=function(t,i){if(ie.checkAction("takeSelfie"),G=!1,D=void 0,B=t,H=i,V=void 0,K=void 0,Q.toolbarView.forceCaptureButton.setAttribute("aria-label",X.forceCaptureButtonAccessibilityText),X.enableAutoCapture===!0||void 0===X.enableAutoCapture){var n=X.lookAndFeel;Q.startToolbar(n),U=function(){e.SelfieCaptureEventAppStats.logAppStats(x.FORCE_TAKE_SELFIE,"",1),s(t,i)},Q.toolbarView.forceCaptureButton.addEventListener("click",U)}ae=new e.NoOpContinuousCaptureReset,j.start(function(n){D=n,D===e.SelfieHints.CAPTURE_OK&&(s(t,i),G=!0)}),void 0===E&&(C.style.display="none",C.play(),E=compatibility.requestAnimationFrame(a)),ie.setStartedState()},fe=function(e,t){ie.checkAction("stopCapture"),he(),ie.setStoppedState(),e()},he=function(){null!==ne&&ne.isActive&&ne.toolbarView.retakeButton.click(),Q&&(Q.stop(),Q.toolbarView.forceCaptureButton.removeEventListener("click",U)),D=void 0,V=void 0,K=void 0,ae&&ae.stop(),ae=null,void 0!==N&&clearTimeout(N),U=void 0,j&&j.stop(),E&&compatibility.cancelAnimationFrame(E),C&&C.pause(),E=void 0},de=function(e){e!==!0&&ie.checkAction("destroy"),"STATE_DESTROYED"!==ie.state&&(he(),pe(),ie.setDestroyedState())},pe=function(){W&&(W.dsContext.clearRect(0,0,W.width,W.height),W.dsContext=null),T.removeEventListener("click",S),T.removeEventListener("touchend",S),Q.element.removeEventListener("click",y),Q.element.removeEventListener("touchend",y),X.enableAutoCapture===!1&&(Q.element.classList.remove("kfx-disableac"),Q.element.appendChild(Q.toolbarView.element)),e.Visibility.removeListener(),w.clearRect(0,0,T.width,T.height),w=null,T=null,A.clearRect(0,0,I.width,I.height),A=null,I=null,Q&&(Q.canvas=null,Q.videoView.element=null,Q.videoView=null),Q=null,ne=null,P=null,e.Utils.removeAllChildren(J),J=null,se&&se.destroy(),se=null,W=null,j&&j.clearCanvases(),j=null},me=function(t,i){function a(){var e=C.videoWidth,t=C.videoHeight,i=document.createElement("canvas");i.width=e,i.height=t;var n=i.getContext("2d");n.drawImage(C,0,0);var a=[0,0,e,t],r=n.getImageData.apply(n,a);return n.clearRect(0,0,i.width,i.height),n=null,i=null,r}if(ie.checkAction("forceTakeSelfie"),re)throw new e.SelfieCaptureError("Selfie Capture is paused");if(C.readyState!==C.HAVE_ENOUGH_DATA)throw new e.SelfieCaptureError("Video is not ready, state = "+C.readyState);if(null!==ne&&ne.isActive)throw new e.StateError("Call forceTakeSelfie is not allowed during REVIEW");te.playShutterSound();var r=a();N=setTimeout(function(){D=void 0,N=void 0,te.pauseShutterSound(),j.clearGuidance(),r.id=e.Utils.guid(),e.SelfieCaptureEventAppStats.logImageObject(r.id,"Selfie Image","",r.data.length),e.SelfieCaptureEventAppStats.logAppStats("Selfie Image Captured",r.id,1),X.enableAutoCapture===!1?void 0===V?(V=r,n(!1)):(K=r,ae.start(),l(r,t)):(ae.start(),l(r,t))},1e3),D=e.SelfieHints.CAPTURE_OK,w.clearRect(0,0,T.width,T.height),o()};return{configure:le,start:ue,stop:fe,capture:me,destroy:de,getOptions:u,getDefaultOptions:f,setOptions:d,resetOptions:p,checkSetOptionsAllowed:m,loadModels:ce}}(),e.SelfieCaptureFallback=function(){"use strict";function t(t,i,a){(s||"STATE_STOPPED"===l.state)&&n(),l.checkAction("create"),r=document.createElement("input"),r.setAttribute("accept","image/*"),r.setAttribute("capture","user"),r.setAttribute("type","file"),o=new e.FileInputCapture(r,t),o.isSelfieCapture=!0,l.setCreatedState(),i()}function i(e,t){function i(){a(),e.apply(this,arguments)}function n(){a(),t.apply(this,arguments)}s&&a(),l.checkAction("takeSelfie"),s=!0,o.start(i,n),l.setStartedState(),r.click()}function n(){s&&a(),l.checkAction("destroy"),null!==o&&(o=null),r=null,l.setDestroyedState()}function a(){l.checkAction("stopCapture"),o.stop(),s=!1,l.setStoppedState()}var r=null,o=null,s=!1,l=new e.StateManager;return{configure:t,choosePicture:i,destroy:n}}(),function(){"use strict";function t(){var t=e.Utils.createElement("div","kfx-layout kfx-capture"),a=new i;t.appendChild(a.element);var r=new n;t.appendChild(r.element),this.element=t,this.videoView=a,this.canvas=a.canvas,this.video=a.video,this.toolbarView=r}function i(){var t=document.createElement("div");t.className="kfx-content";var i=document.createElement("div"),n=document.createElement("video");n.setAttribute("playsinline",!0),n.setAttribute("id","kfx-selfie-capture-video"),i.appendChild(n);var a=document.createElement("canvas");e.Utils.isiOSDevice()?a.setAttribute("role","img"):a.setAttribute("role",""),a.setAttribute("aria-live","assertive"),i.appendChild(a),t.appendChild(i),this.element=t,this.canvas=a,this.video=n}function n(){function t(e,t){var n=i("button","kfx-button "+e),a=i("div","kfx-icon");return a.style.backgroundImage=t,n.appendChild(a),n}var i=e.Utils.createElement,n=i("div","kfx-toolbar kfx-invisible"),a=t("kfx-force-capture","url("+e.Utils.getImageUrl("camera_icon.png")+")");n.appendChild(a),this.element=n,this.forceCaptureButton=a,this.forceCaptureTimeoutId=null}t.prototype.resize=function(){this.videoView.resize()},t.prototype.stop=function(e){this.stopToolbar()},t.prototype.startToolbar=function(e){this.toolbarView.start(e)},t.prototype.stopToolbar=function(e){this.toolbarView.stop()},t.prototype.enableToolbar=function(){this.toolbarView.enable()},t.prototype.disableToolbar=function(){this.toolbarView.disable()},i.prototype.resize=function(){
var e=this.element.clientWidth,t=this.element.clientHeight;if(0!==e&&0!==t){var i=this.video.videoWidth,n=this.video.videoHeight;if(0===i||0===n)return this.canvas.width=e,this.canvas.height=t,this.video.width=e,void(this.video.height=t);var a=e/i,r=t/n,o=Math.min(a,r),s=i*o|0,l=n*o|0;this.canvas.width===s&&this.canvas.height===l||(this.canvas.width=s,this.canvas.height=l,this.video.width=s,this.video.height=l)}},n.prototype.start=function(e){this.setUpForceCapture(e.forceCapture),this.enable()},n.prototype.stop=function(e){this.disable(),clearTimeout(this.forceCaptureTimeoutId),this.forceCaptureTimeoutId=null},n.prototype.enable=function(){e.Utils.toggleClass(this.element,"kfx-invisible",!1)},n.prototype.disable=function(){e.Utils.toggleClass(this.element,"kfx-invisible",!0)},n.prototype.setUpForceCapture=function(e){var t=this.enableForceCaptureButton.bind(this),i="number"==typeof e&&e,n=e===!0||0===i;t(n),i&&(this.forceCaptureTimeoutId=setTimeout(t,1e3*i))},n.prototype.enableForceCaptureButton=function(t){t="undefined"==typeof t||t,e.Utils.toggleElement(this.forceCaptureButton,t)},e.SelfieCaptureView=t}(),e.WebCapture=function(){"use strict";function t(){q.resize();var t=q.canvas.width,i=q.canvas.height;O===t&&L===i||(O=t,L=i,D=new e.Frame(O,L,V),B=new e.EdgeDetector(D),j.configure(D,B.dsFactor,V,function(){}))}function i(){r(V.enableFlashCapture===!0&&null!==Z?!0:!1)}function n(t){M=void 0,D=new e.Frame(O,L,V),B=new e.EdgeDetector(D);var n=function(){if(le&&i(),t){var n=function(){P=void 0,i(),t&&R()},a=function(t){e.report(k,new e.UserMediaError(t))};le=new e.UserMediaManager(x),le.configure(n,a,V.resolution===KfxWebSDK.resolution.RES_4K,!0)}};j.configure(D,B.dsFactor,V,n)}function a(){var e=le.stream.stream.getVideoTracks()[0];if(e&&"function"==typeof e.getCapabilities){var t=e.getCapabilities();return!!t.torch}return!1}function r(e){var t=le.stream.stream.getVideoTracks()[0];if(t&&"function"==typeof t.getCapabilities){var i=t.getCapabilities();i.torch&&t.applyConstraints({advanced:[{torch:e}]}).then(function(){})["catch"](function(e){console.log(e)})}}function o(){if(P=compatibility.requestAnimationFrame(o),V.enableFlashCapture===!0&&null!==Z&&ee===!1&&(ee=!0,setTimeout(function(){d(Q,$),r(!1)},2e3)),x.readyState===x.HAVE_ENOUGH_DATA&&void 0===N){if(t(),e.Utils.isiOSDevice()&&e.Utils.getiOSVersion()&&e.Utils.getiOSVersion()[0]<15?E.clearRect(0,0,A.width,A.height):E.drawImage(x,0,0,O,L),se)return E.drawImage(x,0,0,O,L),s(),void c();if(U||!G){if(oe.isNeeded())return void s();if(te)return s(),void u();try{var i=B.findEdgesRectangle(x);if(V.showEdges){E.beginPath(),E.strokeStyle=V.edgesColor,E.lineWidth=V.edgesWidth,E.moveTo(i[0][0],i[0][1]);for(var n=1;n<i.length;n++)E.lineTo(i[n][0],i[n][1]);E.closePath(),E.stroke()}e.Guidance.processRectangle(i)}catch(a){e.Guidance.processGuidance(e.Hints.FILL_AREA)}l()}}}function s(){D.draw(E,M)}function l(){s(),j.draw(E,M,_)}function c(){if(V.capturePauseInstruction.visible){var t=getComputedStyle(z),i=V.capturePauseInstruction.text,n=["20px",t.getPropertyValue("font-family")].join(" ");try{E.canvas.setAttribute("aria-label",V.capturePauseInstruction.accessibilityText),E.save(),E.font=n,E.fillStyle=V.instructionsTextColor;var a=24;e.Utils.drawMultiLineTextOnCanvas(E,i,D.width,a,V.instructionsAsTextOrientation)}finally{E.restore()}}}function u(){if(te.isExpired())return void(te=null);te.setSize(D.width,D.height);try{E.save(),E.translate(D.mx,D.my),te.draw(E)}finally{E.restore()}}function f(){se=!0,x.pause(),q.disableToolbar()}function h(){Y.resetOpenState(),se=!1,x.play(),q.enableToolbar()}function d(t,i){try{me(t,i)}catch(n){e.report(i,n)}}function p(e,t){if(null===ae)V.enableFlashCapture===!0&&a()?t(Z,J):t(e);else{var i=function(){if(V.enableFlashCapture===!0&&a())if(ae.toolbarView.acceptButton.classList.contains("kfx-next")){var i=ae.canvas.getContext("2d");i.putImageData(J,0,0)}else t(Z,J);else t(e)},r=function(){Z=null,J=null,G=!1,ee=!1,oe.stop(),V.enableFlashCapture===!0&&a()&&(q.toolbarView.enable(),n(!1))};V.enableFlashCapture===!0&&a()?(ae.toolbarView.acceptButton.classList.add("kfx-next"),ae.review(Z,i,r)):ae.review(e,i,r)}}function m(t){e.Utils.validateOptions(t,W),void 0!==t.lookAndFeel&&e.Utils.validateOptions(t.lookAndFeel,W),void 0!==t.tapToDismissInstruction&&e.Utils.validateOptions(t.tapToDismissInstruction,W),void 0!==t.zoomInInstruction&&e.Utils.validateOptions(t.zoomInInstruction,W),void 0!==t.zoomOutInstruction&&e.Utils.validateOptions(t.zoomOutInstruction,W),void 0!==t.centerDocumentInstruction&&e.Utils.validateOptions(t.centerDocumentInstruction,W),void 0!==t.rotateDeviceInstruction&&e.Utils.validateOptions(t.rotateDeviceInstruction,W),void 0!==t.holdDeviceLevelInstruction&&e.Utils.validateOptions(t.holdDeviceLevelInstruction,W),void 0!==t.holdSteadyInstruction&&e.Utils.validateOptions(t.holdSteadyInstruction,W),void 0!==t.doneInstruction&&e.Utils.validateOptions(t.doneInstruction,W),void 0!==t.motionPermissionInstruction&&e.Utils.validateOptions(t.motionPermissionInstruction,W),void 0!==t.capturePauseInstruction&&e.Utils.validateOptions(t.capturePauseInstruction,W)}function g(){return e.Utils.getOptions(V)}function v(){return e.Utils.getOptions(K)}function S(t,i){m(t),void 0!==t.criteria&&e.Guidance.setOptions(t.criteria),e.Utils.setOptions(V,t,K),n(i)}function y(e){e.resolution=e.resolution||KfxWebSDK.resolution.RES_FULL_HD,S(e,V.resolution!==e.resolution)}function b(){e.Utils.resetOptions(V,K)}function C(){return se?void h():(te&&te.isShown()&&(te=null,T()),void(M===e.Hints.LEVEL_PERMISSIONS&&j.levelSensor.requestPermission()))}function T(){q.startToolbar(V.lookAndFeel)}function w(){return ne.checkAction("setOptions")}var x,A,E,P,D,_,M,O,L,R,k,F,U,G,N,j,B,H=e.Utils.getImageUrl,V={frameAspectRatio:.629,framePadding:5,frameCornerHeight:10,frameCornerWidth:60,frameCornerColor:"#00FF00",outOfFrameTransparency:.5,iconTransparency:.5,showEdges:!1,edgesColor:"#FFFF00",edgesWidth:4,guidanceSize:150,guidanceOrientation:KfxWebSDK.orientation.PORTRAIT,useTargetFrameCrop:!1,resolution:KfxWebSDK.resolution.RES_FULL_HD,downscaleSize:2,enableFlashCapture:!1,drawInstructionsAsText:!1,instructionsAsTextOrientation:KfxWebSDK.orientation.PORTRAIT,instructionsTextColor:"#FFFFFF",instructionsBackgroundColor:"#000000",galleryButtonAccessibilityText:"Gallery",forceCaptureButtonAccessibilityText:"Force capture",tapToDismissInstruction:{visible:!0,text:"Tap to dismiss",accessibilityText:"Tap to dismiss",orientation:KfxWebSDK.orientation.LANDSCAPE},fitDocumentInstruction:{visible:!0,text:"Fit document in the frame",accessibilityText:"Fit document in the frame"},zoomInInstruction:{visible:!0,text:"Move closer",accessibilityText:"Move closer"},zoomOutInstruction:{visible:!0,text:"Move back",accessibilityText:"Move back"},centerDocumentInstruction:{visible:!0,text:"Center the document",accessibilityText:"Center the document"},rotateDeviceInstruction:{visible:!0,text:"Rotate device",accessibilityText:"Roate device"},holdDeviceLevelInstruction:{visible:!0,text:"Hold device level",accessibilityText:"Hold device level"},holdSteadyInstruction:{visible:!0,text:"Hold steady",accessibilityText:"Hold steady"},doneInstruction:{visible:!0,text:"Done",accessibilityText:"Done"},motionPermissionInstruction:{visible:!1,text:"Tap to give device motion and orientation access",accessibilityText:"Tap to give device motion and orientation access"},capturePauseInstruction:{visible:!0,text:"Capture is Paused. Tap to Continue.",accessibilityText:"Capture is Paused. Tap to Continue."},targetFrameBackground:"",targetFrameSuccessBackground:"",enableAutoCapture:!0,lookAndFeel:{documentSample:H("demo_dl_front.svg"),showTapToDismissMessage:!0,forceCapture:10,gallery:!0,documentSampleTimeout:6}},K={frameAspectRatio:.629,framePadding:5,frameCornerHeight:10,frameCornerWidth:60,frameCornerColor:"#00FF00",outOfFrameTransparency:.5,iconTransparency:.5,showEdges:!1,edgesColor:"#FFFF00",edgesWidth:4,guidanceSize:150,guidanceOrientation:KfxWebSDK.orientation.PORTRAIT,useTargetFrameCrop:!1,resolution:KfxWebSDK.resolution.RES_FULL_HD,downscaleSize:2,enableFlashCapture:!1,drawInstructionsAsText:!1,instructionsAsTextOrientation:KfxWebSDK.orientation.PORTRAIT,instructionsTextColor:"#FFFFFF",instructionsBackgroundColor:"#000000",galleryButtonAccessibilityText:"Gallery",forceCaptureButtonAccessibilityText:"Force Capture",tapToDismissInstruction:{visible:!0,text:"Tap to dismiss",accessibilityText:"Tap to dismiss",orientation:KfxWebSDK.orientation.LANDSCAPE},fitDocumentInstruction:{visible:!0,text:"Fit document in the frame",accessibilityText:"Fit document in the frame"},zoomInInstruction:{visible:!0,text:"Move closer",accessibilityText:"Move closer"},zoomOutInstruction:{visible:!0,text:"Move back",accessibilityText:"Move back"},centerDocumentInstruction:{visible:!0,text:"Center the document",accessibilityText:"Center the document"},rotateDeviceInstruction:{visible:!0,text:"Rotate device",accessibilityText:"Rotate device"},holdDeviceLevelInstruction:{visible:!0,text:"Hold device level",accessibilityText:"Hold device level"},holdSteadyInstruction:{visible:!0,text:"Hold steady",accessibilityText:"Hold steady"},doneInstruction:{visible:!0,text:"Done",accessibilityText:"Done"},motionPermissionInstruction:{visible:!1,text:"Tap to give device motion and orientation access",accessibilityText:"Tap to give device motion and orientation access"},capturePauseInstruction:{visible:!0,text:"Capture is Paused. Tap to Continue.",accessibilityText:"Capture is Paused. Tap to Continue."},targetFrameBackground:"",targetFrameSuccessBackground:"",enableAutoCapture:!0,lookAndFeel:{documentSample:H("demo_dl_front.svg"),showTapToDismissMessage:!0,forceCapture:10,gallery:!0,documentSampleTimeout:6}},W={frameAspectRatio:{type:"number",min:{value:0,include:!0}},framePadding:{type:"number",min:{value:0,include:!0},max:{value:49,include:!0}},frameCornerHeight:{type:"number",min:{value:0,include:!1}},frameCornerWidth:{type:"number",min:{value:0,include:!1}},frameCornerColor:{type:["string","object"],color:!0},outOfFrameTransparency:{type:"number",min:{value:0,include:!0},max:{value:1,include:!0}},iconTransparency:{type:"number",min:{value:0,include:!0},max:{value:1,include:!0}},showEdges:{type:"boolean"},edgesColor:{type:["string","object"],color:!0},instructionsTextColor:{type:["string","object"],color:!0},instructionsBackgroundColor:{type:["string","object"],color:!0},edgesWidth:{type:"number",min:{value:0,include:!1}},guidanceSize:{type:"number",min:{value:100,include:!0}},guidanceOrientation:{type:"string",options:[KfxWebSDK.orientation.LANDSCAPE,KfxWebSDK.orientation.PORTRAIT]},useTargetFrameCrop:{type:"boolean"},enableFlashCapture:{type:"boolean"},enableAutoCapture:{type:"boolean"},targetFrameBackground:{type:"string"},targetFrameSuccessBackground:{type:"string"},resolution:{type:"string",options:[KfxWebSDK.resolution.RES_FULL_HD,KfxWebSDK.resolution.RES_4K]},downscaleSize:{type:"number",min:{value:1,include:!0},max:{value:50,include:!0}},showTapToDismissMessage:{type:"boolean"},documentSample:{type:["boolean","string"]},forceCapture:{type:["boolean","number"],min:{value:0,include:!0}},gallery:{type:"boolean"},orientation:{type:"string",options:[KfxWebSDK.orientation.LANDSCAPE,KfxWebSDK.orientation.PORTRAIT]},text:{type:"string"},visible:{type:"boolean"},accessibilityText:{type:"string"},galleryButtonAccessibilityText:{type:"string"},forceCaptureButtonAccessibilityText:{type:"string"},drawInstructionsAsText:{type:"boolean"},instructionsAsTextOrientation:{type:"string",options:[KfxWebSDK.orientation.LANDSCAPE,KfxWebSDK.orientation.PORTRAIT]},documentSampleTimeout:{type:"number",min:{value:1,include:!0}}},z=null,q=null,X=!1,Y=null,Z=null,J=null,Q=null,$=null,ee=!1,te=null,ie=new e.AutoLoadAudio,ne=new e.StateManager,ae=null,re=new e.LevelSensor,oe=null,se=!1,le=null,ce=function(t,i,n){try{ne.checkAction("create"),z=document.getElementById(t.containerId),t.resolution=t.resolution||KfxWebSDK.resolution.RES_FULL_HD,q=new e.CaptureView,z.appendChild(q.element),q.resize(),x=q.video,O=x.width,L=x.height,A=q.canvas,E=A.getContext("2d"),E.fillStyle="rgb(0,255,0)",E.strokeStyle="rgb(0,255,0)";var a=getComputedStyle(z);_=[a.getPropertyValue("font-size"),a.getPropertyValue("font-family")],X=!1,R=function(){ne.setCreatedState(),i()},k=function(e){pe(),n(e)},A.addEventListener("click",C),A.addEventListener("touchend",C),j=e.Guidance,ae=t.preview===!0?new KfxWebSDK.ReviewControl(t.containerId,t):null,S(t,!0),Y=new e.FileInputCapture(q.toolbarView.galleryInput,V),Y.onDialogOpen(f),e.Visibility.addListener(function(){e.Visibility.status()?X&&e.Utils.isiOSDevice()&&(E.clearRect(0,0,A.width,A.height),X=!1):"STATE_STARTED"===ne.state&&(f(),X=!0)})}catch(r){pe(),n(r)}},ue=function(t,i,n){ne.checkAction("takePicture"),E.canvas.setAttribute("aria-label",V.tapToDismissInstruction.accessibilityText),U=n,G=!1,se=!1,ee=!1,Z=null,J=null,Q=t,$=i,Y.start(t,i),M=void 0,q.toolbarView.galleryButton.setAttribute("aria-label",V.galleryButtonAccessibilityText),q.toolbarView.forceCaptureButton.setAttribute("aria-label",V.forceCaptureButtonAccessibilityText);var r=V.lookAndFeel;if(r.documentSample){var s=r.documentSample;s===!0&&(K.lookAndFeel.documentSample=H("demo_dl_front.svg"),s=K.lookAndFeel.documentSample);var l=getComputedStyle(z),c=[l.getPropertyValue("font-size"),l.getPropertyValue("font-family")].join(" ");te=new e.DocumentSample(s,c,V,1e3*(r.documentSampleTimeout?r.documentSampleTimeout:6)),te.setExpireHandler(T)}else te=null,T();oe=U?new e.ContinuousCaptureReset(re):new e.NoOpContinuousCaptureReset,F=function(){e.CaptureEventAppStats.logAppStats(I.FORCE_TAKE_PICTURE,"",1),d(t,i)},q.toolbarView.forceCaptureButton.addEventListener("click",F),j.start(function(n){if(M=n,M===e.Hints.CAPTURE_OK){if(V.enableFlashCapture===!0&&a()&&null!==Z)return;d(t,i),G=!0}}),void 0===P&&(e.Utils.isiOSDevice()||(x.style.display="none"),x.play(),P=compatibility.requestAnimationFrame(o)),ne.setStartedState()},fe=function(e,t){ne.checkAction("stopCapture"),he(),ne.setStoppedState(),e()},he=function(){null!==ae&&ae.isActive&&ae.toolbarView.retakeButton.click(),q&&(q.stop(),q.toolbarView.forceCaptureButton.removeEventListener("click",F)),Y&&Y.stop(),te=null,M=void 0,oe&&oe.stop(),oe=null,void 0!==N&&clearTimeout(N),F=void 0,j&&j.stop(),P&&compatibility.cancelAnimationFrame(P),x&&x.pause(),P=void 0},de=function(e){e!==!0&&ne.checkAction("destroy"),"STATE_DESTROYED"!==ne.state&&(he(),pe(),ne.setDestroyedState())},pe=function(){B&&(B.dsContext.clearRect(0,0,x.videoWidth,x.videoHeight),B.dsContext=null),B=null,E.clearRect(0,0,A.width,A.height),A.removeEventListener("click",C),A.removeEventListener("touchend",C),A.width=0,A.height=0,E=null,A=null,D=null,Y=null,q&&(q.canvas=null,q.videoView.element=null,q.videoView=null),q=null,te=null,ae=null,Z=null,ee=!1,e.Visibility.removeListener(),e.Utils.removeAllChildren(z),z=null,le&&le.destroy(),le=null,j&&j.clearCanvases(),j=null},me=function(t,i){function r(){var e=x.videoWidth,t=x.videoHeight,i=2;"number"==typeof V.downscaleSize&&(i=V.downscaleSize);var n=1024*i*1024,a=e*t;if(a>n){var r=Math.sqrt(n/a);e*=r,t*=r}var o=document.createElement("canvas");o.width=e,o.height=t;var s=o.getContext("2d");s.drawImage(x,0,0,e,t);var l=V.useTargetFrameCrop?D.getTargetFrameCropData(e,t):[0,0,e,t],c=s.getImageData.apply(s,l);return s.clearRect(0,0,o.width,o.height),s=null,o=null,c}if(ne.checkAction("forceTakePicture"),se)throw new e.CaptureError("Capture is paused");if(x.readyState!==x.HAVE_ENOUGH_DATA)throw new e.CaptureError("Video is not ready, state = "+x.readyState);if(null!==ae&&ae.isActive)throw new e.StateError("Call forceTakePicture is not allowed during REVIEW");ie.playShutterSound(),(!e.Utils.isiOSDevice()||e.Utils.getiOSVersion()&&e.Utils.getiOSVersion()[0]>=15)&&E.drawImage(x,0,0,O,L);var o=r();N=setTimeout(function(){M=void 0,N=void 0,ie.pauseShutterSound(),j&&j.clearGuidance(),o.id=e.Utils.guid(),e.CaptureEventAppStats.logImageObject(o.id,"Image","",o.data.length),e.CaptureEventAppStats.logAppStats("Image Captured",o.id,1),V.enableFlashCapture===!0&&a()?null===Z?(Z=o,G=!1,ee=!1,q.toolbarView.disable(),n(!1)):(J=o,U&&(G=!1,ee=!1,Z=null,J=null,q.toolbarView.enable()),oe.start(),p(o,t)):(oe.start(),p(o,t))},1e3);var s=e.Utils.getDeviceDetails();M=e.Hints.CAPTURE_OK,e.Utils.isiOSDevice()&&e.Utils.getiOSVersion()&&e.Utils.getiOSVersion()[0]<15&&E.clearRect(0,0,A.width,A.height),"Macintosh"!==s.os.name&&"iPad"!==s.os.name||E.clearRect(0,0,A.width,A.height),l()};return{configure:ce,start:ue,stop:fe,capture:me,destroy:de,getOptions:g,getDefaultOptions:v,setOptions:y,resetOptions:b,checkSetOptionsAllowed:w}}(),function(){"use strict";function t(t){var i=e.GeneralSettings.getSettingsForRealTimeEdgeDetection();e.ImageUtils.checkMinSize(t.screenWidth,t.screenHeight,i.selfieDownscaleSize),this.width=t.screenWidth,this.height=t.screenHeight,this.dsFactor=Math.ceil(Math.sqrt(t.screenSquare/i.selfieDownscaleSize));var n=e.ImageUtils.getScalingData(this.width,this.height,i.selfieDownscaleSize);this.dsFactor=n.scaleFactor,this.dsContext=n.context,this.dsWidth=n.width,this.dsHeight=n.height,this.blinkDetectedListener=null,this.classifier=null,this.eyeCascade=null,this.state=0}t.prototype.findFaceRectangle=function(t){this.dsContext.drawImage(t,0,0,this.width,this.height);var i=this.dsContext.getImageData(0,0,this.dsWidth,this.dsHeight),n=cv.matFromImageData(i),a=new cv.Mat,r=cv.Mat.eye(2,2,cv.CV_32FC1),o=new cv.Point((-1),(-1));cv.filter2D(n,a,cv.CV_8U,r,o,0,cv.BORDER_DEFAULT);var s=new cv.Mat,l=new cv.RectVector,c=new cv.RectVector;cv.cvtColor(a,s,cv.COLOR_RGBA2GRAY,0),this.classifier.detectMultiScale(s,l,1.1,3,0,new cv.Size(0,0),new cv.Size(0,0));var u=[];0==l.size()&&(this.state=0);for(var f=0;f<l.size()&&1==l.size();++f){var h=s.roi(l.get(f)),d=new cv.Point(l.get(f).x,l.get(f).y),p=new cv.Point(l.get(f).x+l.get(f).width,l.get(f).y),m=new cv.Point(l.get(f).x+l.get(f).width,l.get(f).y+l.get(f).height),g=new cv.Point(l.get(f).x,l.get(f).y+l.get(f).height);if(u.push([[d.x,d.y],[p.x,p.y],[m.x,m.y],[g.x,g.y]]),this.blinkDetectedListener){this.eyeCascade.detectMultiScale(h,c);for(var v=0;v<c.size()&&c.size()<=2;++v){var S=new cv.Point(d.x+c.get(v).x,d.y+c.get(v).y),y=new cv.Point(d.x+c.get(v).x+c.get(v).width,d.y+c.get(v).y),b=new cv.Point(d.x+c.get(v).x+c.get(v).width,d.y+c.get(v).y+c.get(v).height),C=new cv.Point(d.x+c.get(v).x,d.y+c.get(v).y+c.get(v).height);u.push([[S.x,S.y],[y.x,y.y],[b.x,b.y],[C.x,C.y]])}switch(this.state){case 0:2==c.size()&&(this.state=1);break;case 1:0==c.size()&&(this.state=2);break;case 2:2==c.size()&&(this.state=0,this.blinkDetectedListener())}}h["delete"]()}n["delete"](),a["delete"](),s["delete"](),l["delete"](),c["delete"]();for(var T=0;T<u.length;T++)u[T]=e.PointUtils.scaleAll(u[T],this.dsFactor);return u},e.BlinkDetector=t}(),function(){"use strict";function t(t,i){var n=e.GeneralSettings.getSettings(i);e.ImageUtils.checkMinSize(t.width,t.height,n.downscaleSize),this.data=t,this.settings=n,this.scaleData=e.ImageUtils.scaleToPixelSize(this.data,this.settings.downscaleSize),this.type=i,this.lines=null,this.imageByteArray=null}t.prototype.getLines=function(){if(null!==this.lines)return this.lines;var t=this.scaleData.imageData,i=e.ImageUtils.getRgbWithBlur(t,this.settings.gaussianBlur),n=i[0],a=i[1],r=i[2],o=n.cols,s=n.rows,l=i[3],c=e.LineExtractor.process,u=e.ImageUtils.adaptiveCanny,f=u(n);return c(f,o,s,this.settings,l),f=u(a),c(f,o,s,this.settings,l),f=u(r),c(f,o,s,this.settings,l),this.had=e.Hough.getAccumulator(l,o,s),this.lines=e.Hough.getLinesStandard(l,o,s,this.settings.houghThreshold,this.settings.houghLinesMax,this.had),this.imageByteArray=l,this.lines},t.prototype.process=function(){var t=this.getLines(),i=this.scaleData.imageData,n=this.scaleData.scaleFactor,a=i.width,r=i.height,o=new e.TetragonFinder(this.imageByteArray,a,r,this.type,this.had),s=o.find(t);if(this.settings.boundingCrop){var l=void 0===s?e.ImageUtils.getBound(this.imageByteArray,a,r):e.PointUtils.getBound([s.p1,s.p2,s.p3,s.p4]);l=e.PointUtils.scaleAll(l,n);var c=this.settings.boundingPadding,u=e.ImageUtils.getROICropData(this.data.width,this.data.height,l,c),f=e.ImageUtils.convertImageDataToCanvas(this.data),h=f.getContext("2d");return h.getImageData.apply(h,u)}if(void 0===s)throw Error("No document sides found");var d,p=new e.TetragonAligner(a,r),m=p.process(s);return d=m.getPerspectiveFraction()<this.settings.perspectiveThreshold?e.Deskew.process(this.data,m.getRectangleInterpolation(n)):e.Perspective.transform(this.data,m,n,this.type)},e.CannyDetector=t}(),e.Deskew=function(){"use strict";function t(t,n){var a=(t.width,t.height,new e.Rectangle(n)),r=e.ImageUtils.convertImageDataToCanvas(t).getContext("2d"),o=Math.abs,s=-a.radians,l=o(180*s/Math.PI);if(l>i){var c=Math.ceil(a.getRadius()),u=a.mx-c,f=a.my-c,h=2*c,d=e.ImageUtils.createEmptyCanvas(h,h);d.getContext("2d").putImageData(t,-u,-f);var p=e.ImageUtils.createEmptyCanvas(h,h).getContext("2d");p.translate(c,c),p.rotate(s),p.translate(-c,-c),p.drawImage(d,0,0,h,h),r=p,a=a.rotate(s).shift(-u,-f)}var m=e.PointUtils.getBound(a.rectangle),g=e.ImageUtils.getROICropData(r.canvas.width,r.canvas.height,m,0);return r.getImageData.apply(r,g)}var i=.49;return{process:t}}(),function(){"use strict";function t(t){var i=e.GeneralSettings.getSettingsForRealTimeEdgeDetection();e.ImageUtils.checkMinSize(t.screenWidth,t.screenHeight,i.downscaleSize),this.width=t.screenWidth,this.height=t.screenHeight,this.contourRadius=i.contourRadius,this.gaussianBlurValue=i.gaussianBlurValue,this.sobelThreshold=i.sobelThreshold,this.dsFactor=Math.ceil(Math.sqrt(t.screenSquare/i.downscaleSize));var n=e.ImageUtils.getScalingData(this.width,this.height,i.downscaleSize);this.dsFactor=n.scaleFactor,this.dsContext=n.context,this.dsWidth=n.width,this.dsHeight=n.height,this.contourFinder=new e.ContourFinder(this.dsWidth,this.dsHeight,this.contourRadius),this.sobelManager=new e.Sobel(this.dsWidth,this.dsHeight,this.gaussianBlurValue,this.sobelThreshold,this.sobelMaxExpositionThreshold)}t.prototype.findEdgesRectangle=function(t){this.dsContext.drawImage(t,0,0,this.width,this.height);var i=this.dsContext.getImageData(0,0,this.dsWidth,this.dsHeight),n=this.sobelManager.process(i),a=this.contourFinder.find(n);if(void 0===a||a.length<3)throw new Error("Main contour either was not found or has less than 3 points");var r=e.ConvexHull.convexHull(a),o=e.RotatingCallipers.minBoundingRectangle(r);return o=e.PointUtils.scaleAll(o,this.dsFactor)},e.EdgeDetector=t}(),e.GeneralSettings=function(){"use strict";function t(t){return e.Utils.getOptions(a[t])}function i(){return e.Utils.getOptions(n)}var n={downscaleSize:12288,selfieDownscaleSize:3e4,contourRadius:7,gaussianBlurValue:4,sobelThreshold:90,sobelMaxExpositionThreshold:70,minSquareThreshold:.1,maxRatioDeviationThreshold:1.8,maxRatioThreshold:5,maxGuidanceThreshold:3,outOfScreenDownscaledPadding:2.9,targetFrameCropEvrsPadding:50},a={};return a[KfxWebSDK.document.MOBILE_ID]={aspectRatio:2.125/3.375,downscaleSize:12e4,perspectiveThreshold:1.00016,gaussianBlur:4,houghThreshold:11,houghLinesMax:84,minTetragonRank:126,minTetragonSideRank:39,maxDiagonalFraction:1.059,maxAvgAspectRatio:3.966,minAvgAspectRatio:2.283,maxAngleDeviation:18,minAngleDeviation:14,maxRightAngleDeviation:10,maxDivineAngleDeviation:4,minSquareFraction:.191,maxOutOfSpaceIndex:.018,maxSidesDistances:1.086,minSidesDistances:.364,erectLinearThreshold:15,inclinedLinearThreshold:25},a[KfxWebSDK.document.CHECK]={downscaleSize:12e4,perspectiveThreshold:1.00074,gaussianBlur:4,runSecondPass:!0,secondPassHoughThreshold:5,secondPassHoughLinesMax:5,houghThreshold:18,houghLinesMax:70,minTetragonRank:176,minTetragonSideRank:57,maxDiagonalFraction:1.0463,maxAvgAspectRatio:7.641,minAvgAspectRatio:3.17,maxAngleDeviation:15,minAngleDeviation:3,maxRightAngleDeviation:9,maxDivineAngleDeviation:3,minSquareFraction:.392,maxOutOfSpaceIndex:.018,maxSidesDistances:1.175,minSidesDistances:.342,erectLinearThreshold:15,inclinedLinearThreshold:18},a[KfxWebSDK.document.PASSPORT]={boundingCrop:!0,boundingPadding:15,aspectRatio:142/202,downscaleSize:12e4,perspectiveThreshold:1.00202,gaussianBlur:4,houghThreshold:18,houghLinesMax:70,minTetragonRank:140,minTetragonSideRank:51,maxDiagonalFraction:1.116,maxAvgAspectRatio:3.596,minAvgAspectRatio:1.241,maxAngleDeviation:42,minAngleDeviation:8,maxRightAngleDeviation:24,maxDivineAngleDeviation:13,minSquareFraction:.432,maxOutOfSpaceIndex:.017,maxSidesDistances:1.141,minSidesDistances:.427,erectLinearThreshold:15,inclinedLinearThreshold:25},a[KfxWebSDK.document.BILL_PAY]={},{getSettings:t,getSettingsForRealTimeEdgeDetection:i}}(),function(){"use strict";function t(e,t,i,n,a){this.width=e,this.height=t,this.threshold=n,this.expThreshold=a,this.gaussianBlur=i,this.kernels={},this.kernels.r=new jsfeat.matrix_t(e,t,jsfeat.S32C2_t),this.kernels.g=new jsfeat.matrix_t(e,t,jsfeat.S32C2_t),this.kernels.b=new jsfeat.matrix_t(e,t,jsfeat.S32C2_t),this.gradients={},this.gradients.r=new jsfeat.matrix_t(e,t,jsfeat.S32C1_t),this.gradients.g=new jsfeat.matrix_t(e,t,jsfeat.S32C1_t),this.gradients.b=new jsfeat.matrix_t(e,t,jsfeat.S32C1_t),this.u8={},this.u8.r=new jsfeat.matrix_t(e,t,jsfeat.U8C1_t),this.u8.g=new jsfeat.matrix_t(e,t,jsfeat.U8C1_t),this.u8.b=new jsfeat.matrix_t(e,t,jsfeat.U8C1_t),this.u8.main=new jsfeat.matrix_t(e,t,jsfeat.U8C1_t)}t.prototype.process=function(e){for(var t=e.data,i=t.length,n=this.u8.r.data,a=this.u8.g.data,r=this.u8.b.data,o=0,s=0;o<i;o+=4,s++)n[s]=t[o],a[s]=t[o+1],r[s]=t[o+2];i=this.width*this.height,jsfeat.imgproc.gaussian_blur(this.u8.r,this.u8.r,this.gaussianBlur),jsfeat.imgproc.gaussian_blur(this.u8.g,this.u8.g,this.gaussianBlur),jsfeat.imgproc.gaussian_blur(this.u8.b,this.u8.b,this.gaussianBlur),jsfeat.imgproc.sobel_derivatives(this.u8.r,this.kernels.r),jsfeat.imgproc.sobel_derivatives(this.u8.g,this.kernels.g),jsfeat.imgproc.sobel_derivatives(this.u8.b,this.kernels.b);var l,c,u=this.kernels.r.data,f=this.gradients.r.data,h=0,d=0,p=this.kernels.g.data,m=this.gradients.g.data,g=0,v=0,S=this.kernels.b.data,y=this.gradients.b.data,b=0,C=0;for(o=0;o<i;o++)l=o<<1,c=l+1,h=u[l],d=u[c],f[o]=h*h+d*d,g=p[l],v=p[c],m[o]=g*g+v*v,b=S[l],C=S[c],y[o]=b*b+C*C;var T,w,I,x,A,E,P,D,_,M,O,L,R,k,F,U,G,N,j,B,H,V,K,W,z,q,X,Y,Z,J,Q,$,ee,te,ie,ne,ae,re,oe,se,le,ce,ue=0,fe=0,he=0,de=0,pe=0,me=0,ge=0,ve=0,Se=0,ye=0,be=0,Ce=0,Te=this.u8.main.data,we=Te[0],Ie=this.u8.main.cols;for(o=0;o<i;o++)l=o<<1,h=u[l],d=u[l+1],T=h>>31,w=d>>31,he=(h^T)-T|0,de=(d^w)-w|0,ue=h>0?1:-1,fe=d>0?Ie:-Ie,I=o+ue,x=o+fe,A=he-de,B=f[I-fe],V=f[x-ue],he>de?(j=f[I],H=f[o-ue],K=A*j+de*B,W=A*H+de*V,E=he):(j=f[o-fe],H=f[x],A=-A,K=A*j+he*B,W=A*H+he*V,E=de),z=f[o]*E,g=p[l],v=p[l+1],P=g>>31,D=v>>31,ge=(g^P)-P|0,ve=(v^D)-D|0,pe=g>0?1:-1,me=v>0?Ie:-Ie,_=o+pe,M=o+me,O=ge-ve,Y=m[_-me],J=m[M-pe],ge>ve?(X=m[_],Z=m[o-pe],Q=O*X+ve*Y,$=O*Z+ve*J,L=ge):(X=m[o-me],Z=m[M],O=-O,Q=O*X+ge*Y,$=O*Z+ge*J,L=ve),ee=m[o]*L,b=S[l],C=S[l+1],R=b>>31,k=C>>31,be=(b^R)-R|0,Ce=(C^k)-k|0,Se=b>0?1:-1,ye=C>0?Ie:-Ie,F=o+Se,U=o+ye,G=be-Ce,ne=y[F-ye],re=y[U-Se],be>Ce?(ie=y[F],ae=y[o-Se],oe=G*ie+Ce*ne,se=G*ae+Ce*re,N=be):(ie=y[o-ye],ae=y[U],G=-G,oe=G*ie+be*ne,se=G*ae+be*re,N=Ce),le=y[o]*N,q=z>=K&&z>W?255&E:0,te=ee>=Q&&ee>$?255&L:0,ce=le>=oe&&le>se?255&N:0,Te[o]=Math.max.call(Math,q,te,ce),we=Math.max(Te[o],we);if(we<=this.expThreshold)throw Error("Image is too dark to process");var xe,Ae=this.threshold*we/255,Ee=new Array(i);for(o=0;o<i;o++)xe=Te[o]>=Ae?255:0,Ee[o]=xe;return Ee},e.Sobel=t}(),function(){"use strict";function t(e,t,i,n,a,r,o){this.rho=e,this.angle=t,this.rank=void 0===n?0:n,this.ar=void 0===i?0:i,void 0===a||void 0===r||void 0===o?(this.sin=Math.sin(this.angle),this.cos=Math.cos(this.angle),this.cos=1===this.sin?0:this.cos,this.sin=1===this.cos?0:this.sin,this.t=Math.round(180*this.angle/Math.PI),180===this.t&&(this.t=0)):(this.sin=a,this.cos=r,this.t=o),this.isVertical=0===this.sin,this.isHorizontal=0===this.cos,this.b=this.rho/this.sin,this.k=-this.cos/this.sin,this.north=this.rho<0&&this.t>90,this.south=this.rho>0&&this.t>90}t.prototype.equals=function(e){return this.rho===e.rho&&this.angle===e.angle},t.prototype.isParallel=function(e){return this.rho!==e.rho&&this.angle===e.angle},t.prototype.intersect=function(e){if(this.equals(e)||this.isParallel(e))return[NaN,NaN];var t,i;return this.isVertical?(t=this.rho,i=e.get(t)):e.isVertical?(t=e.rho,i=this.get(t)):(t=(e.b-this.b)/(this.k-e.k),i=this.get(t)),[t,i]},t.prototype.get=function(e){return this.isHorizontal?this.rho:e*this.k+this.b},t.prototype.scale=function(e){return new t(e*this.rho,this.angle,this.ar,this.rank,this.sin,this.cos,this.t)},t.prototype.checkPoint=function(e,t){return t=void 0===t?0:t,Math.abs(e[0]*this.cos+e[1]*this.sin-this.rho)<=t},e.LinePolar=t}(),function(){"use strict";function t(e){var t=e[0],n=e[1],a=e[2];this.rectangle=e,this.length=this.rectangle.length,this.sideA=i(t,n),this.sideB=i(n,a),this.square=this.sideA*this.sideB;var r=t[0],o=t[1];this.mx=r+(a[0]-r)/2,this.my=o+(a[1]-o)/2;var s;this.sideA>this.sideB?(s=0,this["long"]=this.sideA,this["short"]=this.sideB):(s=1,this["long"]=this.sideB,this["short"]=this.sideA),this.ratio=this["long"]/this["short"],this.isSquareShape=this.ratio<=1.1;var l=s+1,c=this.rectangle[s],u=this.rectangle[l],f=c[0]-u[0];0===f?(this.tangens=NaN,this.radians=Math.PI/2,this.angle=90):(this.tangens=(c[1]-u[1])/f,this.radians=Math.atan(this.tangens),this.angle=180*this.radians/Math.PI)}var i=e.PointUtils.getDistance;t.prototype.shift=function(e,i){for(var n,a=[],r=0;r<this.length;r++)n=this.get(r),a.push([n[0]+e,n[1]+i]);return new t(a)},t.prototype.get=function(e){return this.rectangle[e]},t.prototype.getRadius=function(){for(var e,t,i,n=0,a=0;a<this.length;a++)e=this.get(a),t=e[0]-this.mx,i=e[1]-this.my,n=Math.max(n,t*t+i*i);return Math.sqrt(n)},t.prototype.rotate=function(e){for(var i,n,a,r=[],o=Math.sin(e),s=Math.cos(e),l=0;l<this.length;l++)i=this.get(l),n=i[0]-this.mx,a=i[1]-this.my,r.push([n*s-a*o+this.mx,a*s+n*o+this.my]);return new t(r)},e.Rectangle=t}(),function(){"use strict";function t(e,t,i,n){this.l1=e,this.l2=t,this.l3=i,this.l4=n,this.p1=this.l1.intersect(this.l2),this.p2=this.l2.intersect(this.l3),this.p3=this.l3.intersect(this.l4),this.p4=this.l4.intersect(this.l1),this.p12=o(this.p1,this.p2),this.p23=o(this.p2,this.p3),this.p34=o(this.p3,this.p4),this.p41=o(this.p4,this.p1),this.as1=this.p12+this.p34,this.as2=this.p23+this.p41,this.s12=this.as1*this.as2}var i=e.PointUtils.scale,n=e.PointUtils.getDistance,a=e.LineUtils.getLinesAngle,r=e.LineUtils.getLinesDistance,o=e.PointUtils.getSquareDistance,s=e.PointUtils.getOutOfSpaceLength,l=e.LineUtils.getLinePolarByPoints,c=e.LineUtils.getPointsOnLineByLengthFromAnotherPoint;t.prototype.getBound=function(t){var i=e.PointUtils.getBound([this.p1,this.p2,this.p3,this.p4]);return e.PointUtils.scaleAll(i,t)},t.prototype.getCenterPoint=function(e){var t=l(this.p1,this.p3),n=l(this.p2,this.p4);return i(t.intersect(n),e)},t.prototype.getRectangleInterpolation=function(e){var t,a=l(this.p1,this.p3),r=l(this.p2,this.p4),o=a.intersect(r),s=n(o,this.p1),u=n(o,this.p2),f=n(o,this.p3),h=n(o,this.p4),d=Math.min.apply(Math,[s,u,f,h]);t=c(a,o,d);var p=t[0],m=t[1];t=c(r,o,d);var g=t[0],v=t[1];return[i(p,e),i(g,e),i(m,e),i(v,e)]},t.prototype.getPerspectiveData=function(t,i){var a=this.getPoints(i);a=e.ConvexHull.convexHull(a).reverse();var r=n(a[0],a[1]),o=n(a[1],a[2]);if(r<o){var s=[];s.push(a[3]),s.push(a[0]),s.push(a[1]),s.push(a[2]),a=s,r=n(a[0],a[1]),o=n(a[1],a[2])}var l=n(a[2],a[3]),c=n(a[3],a[0]),u=Math.round((r+l)/2),f=Math.round((o+c)/2),h=Math.max(u,f),d=Math.min(u,f);return void 0!==t&&(d=Math.round(t*h)),{src:a,dst:[[0,0],[h,0],[h,d],[0,d]]}},t.prototype.getPerspectiveFraction=function(){var e=(Math.sqrt(this.p12)+Math.sqrt(this.p34))/2,t=(Math.sqrt(this.p23)+Math.sqrt(this.p41))/2,i=Math.sqrt(e*e+t*t),a=n(this.p1,this.p3),r=n(this.p2,this.p4),o=Math.min(a,r);return i>o?i/o:o/i},t.prototype.getPoints=function(t){for(var n=[this.p1,this.p2,this.p3,this.p4],a=e.PointUtils.roundToPoint,r=0,o=this.getCenterPoint(1);r<n.length;r++)n[r]=i(n[r],t),
n[r]=a(n[r],o);return n},t.prototype.getConfidenceValue=function(){var e=this.l1.ar+this.l2.ar+this.l3.ar+this.l4.ar;return this.s12*e},t.prototype.getDiagonalFraction=function(){var e=o(this.p1,this.p3),t=o(this.p2,this.p4);return Math.max(e,t)/Math.min(e,t)},t.prototype.getAvgAspectRatio=function(){return Math.max(this.as1,this.as2)/Math.min(this.as1,this.as2)},t.prototype.getSidesAngleDeviation=function(){var e=a(this.l1,this.l3),t=a(this.l2,this.l4);return{max:Math.max(e,t),min:Math.min(e,t)}},t.prototype.getSquareFraction=function(e){return this.s12/e},t.prototype.getOutOfSpaceIndex=function(e,t,i){var n=s(this.p1,t,i);return n=Math.max(n,s(this.p2,t,i)),n=Math.max(n,s(this.p3,t,i)),n=Math.max(n,s(this.p4,t,i)),n/e},t.prototype.getSidesDistances=function(e){var t=r(this.l1,this.l3),i=r(this.l2,this.l4);return{max:Math.max(t,i)/e,min:Math.min(t,i)/e}},e.Tetragon=t}(),function(){"use strict";function t(e,t,i){this.width=e,this.height=t,this.radius=i,this.squareRadius=this.radius*this.radius;for(var n,a=new Array(e*t),r=0;r<a.length;r++)n=Math.floor(r/e),a[r]=[r-n*e,n];this.cache=a}function i(e){for(var t=-1,i={},a=0;a<e.length;a++)e[a]<0?n.call(this,e,i,e[a],a):e[a]>0&&(void 0===i[t]&&(i[t]=[]),n.call(this,e,i,t,a),t--);return i}function n(e,t,i,n){for(var a,r,o,s,l,c,u,f,h=this.cache[n],d=h[0],p=h[1],m=this.width,g=this.height,v=this.radius,S=this.squareRadius,y=Math.max(d-v,0),b=Math.max(p-v,0),C=Math.min(d+v,m-1),T=Math.min(p+v,g-1),w=y;w<=C;w++)for(var I=b;I<=T;I++)if(a=w-d,r=I-p,!(a*a+r*r>S))if(o=I*m+w,s=e[o],s>0)e[o]=i,t[i].push([w,I]);else if(s<0&&s!==i){for(l=t[s],c=l.length,f=0;f<c;f++)u=l[f],e[u[1]*m+u[0]]=i,t[i].push(u);delete t[s]}}t.prototype.find=function(e){var t,n=[],a=0,r=i.call(this,e);for(var o in r)r.hasOwnProperty(o)&&(t=r[o],t.length>a&&(a=t.length,n=t));return n},e.ContourFinder=t}(),e.ConvexHull=function(){"use strict";function t(t){if(t.length<3)return t;for(var i,n=[],a=t[0],r=e.PointUtils.equals,o=e.PointUtils.getSquareDistance,s=e.PointUtils.approximatePointToLineDistance,l=1;l<t.length;l++)i=t[l],(i[0]<a[0]||i[0]===a[0]&&i[1]<a[1])&&(a=i);var c,u,f,h;do{for(n.push(a),c=t[0],f=r(a,c),h=o(a,c),l=1;l<t.length;l++)i=t[l],u=s(a,c,i),(u>0||0===u&&o(a,i)>h||f)&&(c=i,f=r(a,c),h=o(a,c));a=c}while(!r(c,n[0]));return n}return{convexHull:t}}(),e.Hough=function(){"use strict";function t(e){return function(t,i){return e[i]-e[t]}}function i(e,t,i){var n,r,o,u,f,h=a,d=c(2*(t+i)+1),p=d+2,m=d-1,g=.5*m,v=(h+2)*p,S=new Array(v),y=new Array(v),b=new Array(v);for(n=0;n<v;n++)S[n]=0,y[n]=[-255,-255],b[n]=0;var C,T,w,I=0;for(n=0;n<i;n++)for(r=0;r<t;r++)if(e[n*t+r]>0)for(o=0;o<h;o++)u=c(r*l[o]+n*s[o])+g,f=(o+1)*p+u+1,S[f]++,C=y[f],T=C[0]-r,w=C[1]-n,-1<=T&&T<=1&&-1<=w&&w<=1&&b[f]++,C[0]=r,C[1]=n,b[f]>I&&(I=b[f]);return{c2:b,max_c2:I,accum:S}}function n(n,f,h,d,p,m,g){var v,S,y,b,C,T,w,I,x=[],A=a,E=c(2*(f+h)+1),P=E+2,D=E-2,_=E-1,M=.5*_,O=1/P,L=[];void 0===m&&(m=i(n,f,h)),w=m.c2,T=m.accum,I=m.max_c2;var R,k=100/I,F=d/k,U=e.Type.isFunction(g);for(y=0;y<E;y++)for(S=0;S<A;S++)C=(S+1)*P+y+1,R=T[C],w[C]>F&&R>T[C-1]&&R>=T[C+1]&&R>T[C-D]&&R>=T[C+P]&&(U?g(L,C,S*o,C-(S+1)*P-M-1):L.push(C));L.sort(t(w)),p=Math.min(p,L.length);var G,N,j,B=e.LinePolar;for(v=0;v<p;v++)b=L[v],S=u(b*O)-1,y=b-(S+1)*P-1,G=y-M,N=S*o,j=0<=N&&N<=r,G<0&&j||0===G&&!j||x.push(new B(G,N,w[b],c(k*w[b]),s[S],l[S],S));return x}for(var a=180,r=Math.PI/2,o=Math.PI/180,s=new Array(a),l=new Array(a),c=Math.round,u=Math.floor,f=0,h=0;f<a;h+=o,f++)s[f]=Math.sin(h),l[f]=Math.cos(h);return{getAccumulator:i,getLinesStandard:n}}(),e.LineExtractor=function(){"use strict";function e(e,t,i,n,a){for(var r,o,s=[],l={},c=0,u=t,f=-1,h=0;u<=i;u+=n)o=e[u],o>0&&(f===-1&&(f=u),h++),0!==o&&u!==i||f===-1||(r=o>0?u:u-1,l[f]=[f,h,r],f!==r&&(l[r]=l[f]),s.push(l[f]),c=Math.max(h,c),void 0===a[h]&&(a[h]=[]),a[h].push(l[f]),f=-1,h=0);return s.maxSize=c,s.map=l,s}function t(e,t,n){for(var a=0;a<e.length;a++)i(e[a],t,n)}function i(e,t,i){for(var n=e[0];n<=e[2];n+=t)i[n]=255}function n(e,i,n,a){for(var r,o=Object.keys(e),s=0;s<o.length;s++)(r=o[s])>i&&t(e[r],n,a)}function a(t,i,a,r,o){for(var l,c=[],u={},f=0,h=1,d=0,p=i-1;d<a;d++)c[d]=l=e(t,d*i,d*i+p,h,u),l.length>0&&(f=Math.max(l.maxSize,f));for(var m,g=[],v={},S=0,y=i,b=0,C=a-1;b<i;b++)g[b]=m=e(t,b,C*i+b,y,v),m.length>0&&(S=Math.max(m.maxSize,S));var T=Math.floor(f*r.erectLinearThreshold/100);T>5&&n(u,T,h,o);var w=Math.floor(S*r.erectLinearThreshold/100);w>5&&n(v,w,y,o),s(c,i,r,o)}function r(e,t,n){do i(e,1,n),e=e.track[t].next;while(null!==e)}function o(e){return{L:{next:null,size:e,referenced:!1},R:{next:null,size:e,referenced:!1}}}function s(e,t,i,n){for(var a,r,s,u,f,h,d,p,m=0;m<e.length;m++)for(var g=0;g<e[m].length;g++)a=e[m][g],r=a[1],u=a[0],f=a[2],a.track=o(r),s=e[m-1],void 0!==s&&0!==s.length&&(p=s.map,h=f-t,d=void 0!==p[h]?p[h]:void 0!==p[++h]?p[h]:void 0,c(a,d,"R"),h=u-t,d=void 0!==p[h]?p[h]:void 0!==p[--h]?p[h]:void 0,c(a,d,"L"));for(var v=[],S=0,y=[],b=0,m=0;m<e.length;m++)for(var g=0;g<e[m].length;g++)a=e[m][g],a.track.L.referenced||null===a.track.L.next||(y.push(a),b=Math.max(b,a.track.L.size)),a.track.R.referenced||null===a.track.R.next||(v.push(a),S=Math.max(S,a.track.R.size));l(v,Math.floor(S*i.inclinedLinearThreshold/100),"R",n),l(y,Math.floor(b*i.inclinedLinearThreshold/100),"L",n)}function l(e,t,i,n){if(e.length>0)for(var a=0;a<e.length;a++)e[a].track[i].size>t&&r(e[a],i,n)}function c(e,t,i){void 0!==t&&(e.track[i].next=t,e.track[i].size=t.track[i].size+e[1],e.track[i].referenced=!1,t.track[i].referenced=!0)}return{process:a}}(),e.Perspective=function(){"use strict";function t(t,n,a,r){var o=new jsfeat.matrix_t(3,3,jsfeat.F32_t|jsfeat.C1_t),s=e.GeneralSettings.getSettings(r).aspectRatio,l=n.getPerspectiveData(s,a),c=l.src,u=l.dst,f=c[0][0],h=c[0][1],d=u[0][0],p=u[0][1],m=c[1][0],g=c[1][1],v=u[1][0],S=u[1][1],y=c[2][0],b=c[2][1],C=u[2][0],T=u[2][1],w=c[3][0],I=c[3][1],x=u[3][0],A=u[3][1];jsfeat.math.perspective_4point_transform(o,f,h,d,p,m,g,v,S,y,b,C,T,w,I,x,A),jsfeat.matmath.invert_3x3(o,o);var E=e.ImageUtils.createEmptyImageData(C,T);return i(t,E,o.data),E}function i(e,t,i){for(var n,a,r,o,s,l,c,u,f=0|t.width,h=0|t.height,d=0|e.width,p=0|e.height,m=0,g=0,v=0,S=0,y=0,b=0,C=0,T=0,w=0,I=0,x=0,A=0,E=0,P=0,D=0,_=0,M=0,O=i[0],L=i[1],R=i[2],k=i[3],F=i[4],U=i[5],G=i[6],N=i[7],j=i[8],B=d-1,H=p-1,V=4*d,K=4*f,W=e.data,z=t.data,q=0,X=0;X<h;++X){b=L*X+R,C=F*X+U,T=N*X+j,c=X*K;for(var Y=0;Y<f;Y++,q+=4,b+=O,C+=k,T+=G)w=1/T,S=b*w,y=C*w,g=0|S,v=0|y,u=0,l=c+4*Y+3,S>0&&y>0&&g<B&&v<H&&(I=Math.max(S-g,0),x=Math.max(y-v,0),m=V*v+4*g|0,n=m+V,a=m+1,r=m+2,o=n+1,s=n+2,A=W[m]+I*(W[m+4]-W[m]),E=W[n]+I*(W[n+4]-W[n]),P=W[a]+I*(W[m+5]-W[a]),D=W[o]+I*(W[n+5]-W[o]),_=W[r]+I*(W[m+6]-W[r]),M=W[s]+I*(W[n+6]-W[s]),z[q]=A+x*(E-A),z[q+1]=P+x*(D-P),z[q+2]=_+x*(M-_),u=255),z[l]=u}}return{transform:t}}(),e.RotatingCallipers=function(){"use strict";function t(e){for(var t,h,d,p,m,g=[],v=e.length,S=n,y=new Array(v),b=new Array(v),C=v-1,T=0;C>=0;C--,T++)m=e[C],y[T]=[m[0],m[1]];var w,I,x,A,E=[n,n],P=[a,a];for(C=0;C<v;C++)h=y[C],d=h[0],p=h[1],b[C]=u(y[(C+1)%v],h),d<E[0]&&(E[0]=d,w=C),d>P[0]&&(P[0]=d,I=C),p<E[1]&&(E[1]=p,A=C),p>P[1]&&(P[1]=p,x=C);var D,_,M,O,L,R=r,k=o,F=s,U=l;for(C=0;C<v;C++){switch(t=[Math.acos(c(R,b[w])),Math.acos(c(k,b[I])),Math.acos(c(F,b[x])),Math.acos(c(U,b[A]))],t.indexOf(Math.min.apply(Math,t))){case 0:R=b[w],k=[-R[0],-R[1]],F=[R[1],-R[0]],U=[-F[0],-F[1]],w=(w+1)%v;break;case 1:k=b[I],R=[-k[0],-k[1]],F=[R[1],-R[0]],U=[-F[0],-F[1]],I=(I+1)%v;break;case 2:F=b[x],U=[-F[0],-F[1]],R=[U[1],-U[0]],k=[-R[0],-R[1]],x=(x+1)%v;break;case 3:U=b[A],F=[-U[0],-U[1]],R=[U[1],-U[0]],k=[-R[0],-R[1]],A=(A+1)%v}D=i(y[w],R,y[x],F),_=i(y[I],k,y[x],F),M=i(y[A],U,y[w],R),O=i(y[A],U,y[I],k),L=f(D,_)*f(D,M),L<S&&(g=[D,M,O,_],S=L)}return g}function i(e,t,i,n){var a=(i[0]-e[0])*n[1]-(i[1]-e[1])*n[0],r=t[0]*n[1]-t[1]*n[0],o=a/r;return[e[0]+o*t[0],e[1]+o*t[1]]}var n=Number.MAX_VALUE,a=Number.MIN_VALUE,r=[0,-1],o=[0,1],s=[-1,0],l=[1,0],c=e.PointUtils.dot,u=e.PointUtils.subtract,f=e.PointUtils.getSquareDistance;return{minBoundingRectangle:t}}(),function(){"use strict";function t(t,i){this.width=t,this.height=i,this.north=new e.LinePolar(0,Math.PI/2),this.south=new e.LinePolar(this.height,Math.PI/2),this.east=new e.LinePolar(this.width,0),this.west=new e.LinePolar(0,0)}function i(e){var t;return e[0]<0&&(t=this.west),e[0]>this.width&&(t=this.east),e[1]<0&&(t=this.north),e[1]>this.height&&(t=this.south),t}function n(e,t){var i;return t===this.west&&(i=[Math.ceil(e[0])+1,e[1]]),t===this.east&&(i=[Math.floor(e[0])-1,e[1]]),t===this.north&&(i=[e[0],Math.ceil(e[1])+1]),t===this.south&&(i=[e[0],Math.floor(e[1])-1]),i}function a(t,a,r,o,s,l){var c=i.call(this,l);if(void 0===c)return t;var u=e.PointUtils.getDistance,f=e.LineUtils.getParallelLineByPoint,h=[t.l1,t.l2,t.l3,t.l4],d=e.LineUtils.getLinesAngle(o,c),p=e.LineUtils.getLinesAngle(s,c),m=Math.sin(Math.PI*d/180),g=Math.sin(Math.PI*p/180),v=0===g?0:1/(1+m/g),S=o.intersect(c),y=s.intersect(c),b=0===v?S:1===v?y:null;if(null===b){var C=u(S,y),T=C*v,w=e.LineUtils.getPointsOnLineByLengthFromAnotherPoint(c,S,T);b=u(y,w[0])>u(y,w[1])?w[1]:w[0]}return b=n.call(this,b,c),h[a]=f(b,o),h[r]=f(b,s),new e.Tetragon(h[0],h[1],h[2],h[3])}t.prototype.process=function(e){var t=e;return t=a.call(this,t,0,1,t.l1,t.l2,t.p1),t=a.call(this,t,1,2,t.l2,t.l3,t.p2),t=a.call(this,t,2,3,t.l3,t.l4,t.p3),t=a.call(this,t,3,0,t.l4,t.l1,t.p4)},e.TetragonAligner=t}(),function(){"use strict";function t(t,i,n){this.width=t,this.height=i,this.square=this.width*this.height,this.squaredSquare=this.square*this.square,this.avgSize=(this.width+this.height)/2,this.settings=e.GeneralSettings.getSettings(n)}t.prototype.filter=function(e){if(e.getDiagonalFraction()>this.settings.maxDiagonalFraction)return!1;var t=e.getAvgAspectRatio();return!(t<this.settings.minAvgAspectRatio||t>this.settings.maxAvgAspectRatio)&&(!(e.getSquareFraction(this.squaredSquare)<this.settings.minSquareFraction)&&!(e.getOutOfSpaceIndex(this.avgSize,this.width,this.height)>this.settings.maxOutOfSpaceIndex))},e.TetragonFilter=t}(),function(){"use strict";function t(t,i,n,a,r){this.data=t,this.width=i,this.height=n,this.avgSize=(this.width+this.height)/2,this.type=a,this.settings=e.GeneralSettings.getSettings(this.type),this.had=r}function i(t,i){var n,a,s=this.settings.maxAngleDeviation,l=this.settings.minSidesDistances,c=this.settings.maxSidesDistances,u=c*this.avgSize,f=l*this.avgSize,h=e.LinePolar,d=function(e,t,l,c){n=new h(c,l),a=o(i,n),r(i,n)<=s&&a>=f&&a<=u&&e.push(t)},p=e.Hough.getLinesStandard(this.data,this.width,this.height,this.settings.secondPassHoughThreshold,this.settings.secondPassHoughLinesMax,this.had,d);return this.find(t.concat(p),!0)}var n=Math.abs,a=e.LineUtils.getLinesByAngle,r=e.LineUtils.getLinesAngle,o=e.LineUtils.getLinesDistance,s=e.LineUtils.getDivineAngle;t.prototype.find=function(t,l){for(var c,u,f,h,d,p,m,g,v,S,y,b,C,T=0,w=void 0!==l&&l,I=new e.TetragonFilter(this.width,this.height,this.type),x=this.settings.maxDivineAngleDeviation,A=this.settings.maxRightAngleDeviation,E=this.settings.minTetragonSideRank,P=this.settings.minAngleDeviation,D=this.settings.minSidesDistances,_=this.settings.maxSidesDistances,M=this.settings.maxAngleDeviation,O=this.settings.minTetragonRank,L=_*this.avgSize,R=D*this.avgSize,k=new Array(180),F=e.Tetragon,U=-1,G=!w,N=0;N<t.length&&t[N].rank>=E;N++){m=t[N];for(var j=N+1;j<t.length;j++)if(g=t[j],v=o(m,g),!(r(m,g)>P||v<R||v>L)){C=k[m.t],void 0===C&&(C=a(t,n(m.t+90)%180,A),k[m.t]=C),h=m.rank+g.rank;for(var B=0;B<C.length;B++)if(y=C[B],!(s(y,m,g)>x)){d=h+y.rank,U<d&&(U=d,p=y);for(var H=B+1;H<C.length;H++)b=C[H],S=o(y,b),r(y,b)>M||S<R||S>L||d+b.rank<O&&G||(c=new F(m,y,g,b),I.filter(c)&&(u=c.getConfidenceValue(),u>T&&(f=c,T=u)))}}}return w?f:(this.settings.runSecondPass&&void 0===f&&void 0!==y&&(f=i.call(this,t,p)),f)},e.TetragonFinder=t}(),function(){"use strict";function t(e,t,i,s){"string"==typeof e?(this.image=document.createElement("img"),this.image.src=e):this.image=e,this.font=t,this.textPadding=i.frameCornerHeight,this.showTapToDismissMessage=i.lookAndFeel.showTapToDismissMessage,a=i.tapToDismissInstruction.text,r=i.tapToDismissInstruction.accessibilityText,o=i.tapToDismissInstruction.orientation,this.width=-1,this.height=-1,this.time=s,this.startTime=-1,n=!1}function i(){return 30}var n,a="",r="",o="LANDSCAPE";t.prototype.setSize=function(e,t){this.width=e,this.height=t},t.prototype.isShown=function(){return this.startTime!==-1},t.prototype.isExpired=function(){if(this.startTime===-1)return!1;if(n)return!0;var e=(new Date).getTime(),t=this.startTime+this.time;return e>=t&&(n=!0,"function"==typeof this.callBack&&this.callBack()),n},t.prototype.draw=function(e){this.rememberStartTime(),this.drawImage(e),this.showTapToDismissMessage!==!0&&void 0!==this.showTapToDismissMessage||this.drawDismissText(e)},t.prototype.rememberStartTime=function(){this.startTime===-1&&this.image.complete&&(this.startTime=Date.now())},t.prototype.drawImage=function(e){var t=this.image;if(t.naturalWidth&&t.naturalHeight){var i;if(this.width!==-1&&this.height!==-1){var n=this.width/t.naturalWidth,a=this.height/t.naturalHeight;i=Math.min(n,a)}else i=1;var r=t.naturalWidth*i,o=t.naturalHeight*i,s=-(r>>1),l=-(o>>1);e.drawImage(t,s,l,r,o)}},t.prototype.drawDismissText=function(e){try{var t=i();if(a.length>t&&(a=a.substring(0,t)),e.save(),"LANDSCAPE"==o){e.rotate(Math.PI/2),e.font=this.font,e.fillStyle="white",e.textBaseline="top";var n=e.measureText(a),s=-(n.width>>1),l=(this.width>>1)+this.textPadding;e.canvas.setAttribute("aria-label",r)}else{e.font=this.font,e.fillStyle="white",e.textBaseline="bottom";var n=e.measureText(a),s=-(n.width>>1),l=(this.height>>1)+this.textPadding+20;e.canvas.setAttribute("aria-label",r)}e.fillText(a,s,l)}finally{e.restore()}},t.prototype.setExpireHandler=function(e){this.callBack=e},e.DocumentSample=t}(),e.Extraction=function(){function t(t){var i;if(null===t||"undefined"==typeof t)return i=new e.ValidationError("Please provide options needed for extraction."),e.report(g,i),!1;if("object"!=typeof t)return i=new e.ValidationError("Please provide valid options object"),e.report(g,i),!1;if(null===t.url||"undefined"==typeof t.url)return i=new e.ValidationError("Please provide url of the server."),e.report(g,i),!1;if("string"!=typeof t.url||0==t.url.length)return i=new e.ValidationError("Please provide valid url"),e.report(g,i),!1;if(null===t.images||"undefined"==typeof t.images)return i=new e.ValidationError("Please provide images for extraction."),e.report(g,i),!1;if("object"!=typeof t.images)return i=new e.ValidationError("Please provide array of images."),e.report(g,i),!1;if("[object Array]"!=Object.prototype.toString.call(t.images))return i=new e.ValidationError("Please provide array of images."),e.report(g,i),!1;if(0==t.images.length)return i=new e.ValidationError("Please provide atleast one image for extraction."),e.report(g,i),!1;if(null===t.serverParameters||"undefined"==typeof t.serverParameters)return i=new e.ValidationError("Please provide serverParameters for extraction."),e.report(g,i),!1;if("object"!=typeof t.serverParameters)return i=new e.ValidationError("Please provide valid server parameters."),e.report(g,i),!1;if(null==t.timingInfo&&"undefined"==typeof t.timingInfo)return i=new e.ValidationError("Please provide timingInfo."),e.report(g,i),!1;if("boolean"!=typeof t.timingInfo)return i=new e.ValidationError("Please provide valid timing info."),e.report(g,i),!1;for(var n=0;n<t.images.length;n++)if("[object Uint8Array]"!=Object.prototype.toString.call(t.images[n]))return i=new e.ValidationError("The image should be of Uint8Array format."),e.report(g,i),!1;return!0}function i(e,t,i){if(n(e,i)){var a={userIdentityWithPassword:{UserId:e.username,LogOnProtocol:7,UnconditionalLogOn:!0,Password:e.password}},r={url:e.url+S,serverParameters:a};N(r,function(e){t(e)},function(e){i(e)})}}function n(t,i){return f(t)?null===t.url||"undefined"==typeof t.url?(error=new e.ValidationError("Please provide the URL needed for KTA login."),e.report(i,error),!1):"string"!=typeof t.url||0==t.url.length?(error=new e.ValidationError("Please provide valid url"),e.report(i,error),!1):null===t.username||"undefined"==typeof t.username?(error=new e.ValidationError("Please provide the username needed for KTA login."),e.report(i,error),!1):"string"!=typeof t.username||0==t.username.length?(error=new e.ValidationError("Please provide valid username"),e.report(i,error),!1):null===t.password||"undefined"==typeof t.password?(error=new e.ValidationError("Please provide the password needed for KTA login."),e.report(i,error),!1):"string"==typeof t.password&&0!=t.password.length||(error=new e.ValidationError("Please provide valid password"),e.report(i,error),!1):(error=new e.ValidationError("Please provide valid login options"),e.report(i,error),!1)}function a(){var e={jobWithDocsInitialization:{InputVariables:[{Value:null,Id:"Barcode"},{Value:!0,Id:"ProcessImage"},{Value:!0,Id:"Verification"}],Documents:[{DocumentName:null,RuntimeFields:null,FieldsToReturn:null,Base64Data:null,DocumentGroup:{Version:0,Id:null,Name:""},Data:null,MimeType:"image/jpeg",FolderTypeId:null,DocumentTypeId:null,ReturnFullTextOcr:!1,ReturnAllFields:!0,PageDataList:[],FilePath:null,PageDataCollection:null,FolderId:null}],StartDate:null,StoreFolderAndDocuments:!0},sessionId:"",processIdentity:{Version:0,Id:null,Name:""},variablesToReturn:{}};return e}function r(t){if(null==t)return null;for(var i=null,n={authenticationResult:null,VerificationPhoto64:null,transactionId:null,documentAlerts:null,documentTests:null,documentImageAnalysis:null,documentRiskVectorAnalysis:null,documentClassification:null},a=0;a<t.length;a++)"VerificationReserved"==t[a].Name&&(i=t[a].Value),"VerificationResult"==t[a].Name&&(n.authenticationResult=t[a].Value),"VerificationPhoto64"==t[a].Name&&(n.VerificationPhoto64=t[a].Value),"VerificationTransactionID"==t[a].Name&&(n.transactionId=t[a].Value);if(null!=i&&"undefined"!==i&&0!=e.Utils.isJSONValid(i)&&(i=JSON.parse(i),null!=i.DocumentInfo)){var r=i.DocumentInfo;r.DocumentAlerts.length<=0&&(r.DocumentAlerts=""),r.DocumentTests.length<=0&&(r.DocumentTests=""),r.DocumentImageAnalysis.length<=0&&(r.DocumentImageAnalysis=""),r.DocumentRiskVectorAnalysis.length<=0&&(r.DocumentRiskVectorAnalysis=""),r.DocumentClassification.length<=0&&(r.DocumentClassification=""),n.documentAlerts=r.DocumentAlerts,n.documentTests=r.DocumentTests,n.documentImageAnalysis=r.DocumentImageAnalysis,n.documentRiskVectorAnalysis=r.DocumentRiskVectorAnalysis,n.documentClassification=r.DocumentClassification}return n}function o(e){var t={sessionKey:m,words:[],"classificationResult ":[],documentId:e.d.DocumentId,extractionClass:p.serverParameters.documentName,JobId:e.d.JobIdentity.Id,fields:[]},i=k(e);return t.fields=s(i),t}function s(e){for(var t=[],i=e,n=0;n<i.length;n++){var a=i[n],r={id:null===a.Id?"":a.Id,text:null===a.Value?"":a.Value,name:null===a.Name?"":a.Name,confidence:null===a.Confidence?"":a.Confidence,errorDescription:null===a.ErrorDescription?"":a.ErrorDescription,valid:null===a.Valid?"":a.Valid};t.push(r)}return t}function l(){var e={jobWithDocsInitialization:{InputVariables:[],Documents:[{DocumentName:null,RuntimeFields:null,FieldsToReturn:null,Base64Data:null,DocumentGroup:{Version:0,Id:null,Name:""},Data:null,MimeType:"image/jpeg",ReturnFullTextOcr:!1,FolderTypeId:null,DocumentTypeId:null,ReturnAllFields:!0,PageDataList:[],FilePath:null,PageDataCollection:null,FolderId:null}],StartDate:null,StoreFolderAndDocuments:!0},sessionId:"",processIdentity:{Version:0,Id:null,Name:""},variablesToReturn:{}};return e}function c(e){for(var t=e.d,i=t.ReturnedDocumentFields[0].ReturnedDocumentFields,n={sessionKey:m,words:[],"classificationResult ":[],documentId:t.DocumentId,extractionClass:p.serverParameters.documentName,JobId:t.JobIdentity.Id,fields:[]},a=[],r=0;r<i.length;r++){var o=i[r],s={id:null===o.Id?"":o.Id,text:null===o.Value?"":o.Value,name:null===o.Name?"":o.Name,confidence:null===o.Confidence?"":o.Confidence,errorDescription:null===o.ErrorDescription?"":o.ErrorDescription,valid:null===o.Valid?"":o.Valid};a.push(s)}return n.fields=a,n}function u(t,i){var n;return f(t)?null===t.url||"undefined"==typeof t.url?(n=new e.ValidationError("Please provide the url needed for KTA extraction."),e.report(i,n),!1):"string"!=typeof t.url?(n=new e.ValidationError("Please provide valid url."),e.report(i,n),!1):0==t.url.length?(n=new e.ValidationError("Please provide valid url."),e.report(i,n),!1):null===t.serverParameters||"undefined"==typeof t.serverParameters?(n=new e.ValidationError("Please provide the server parameters needed for KTA extraction."),e.report(i,n),!1):"object"!=typeof t.serverParameters?(n=new e.ValidationError("Please provide valid server parameters."),e.report(i,n),!1):null===t.serverParameters.processIdentityName||"undefined"==typeof t.serverParameters.processIdentityName?(n=new e.ValidationError("Please provide the process identity name needed for KTA extraction."),e.report(i,n),!1):"string"!=typeof t.serverParameters.processIdentityName?(n=new e.ValidationError("Please provide valid process identity name needed for KTA extraction."),e.report(i,n),!1):0==t.serverParameters.processIdentityName.length?(n=new e.ValidationError("Please provide valid process identity name needed for KTA extraction."),e.report(i,n),!1):null===t.images||"undefined"==typeof t.images?(n=new e.ValidationError("Please provide array of images."),e.report(i,n),!1):"object"!=typeof t.images?(n=new e.ValidationError("Please provide array of images."),e.report(i,n),!1):"[object Array]"!=Object.prototype.toString.call(t.images)?(n=new e.ValidationError("Please provide array of images."),e.report(i,n),!1):0==t.images.length?(n=new e.ValidationError("Please provide atleast one image for extraction."),e.report(i,n),!1):null==t.timingInfo&&"undefined"==typeof t.timingInfo?(n=new e.ValidationError("Please provide timingInfo."),e.report(i,n),!1):"boolean"!=typeof t.timingInfo?(n=new e.ValidationError("Please provide valid timing info."),e.report(i,n),!1):"undefined"!=typeof t.serverParameters.sessionId&&null!=t.serverParameters.sessionId&&0!=t.serverParameters.sessionId.length||(n=new e.ValidationError("Please provide valid KTA sessionId"),e.report(i,n),!1):(n=new e.ValidationError("Please provide valid options object"),e.report(i,n),!1)}function f(e){return null!==e&&"undefined"!=typeof e&&"object"==typeof e}function h(e){var t=e.d;return null===t||"undefined"===t?null:t.DocumentId}function d(e){var t=e.d;return null===t||"undefined"===t?null:t.SessionId}var p,m,g,v,S="/UserService.svc/json/LogOnWithPassword2",y="/JobService.svc/json/CreateJobSyncWithDocuments",b="ErrorDetails",C="VerificationErrorInfo",T=new Date,w=function(i,n,a){v&&(v=null),v=new XMLHttpRequest,g=a;var r=t(i);if(r){var o,s={StartTime:new Date,Duration:null,FinishTime:null,message:""},l=i.serverParameters;v.addEventListener("load",function(t){if(i.timingInfo){s.FinishTime=new Date,s.Duration=(s.FinishTime-s.StartTime)/1e3;var a="Time: "+s.Duration+" seconds.";s.message=a}if(null==v||4!=v.readyState||200!=v.status){if(v.responseText.length>0){var r=new Error(v.responseText);return void e.report(g,r)}var r=new Error("The RTTI server may be offline or does not exist.");return void e.report(g,r)}try{o=JSON.parse(this.response)}catch(l){o=null}if(null==o){var r=new Error("We didn't receive a valid server response.");return void e.report(g,r)}if(o.exceptionMessage||o.Message&&o.Message.length>0){var r=new Error(o.Message);return void e.report(g,r)}"function"==typeof n&&(i.timingInfo?n(o,s):n(o,null))}),v.addEventListener("error",function(t){if(0==v.status){var i=new Error("The RTTI server may be offline or does not exist.");return void e.report(g,i)}if(null==t.Message||"undefined"==t.Message){var i=new Error("The RTTI server may be offline or does not exist.");return void e.report(g,i)}var i=new Error(t.Message);return void e.report(g,i)}),v.open("POST",i.url,!0),v.setRequestHeader("Accept","application/json");var c=new FormData;if(l)for(var u in l)l.hasOwnProperty(u)&&c.append(u,l[u]);for(var f=0;f<i.images.length;f++)c.append("file"+f,new Blob([i.images[f]],{type:"image/jpeg"}));v.send(c)}},I=function(i,n,a){v&&(v=null),v=new XMLHttpRequest,g=a;var r=t(i);if(r){var o={StartTime:new Date,Duration:null,FinishTime:null,message:""},s=i.serverParameters;v.addEventListener("load",function(t){if(i.timingInfo){o.FinishTime=new Date,o.Duration=(o.FinishTime-o.StartTime)/1e3;var a="Time: "+o.Duration+" seconds.";o.message=a}if(null==v||4!=v.readyState||200!=v.status){if(v.responseText.length>0){var r=new Error(v.responseText);return void e.report(g,r)}var r=new Error("The RTTI server may be offline or does not exist.");return void e.report(g,r)}n(this.response,o)}),v.addEventListener("error",function(t){if(0==v.status){var i=new Error("The RTTI server may be offline or does not exist.");return void e.report(g,i)}if(null==t.Message||"undefined"==t.Message){var i=new Error("The RTTI server may be offline or does not exist.");return void e.report(g,i)}var i=new Error(t.Message);return void e.report(g,i)}),v.open("POST",i.url,!0),v.setRequestHeader("Accept","application/json");var l=new FormData;if(s)for(var c in s)s.hasOwnProperty(c)&&l.append(c,s[c]);for(var u=0;u<i.images.length;u++)l.append("file"+u,new Blob([i.images[u]],{type:"image/jpeg"}));v.send(l)}},x=function(e,t,n){return i(e,t,n)},A=function(t,n,a){p=t;var r=u(t,a);if(r){T=new Date;var o=function(t){if(m=d(t),null===m||"undefined"==typeof m){var i=new Error("Session id is not defined.");return void e.report(errorCallBackForKTA,i)}var r=O(p);N(r,function(e){R(e,n,a)},function(e){a(e)})},s=function(t){var i=new Error(t);e.report(a,i)};if("undefined"!=typeof p.serverParameters.sessionId&&null!=p.serverParameters.sessionId){m=p.serverParameters.sessionId;var l=O(p);N(l,function(e){R(e,n,a)},function(e){a(e)})}else i(t,o,s)}},E=function(t,n,a){p=t;var r=u(t,a);if(r){T=new Date;var o=function(t){if(m=d(t),null===m||"undefined"==typeof m){var i=new Error("Session id is not defined.");return void e.report(a,i)}var r=P(p);N(r,function(e){D(e,n,a)},function(e){a(e)})},s=function(t){var i=new Error(t);e.report(a,i)};if("undefined"!=typeof p.serverParameters.sessionId&&null!=p.serverParameters.sessionId){m=p.serverParameters.sessionId;var l=P(p);N(l,function(e){D(e,n,a)},function(e){a(e)})}else i(t,o,s)}},P=function(e){delete e.serverParameters.sessionId;var t=a(),i=t.jobWithDocsInitialization,n=i.Documents;G(e.images,n[0].PageDataList),t.sessionId=m,t.processIdentity.Name=e.serverParameters.processIdentityName,e.serverParameters.ktaDeleteDocument&&"YES"===e.serverParameters.ktaDeleteDocument?t.jobWithDocsInitialization.StoreFolderAndDocuments=!1:t.jobWithDocsInitialization.StoreFolderAndDocuments=!0,U(e);for(var r=i.InputVariables,o=Object.keys(e.serverParameters),s=0;s<o.length;s++){var l={Value:e.serverParameters[o[s]],Id:o[s]};r.push(l)}var c={url:e.url+y,serverParameters:t};return c},D=function(t,i,n){if(!F(t,n,!1)){var a=_(t);if(null==a){var r=new Error("Authentication Results not found in Server response");return void e.report(n,r)}var o=j(p);null!=o?i(a,o):i(a,null)}},_=function(e){var t=k(e),i=r(t);if(null==i)return null;var n=o(e),a={authenticationResponse:i,extractionResponse:n};return a},M=function(e,t,i){p=e;var n=u(e,i);if(n&&(T=new Date,"undefined"!=typeof p.serverParameters.sessionId&&null!=p.serverParameters.sessionId)){m=p.serverParameters.sessionId;var a=O(p);N(a,function(e){L(e,t)},function(e){i(e)})}},O=function(e){delete e.serverParameters.sessionId;var t=l(),i=t.jobWithDocsInitialization,n=i.Documents;G(e.images,n[0].PageDataList),t.sessionId=m,t.processIdentity.Name=e.serverParameters.processIdentityName,e.serverParameters.ktaDeleteDocument&&"YES"===e.serverParameters.ktaDeleteDocument?t.jobWithDocsInitialization.Documents[0].DeleteDocument=!0:t.jobWithDocsInitialization.Documents[0].DeleteDocument=!1,U(e);for(var a=i.InputVariables,r=Object.keys(e.serverParameters),o=0;o<r.length;o++){var s={Value:e.serverParameters[r[o]],Id:r[o]};a.push(s)}var c={url:e.url+y,serverParameters:t};return c},L=function(e,t){var i=j(p);t(e,i)},R=function(t,i,n){var a=h(t);if(null===a||"undefined"==typeof a){var r=new Error("Document id is not defined.");return void e.report(n,r)}if(!F(t,n,!0)){var o=c(t),s=j(p);return void(null!=s?i(o,s):i(o))}},k=function(e){var t=e.d;return null===t||"undefined"===t?null:t.ReturnedDocumentFields[0].ReturnedDocumentFields},F=function(t,i,n){var a=k(t);if(null==a)return!0;for(var r=0;r<a.length;r++)if(a[r].Name==b&&n||a[r].Name==C){var o=a[r].Value;if(null!=o){var s;if("string"==typeof o){if(0===o.length)return!1;s=JSON.parse(o)}else s=o;var l=new Error(n?s.errordescription:s.ErrorMessage);return e.report(i,l),!0}return!1}return!1},U=function(e){delete e.serverParameters.processIdentityName,delete e.serverParameters.username,delete e.serverParameters.password,delete e.serverParameters.documentGroupName,delete e.serverParameters.documentName,delete e.serverParameters.ktaDeleteDocument},G=function(e,t){for(var i=0;i<e.length;i++){var n={Data:null,Base64Data:e[i],RuntimeFields:{},MimeType:"image/jpeg"};t.push(n)}},N=function(t,i,n){v&&(v=null),v=new XMLHttpRequest;var a,r=t.serverParameters;v.addEventListener("load",function(t){if(null==v||4!=v.readyState||200!=v.status){if(v.responseText.length>0){var r=new Error(v.responseText);return void e.report(n,r)}var r=new Error("The KTA server may be offline or does not exist.");return void e.report(n,r)}try{a=JSON.parse(this.response)}catch(o){a=null}if(null==a){var r=new Error("We didn't receive a valid server response.");return void e.report(n,r)}if(a.exceptionMessage||a.Message&&a.Message.length>0){var r=new Error(a.Message);return void e.report(n,r)}"function"==typeof i&&i(a)}),v.addEventListener("error",function(t){if(0==v.status){var i=new Error("The KTA server may be offline or does not exist.");return void e.report(n,i)}if(null==t.Message||"undefined"==t.Message){var i=new Error("The KTA server may be offline or does not exist.");return void e.report(n,i)}var i=new Error(t.Message);return void e.report(n,i)}),v.open("POST",t.url,!0),v.setRequestHeader("Accept","application/json"),v.setRequestHeader("Content-Type","application/json;charset=utf-8"),v.timeout=6e4,v.ontimeout=function(){var t=new Error("Session Timeout occurred.");e.report(n,t)},v.send(JSON.stringify(r))},j=function(e){var t=null;if(p.timingInfo){t={StartTime:T,Duration:null,FinishTime:null,message:""},t.FinishTime=new Date,t.Duration=(t.FinishTime-t.StartTime)/1e3;var i="Time: "+t.Duration+" seconds.";t.message=i}return t},B=function(){v&&null!=v&&(v.abort(),v=null)};return{extractWithRttiServer:w,performExtractionWithRttiServer:I,loginToKTAServer:x,authenticateIDWithKtaServer:E,extractWithKtaServer:A,executeRequestOnKtaServer:M,cancelExtraction:B}}(),function(){"use strict";function t(e,t,i){if(this.screenWidth=e,this.screenHeight=t,this.screenSquare=this.screenWidth*this.screenHeight,this.padding=i.framePadding,this.aspectRatio=i.frameAspectRatio,this.color=i.frameCornerColor,this.transparency=i.outOfFrameTransparency,this.cornerWidth=i.frameCornerWidth,this.cornerHeight=i.frameCornerHeight,this.options=i,0===this.aspectRatio)this.x=this.padding*this.screenWidth/100,this.y=this.padding*this.screenHeight/100,this.width=this.screenWidth-2*this.x,this.height=this.screenHeight-2*this.y;else{var n=this.padding*this.screenWidth/100,a=this.padding*this.screenHeight/100,r=(this.screenWidth-this.aspectRatio*this.screenHeight)/2,o=n,s=(o-r)/this.aspectRatio,l=this.screenWidth-2*o,c=this.screenHeight-2*s,u=o>=0&&s>=a&&l>0&&c>0,f=l*c,h=a,d=r+h*this.aspectRatio,p=this.screenWidth-2*d,m=this.screenHeight-2*h,g=d>=n&&h>=0&&p>0&&m>0,v=p*m;if(u&&g)this.x=f>v?o:d,this.y=f>v?s:h,this.width=f>v?l:p,this.height=f>v?c:m;else if(u&&!g)this.x=o,this.y=s,this.width=l,this.height=c;else{if(u||!g)throw Error("Aspect ratio "+this.aspectRatio+" and padding "+this.padding+" are incorrect");
this.x=d,this.y=h,this.width=p,this.height=m}}this.x=Math.round(this.x),this.y=Math.round(this.y),this.width=Math.round(this.width),this.height=Math.round(this.height),this.mx=this.x+this.width/2,this.my=this.y+this.height/2,this.square=this.width*this.height;var S=this.x,y=this.y,b=S+this.width,C=y+this.height,T=this.screenWidth,w=this.screenHeight,I=this.cornerWidth,x=this.cornerHeight,A=S-x,E=y-x,P=I-x,D=b-P,_=C-P;this.boostParamsForOutOfFrameRender=[[0,0,S,w],[S,0,T,y],[T-S,y,S,w],[S,w-y,T-2*S,y]],this.boostParamsForFrameCornersRender=[[A,E,I,x],[A,E,x,I],[D,E,I,x],[b,E,x,I],[A,_,x,I],[A,C,I,x],[D,C,I,x],[b,_,x,I]]}function i(e,t){for(var i=0;i<t.length;i++)e.fillRect.apply(e,t[i])}t.prototype.getTargetFrameCropData=function(t,i){var n,a,r=Math.sqrt(t*i/this.screenSquare),o=e.GeneralSettings.getSettingsForRealTimeEdgeDetection().targetFrameCropEvrsPadding,s=Math.floor(r*this.x-o),l=Math.floor(r*this.y-o);if(s<0||l<0)s=0,l=0,n=t,a=i;else{var c=2*o;n=Math.ceil(r*this.width+c),a=Math.ceil(r*this.height+c)}return[s,l,n,a]},t.prototype.drawImage=function(t,i){var n="";n=i===e.Hints.HOLD_STEADY||i===e.Hints.CAPTURE_OK?this.options.targetFrameSuccessBackground:this.options.targetFrameBackground,"string"==typeof this.options.targetFrameBackground&&(this.image=document.createElement("img"),this.image.src=e.Utils.getImageUrl(n));var a=this.image;if(a.naturalWidth&&a.naturalHeight){var r;if(this.width!==-1&&this.height!==-1){var o=this.width/a.naturalWidth,s=this.height/a.naturalHeight;r=Math.min(o,s)}else r=1;var l=a.naturalWidth*r,c=a.naturalHeight*r,u=this.x,f=this.y;t.drawImage(a,u,f,l,c)}},t.prototype.draw=function(t,n){t.beginPath(),t.fillStyle="#000000",t.globalAlpha=this.transparency,i(t,this.boostParamsForOutOfFrameRender),t.globalAlpha=1,this.drawImage(t,n),n===e.Hints.HOLD_STEADY||n===e.Hints.CAPTURE_OK?(t.strokeStyle=this.color,t.lineWidth=this.cornerHeight,t.rect(this.x,this.y,this.width,this.height)):(t.fillStyle=this.color,i(t,this.boostParamsForFrameCornersRender)),t.closePath(),t.stroke()},e.Frame=t}(),e.Guidance=function(){"use strict";function t(t){(t.square<ee||0===P&&t.ratio>Q||P>0&&Math.abs(t.ratio-P)>$)&&c(e.Hints.FILL_AREA)}function i(t){for(var i,n,a,r=0;r<t.length;r++)if(i=t.get(r),n=i[0],a=i[1],n<Y||n>Z||a<Y||a>J){c(e.Hints.FILL_AREA);break}}function n(t){(Math.abs(M-t.mx)>L||Math.abs(O-t.my)>R)&&c(e.Hints.CENTER)}function a(t){U/t.square<ne.minFillFraction&&c(e.Hints.ZOOM_OUT)}function r(t){if(U/t.square>ne.maxFillFraction)return void c(e.Hints.ZOOM_IN);var i=ne.longAxisThreshold,n=ne.shortAxisThreshold;if(0!==i||0!==n){var a=0!==i&&t["long"]>=k,r=0!==n&&t["short"]>=F;a||r||c(e.Hints.ZOOM_IN)}}function o(t){if(!t.isSquareShape&&90!==ne.turnSkewAngleTolerance){var i=Math.abs(t.angle)%180;i=Math.min(i,180-i);var n=_>D?90-i:i;n>ne.turnSkewAngleTolerance&&c(e.Hints.ROTATE)}}function s(){"function"==typeof DeviceOrientationEvent.requestPermission&&null===he.getIsAvailable()&&ie.motionPermissionInstruction.visible&&c(e.Hints.LEVEL_PERMISSIONS)}function l(){fe&&(45!==ne.pitchThreshold&&ue>ne.pitchThreshold&&c(e.Hints.HOLD_LEVEL),45!==ne.rollThreshold&&ce>ne.rollThreshold&&c(e.Hints.HOLD_LEVEL))}function c(t){if(void 0===se[t]?se[t]=1:se[t]++,z=!0,X<te)X++;else{var i,n=0;for(var a in se)se.hasOwnProperty(a)&&n<se[a]&&(n=se[a],i=a);i===e.Hints.HOLD_STEADY?void 0===q&&(q=setTimeout(function(){i=e.Hints.CAPTURE_OK,e.CaptureEventAppStats.logCaptureGuidanceEvents(i,"",1),V&&V(i),u(),q=void 0},ne.captureTimeout)):(clearTimeout(q),q=void 0),e.CaptureEventAppStats.logCaptureGuidanceEvents(i,"",1),V(i),u()}}function u(){se={},X=1}function f(t){e.Utils.validateOptions(t,re)}function h(){return e.Utils.getOptions(ne)}function d(){return e.Utils.getOptions(ae)}function p(t){f(t),e.Utils.setOptions(ne,t,ae)}function m(){e.Utils.resetOptions(ne,ae)}function g(e){V=e,he.addListener(me)}function v(){V=void 0,he.removeListener(me)}function S(t,i,n){if(void 0!==i&&T(i)===!0){var a=C(i);t.canvas.setAttribute("aria-label",a);var r=b(i),o=y();r.length>o&&r.substring(0,o),i===e.Hints.LEVEL_PERMISSIONS||ie.drawInstructionsAsText===!0?w(t,n,r):t.drawImage(oe[i],G,N,j,j)}}function y(){return 60}function b(t){return t===e.Hints.FILL_AREA&&ie.fitDocumentInstruction.visible===!0?ie.fitDocumentInstruction.text:t===e.Hints.ZOOM_IN&&ie.zoomInInstruction.visible===!0?ie.zoomInInstruction.text:t===e.Hints.ZOOM_OUT&&ie.zoomOutInstruction.visible===!0?ie.zoomOutInstruction.text:t===e.Hints.CENTER&&ie.centerDocumentInstruction.visible===!0?ie.centerDocumentInstruction.text:t===e.Hints.ROTATE&&ie.rotateDeviceInstruction.visible===!0?ie.rotateDeviceInstruction.text:t===e.Hints.LEVEL_PERMISSIONS&&ie.motionPermissionInstruction.visible===!0?ie.motionPermissionInstruction.text:t===e.Hints.HOLD_LEVEL&&ie.holdDeviceLevelInstruction.visible===!0?ie.holdDeviceLevelInstruction.text:t===e.Hints.HOLD_STEADY&&ie.holdSteadyInstruction.visible===!0?ie.holdSteadyInstruction.text:t===e.Hints.CAPTURE_OK&&ie.doneInstruction.visible===!0?ie.doneInstruction.text:""}function C(t){return t===e.Hints.FILL_AREA&&ie.fitDocumentInstruction.visible===!0?ie.fitDocumentInstruction.accessibilityText:t===e.Hints.ZOOM_IN&&ie.zoomInInstruction.visible===!0?ie.zoomInInstruction.accessibilityText:t===e.Hints.ZOOM_OUT&&ie.zoomOutInstruction.visible===!0?ie.zoomOutInstruction.accessibilityText:t===e.Hints.CENTER&&ie.centerDocumentInstruction.visible===!0?ie.centerDocumentInstruction.accessibilityText:t===e.Hints.ROTATE&&ie.rotateDeviceInstruction.visible===!0?ie.rotateDeviceInstruction.accessibilityText:t===e.Hints.LEVEL_PERMISSIONS&&ie.motionPermissionInstruction.visible===!0?ie.motionPermissionInstruction.accessibilityText:t===e.Hints.HOLD_LEVEL&&ie.holdDeviceLevelInstruction.visible===!0?ie.holdDeviceLevelInstruction.accessibilityText:t===e.Hints.HOLD_STEADY&&ie.holdSteadyInstruction.visible===!0?ie.holdSteadyInstruction.accessibilityText:t===e.Hints.CAPTURE_OK&&ie.doneInstruction.visible===!0?ie.doneInstruction.accessibilityText:""}function T(t){return ie.enableAutoCapture!==!1&&(t===e.Hints.FILL_AREA&&ie.fitDocumentInstruction.visible===!0||t===e.Hints.ZOOM_IN&&ie.zoomInInstruction.visible===!0||t===e.Hints.ZOOM_OUT&&ie.zoomOutInstruction.visible===!0||t===e.Hints.CENTER&&ie.centerDocumentInstruction.visible===!0||t===e.Hints.ROTATE&&ie.rotateDeviceInstruction.visible===!0||t===e.Hints.LEVEL_PERMISSIONS&&ie.motionPermissionInstruction.visible===!0||t===e.Hints.HOLD_LEVEL&&ie.holdDeviceLevelInstruction.visible===!0||t===e.Hints.HOLD_STEADY&&ie.holdSteadyInstruction.visible===!0||t===e.Hints.CAPTURE_OK&&ie.doneInstruction.visible===!0)}function w(t,i,n){try{t.save(),i[0]="20px",t.font=i.join(" "),t.fillStyle=ie.instructionsTextColor;var a=24;e.Utils.drawMultiLineTextOnCanvas(t,n,D,a,W)}finally{t.restore()}}function I(){for(var e in oe)if(oe.hasOwnProperty(e)){var t=oe[e],i=t.getContext("2d");i.clearRect(0,0,t.width,t.height),i=null,t=null}oe={},H=void 0}function x(t){void 0===H&&(H={},H[e.Hints.FILL_AREA]="fit-document.png",H[e.Hints.ZOOM_IN]="zoom-in.png",H[e.Hints.ZOOM_OUT]="zoom-out.png",H[e.Hints.CENTER]="center.png",H[e.Hints.ROTATE]="rotate.png",H[e.Hints.HOLD_LEVEL]="hold-parallel.png",H[e.Hints.HOLD_STEADY]="hold-steady.png",H[e.Hints.CAPTURE_OK]="done.png");var i=0,n={},a=Object.keys(H).length;for(var r in H)if(H.hasOwnProperty(r)){var o=new Image;o.src=e.Utils.getImageUrl(H[r]);var s=function(r,o){return function(){var s=e.ImageUtils.createEmptyCanvas(j,j),l=s.getContext("2d"),c=j/2;l.beginPath(),l.globalAlpha=B,l.arc(c,c,c-2,0,2*Math.PI),l.fillStyle=ie.instructionsBackgroundColor,l.fill(),l.globalAlpha=1,l.globalCompositeOperation="source-over",K==KfxWebSDK.orientation.PORTRAIT?l.drawImage(o,0,0,j,j):(l.translate(j/2,j/2),l.rotate(90*Math.PI/180),l.drawImage(o,j/2,j/2,-j,-j)),l.closePath(),oe[r]=s,i++,o.removeEventListener("load",n[r]),delete n[r],i===a&&t()}}(r,o);n[r]=s,o.addEventListener("load",s)}}e.Hints={FILL_AREA:"0",ZOOM_IN:"1",ZOOM_OUT:"2",CENTER:"3",ROTATE:"4",LEVEL_PERMISSIONS:"5",HOLD_LEVEL:"6",HOLD_STEADY:"7",CAPTURE_OK:"8"};var A,E,P,D,_,M,O,L,R,k,F,U,G,N,j,B,H,V,K,W,z,q,X,Y,Z,J,Q,$,ee,te,ie,ne={minFillFraction:.65,maxFillFraction:1.8,longAxisThreshold:85,shortAxisThreshold:60,centerToleranceFraction:.19,captureTimeout:1700,turnSkewAngleTolerance:10,pitchThreshold:15,rollThreshold:15},ae={minFillFraction:.65,maxFillFraction:1.8,longAxisThreshold:85,shortAxisThreshold:60,centerToleranceFraction:.19,captureTimeout:1700,turnSkewAngleTolerance:10,pitchThreshold:15,rollThreshold:15},re={minFillFraction:{type:"number",min:{value:0,include:!1},max:{value:1,include:!1}},maxFillFraction:{type:"number",min:{value:1,include:!1}},longAxisThreshold:{type:"number",min:{value:0,include:!0},max:{value:100,include:!0}},shortAxisThreshold:{type:"number",min:{value:0,include:!0},max:{value:100,include:!0}},centerToleranceFraction:{type:"number",min:{value:0,include:!1},max:{value:1,include:!1}},captureTimeout:{type:"number",min:{value:0,include:!1}},turnSkewAngleTolerance:{type:"number",min:{value:0,include:!0},max:{value:90,include:!0}},pitchThreshold:{type:"number",min:{value:0,include:!0},max:{value:45,include:!0}},rollThreshold:{type:"number",min:{value:0,include:!0},max:{value:45,include:!0}}},oe={},se={},le=[s,t,i,l,o,a,n,r],ce=0,ue=0,fe=!1,he=new e.LevelSensor,de=function(t,i,n,a){A=t.screenWidth,E=t.screenHeight,D=t.width,_=t.height,M=t.mx,O=t.my,U=t.square,ie=n;var r=j!==n.guidanceSize||B!==n.iconTransparency||K!==n.guidanceOrientation||W!==n.instructionsAsTextOrientation;j=n.guidanceSize,B=n.iconTransparency,K=n.guidanceOrientation,W=n.instructionsAsTextOrientation,G=(A-j)/2,N=(E-j)/2,u();var o=e.GeneralSettings.getSettingsForRealTimeEdgeDetection();return Y=i*o.outOfScreenDownscaledPadding,Z=A-Y,J=E-Y,L=D*ne.centerToleranceFraction,R=_*ne.centerToleranceFraction,k=Math.max(D,_)*ne.longAxisThreshold/100,F=Math.min(D,_)*ne.shortAxisThreshold/100,P=e.Math.getLongToShortAspectRatio(t.aspectRatio),Q=o.maxRatioThreshold,$=o.maxRatioDeviationThreshold,ee=U*o.minSquareThreshold,te=o.maxGuidanceThreshold,r||void 0===H?void x(a):void a()},pe=function(t){if(ie.enableAutoCapture!==!1){z=!1;var i=new e.Rectangle(t);for(var n in le)if(le.hasOwnProperty(n)&&(le[n](i),z))return;c(e.Hints.HOLD_STEADY)}},me=function(e){if(!fe){if(!e)return;fe=!0}ue=Math.abs(e.beta),ce=Math.abs(e.gamma)};return{configure:de,draw:S,levelSensor:he,processRectangle:pe,processGuidance:c,clearGuidance:u,start:g,stop:v,getOptions:h,getDefaultOptions:d,setOptions:p,resetOptions:m,clearCanvases:I}}(),e.ImageProcessor=function(){"use strict";function t(t,r){var o=n(t),s=t.width,l=t.height,c=s>>4,u=.85,f=t.data,h=i(s,l),d=h.data,p=new Uint32Array(d.buffer),m=0,g=0,v=0;for(g=0;g<l;g++,v+=s)for(m=0;m<s;m++){var S=f[v+m<<2],y=Math.max(m-c,0),b=Math.max(g-c,0),C=Math.min(m+c,s-1),w=Math.min(g+c,l-1),I=(C-y+1)*(w-b+1),x=a(o,s,y,b,C,w);S*I>x*u?p[v+m]=4294967295:p[v+m]=4278190080}"function"==typeof r&&(e.ProcessEventAppStats.logAppStats({ProcessingProfile:T.BITONAL}),r(h))}function i(e,t){var i=document.createElement("canvas");return i.getContext("2d").createImageData(e,t)}function n(e){var t=e.data,i=e.width,n=e.height,a=new Int32Array(i*n),r=0,o=0,s=0,l=0;for(r=0;r<i;r++)l+=t[r<<2],a[r]=l;for(o=1,s=i;o<n;o++,s+=i)for(l=0,r=0;r<i;r++)l+=t[s+r<<2],a[s+r]=a[s-i+r]+l;return a}function a(e,t,i,n,a,r){var o=e[a+r*t];return n>0&&(o-=e[a+(n-1)*t],i>0&&(o+=e[i-1+(n-1)*t])),i>0&&(o-=e[i-1+r*t]),o}var r,o=1024,s=1048576,l=function(t,i,n){e.Utils.verifyImageData("imageData",t);var a=t.width,r=t.height,o=new jsfeat.matrix_t(a,r,jsfeat.U8_t|jsfeat.C1_t),s=jsfeat.COLOR_RGBA2GRAY;jsfeat.imgproc.grayscale(t.data,a,r,o,s);for(var l=new Uint32Array(t.data.buffer),c=255<<24,u=o.cols*o.rows,f=0;--u>=0;)f=o.data[u],l[u]=c|f<<16|f<<8|f;i(t)},c=function(t,i,n){e.Utils.verifyImageData("imageData",t),r=i,e.ProcessEventAppStats.logProcessStartTime(T.BITONAL),l(t,f,n)},u=function(t,i,n,a){e.Utils.verifyImageData("imageData",t),e.ProcessEventAppStats.logProcessStartTime(T.SETDPI),e.Utils.validateOptions(i,{dpi:{mandatory:!0,type:"number",min:{value:0,include:!1}}});var r=t.width,o=t.height,s=document.createElement("canvas"),l=s.getContext("2d");s.width=r,s.height=o,l.putImageData(t,0,0);var c=s.toDataURL("image/jpeg"),u={};u[piexif.ImageIFD.XResolution]=[i.dpi,1],u[piexif.ImageIFD.YResolution]=[i.dpi,1];var f={"0th":u},h=piexif.dump(f),d=piexif.insert(h,c);return e.ProcessEventAppStats.logAppStats({ProcessingProfile:T.SETDPI}),n(d)},f=function(e){t(e,r)},h=function(t,i,n,a){e.Utils.verifyImageData("imageData",t),e.ProcessEventAppStats.logProcessStartTime(T.AUTOCROP);for(var r=[],o=Object.keys(KfxWebSDK.document),s=0;s<o.length;s++)r.push(KfxWebSDK.document[o[s]]);e.Utils.validateOptions(i,{type:{type:"number",options:r,mandatory:!0}});var l=[KfxWebSDK.document.MOBILE_ID,KfxWebSDK.document.CHECK,KfxWebSDK.document.PASSPORT];if(l.indexOf(i.type)<0&&void 0!==i.type)return void n(t);i.type=KfxWebSDK.document.CHECK;var c=new e.CannyDetector(t,i.type),u=c.process();e.ProcessEventAppStats.logAppStats({ProcessingProfile:T.AUTOCROP}),n(u)},d=function(t,i,n,a){e.Utils.verifyImageData("imageData",t),e.ProcessEventAppStats.logProcessStartTime(T.SCALE),e.Utils.validateOptions(i,{scaleMegapixels:{mandatory:!0,type:"number",min:{value:0,include:!1}}});var r=1,l=i.scaleMegapixels,c=t.width,u=t.height,f=c,h=u;if(l){var d=f*h/s;r=d<=l?1:Math.sqrt(l/d)}if(1===r)return void n(t);f*=r,h*=r;for(var p=e.ImageUtils.createEmptyCanvas(f,h),m=p.getContext("2d"),g=o,v=e.ImageUtils.createEmptyCanvas(g,g),S=v.getContext("2d"),y=Math.ceil(g*f/c),b=Math.ceil(g*h/u),C=0,w=0,I=0,x=0;C<u;){for(I=0,x=0;I<c;)S.clearRect(0,0,g,g),S.putImageData(t,-I,-C),m.drawImage(v,0,0,g,g,x,w,y,b),I+=g,x+=y;C+=g,w+=b}var A=m.getImageData(0,0,f,h);e.ProcessEventAppStats.logAppStats({ProcessingProfile:T.SCALE}),n(A)};return{processImageToBitonal:c,autoCrop:h,scaleImage:d,changeDPIForImage:u}}(),function(){"use strict";function t(e,t,i){if(this.screenWidth=e,this.screenHeight=t,this.screenSquare=this.screenWidth*this.screenHeight,this.padding=i.framePadding,this.aspectRatio=i.frameAspectRatio,this.color=i.frameColor,this.transparency=i.outOfFrameTransparency,this.outOfFrameColor=i.outOfFrameColor,this.frameThickness=i.frameThickness,0===this.aspectRatio)this.x=this.padding*this.screenWidth/100,this.y=this.padding*this.screenHeight/100,this.width=this.screenWidth-2*this.x,this.height=this.screenHeight-2*this.y;else{var n=this.padding*this.screenWidth/100,a=this.padding*this.screenHeight/100,r=(this.screenWidth-this.aspectRatio*this.screenHeight)/2,o=n,s=(o-r)/this.aspectRatio,l=this.screenWidth-2*o,c=this.screenHeight-2*s,u=o>=0&&s>=a&&l>0&&c>0,f=l*c,h=a,d=r+h*this.aspectRatio,p=this.screenWidth-2*d,m=this.screenHeight-2*h,g=d>=n&&h>=0&&p>0&&m>0,v=p*m;if(u&&g)this.x=f>v?o:d,this.y=f>v?s:h,this.width=f>v?l:p,this.height=f>v?c:m;else if(u&&!g)this.x=o,this.y=s,this.width=l,this.height=c;else{if(u||!g)throw Error("Aspect ratio "+this.aspectRatio+" and padding "+this.padding+" are incorrect");this.x=d,this.y=h,this.width=p,this.height=m}}this.x=Math.round(this.x),this.y=Math.round(this.y),this.width=Math.round(this.width),this.height=Math.round(this.height),this.mx=this.x+this.width/2,this.my=this.y+this.height/2,this.square=this.width*this.height,this.radiusX=this.width/2,this.radiusY=this.height/2,this.square=this.width*this.height,this.rotation=0,this.start=0,this.end=2*Math.PI,this.clockwise=!1}function i(e,t,i,n,a,r,o,s,l){e.ellipse(t,i,n,a,r,o,s,l)}t.prototype.draw=function(t,n,a,r){t.beginPath(),t.globalAlpha=this.transparency,t.fillStyle=this.outOfFrameColor,t.fillRect(0,0,this.screenWidth,this.screenHeight),t.globalAlpha=1,n===e.SelfieHints.HOLD_STEADY||n===e.SelfieHints.CAPTURE_OK||n===e.SelfieHints.BLINK_NOW&&a>=4&&r===e.SelfieHints.BLINK_NOW?(t.strokeStyle="#00FF00",t.lineWidth=this.frameThickness,i(t,this.mx,this.my,this.radiusX,this.radiusY,this.rotation,this.start,this.end,this.clockwise)):(t.strokeStyle=this.color,t.lineWidth=this.frameThickness,i(t,this.mx,this.my,this.radiusX,this.radiusY,this.rotation,this.start,this.end,this.clockwise)),t.globalCompositeOperation="destination-out",t.fill(),t.globalCompositeOperation="source-over",t.stroke(),t.closePath()},e.SelfieFrame=t}(),e.SelfieGuidance=function(){"use strict";function t(t){_*W.minFaceSize>t.square?(te(!1),a(e.SelfieHints.MOVE_CLOSER)):_<t.square&&(te(!1),a(e.SelfieHints.MOVE_BACK))}function i(t){(Math.abs(A-t.mx)>P||Math.abs(E-t.my)>D)&&(te(!1),a(e.SelfieHints.CENTER_FACE))}function n(){H.enableAutoCapture===!0&&H.enableBlinkDetection===!1?a(e.SelfieHints.HOLD_STEADY):H.enableAutoCapture===!1?a(e.SelfieHints.BLINK_NOW):X||(j.blinkDetectedListener=function(){te(!0),a(e.SelfieHints.HOLD_STEADY)},a(e.SelfieHints.BLINK_NOW))}function a(t){if(void 0===Z[t]?Z[t]=1:Z[t]++,U=!0,N<V)N++;else{var i,n=0;for(var a in Z)Z.hasOwnProperty(a)&&n<Z[a]&&(n=Z[a],i=a);i===e.SelfieHints.HOLD_STEADY?void 0===G&&(G=setTimeout(function(){i=e.SelfieHints.CAPTURE_OK,e.SelfieCaptureEventAppStats.logSelfieCaptureGuidanceEvents(i,"",1),F(i),r(),G=void 0},W.captureTimeout)):(clearTimeout(G),G=void 0),e.SelfieCaptureEventAppStats.logSelfieCaptureGuidanceEvents(i,"",1),F(i),r()}}function r(){Z={},N=1}function o(t){e.Utils.validateOptions(t,q)}function s(){return e.Utils.getOptions(W)}function l(){return e.Utils.getOptions(z)}function c(t){o(t),e.Utils.setOptions(W,t,z)}function u(){e.Utils.resetOptions(W,z)}function f(e){F=e}function h(){F=void 0,te(!1)}function d(t,i,n){void 0!==B&&B===i?J+=1:J=0,B=i;var a=v(i);t.canvas.setAttribute("aria-label",a);var r=g(i),o=m(i);r.length>o&&(r=r.substring(0,o)),void 0!==i&&J>=4&&i===e.SelfieHints.BLINK_NOW&&S(i)?y(t,n,r):void 0!==i&&(i===e.SelfieHints.CAPTURE_OK||J>=4)&&S(i)&&(K.drawInstructionsAsText===!0?p(t,n,r):t.drawImage(Y[i],M,O,L,L))}function p(t,i,n){try{t.save(),i[0]="20px",t.font=i.join(" "),t.fillStyle=K.instructionsTextColor;var a=24;e.Utils.drawMultiLineTextOnCanvas(t,n,I,a,"PORTRAIT")}finally{t.restore()}}function m(t){return t===e.SelfieHints.BLINK_NOW?30:60}function g(t){return t===e.SelfieHints.CENTER_FACE&&K.centerFaceInstruction.visible===!0?K.centerFaceInstruction.text:t===e.SelfieHints.MOVE_CLOSER&&K.moveCloserInstruction.visible===!0?K.moveCloserInstruction.text:t===e.SelfieHints.MOVE_BACK&&K.moveBackInstruction.visible===!0?K.moveBackInstruction.text:t===e.SelfieHints.BLINK_NOW&&K.tapToCaptureInstruction.visible===!0&&K.enableAutoCapture===!1?K.tapToCaptureInstruction.text:t===e.SelfieHints.BLINK_NOW&&K.blinkSlowlyInstruction.visible===!0&&K.enableAutoCapture===!0?K.blinkSlowlyInstruction.text:t===e.SelfieHints.HOLD_STEADY&&K.holdSteadyInstruction.visible===!0?K.holdSteadyInstruction.text:t===e.SelfieHints.CAPTURE_OK&&K.doneInstruction.visible===!0?K.doneInstruction.text:""}function v(t){return t===e.SelfieHints.CENTER_FACE&&K.centerFaceInstruction.visible===!0?K.centerFaceInstruction.accessibilityText:t===e.SelfieHints.MOVE_CLOSER&&K.moveCloserInstruction.visible===!0?K.moveCloserInstruction.accessibilityText:t===e.SelfieHints.MOVE_BACK&&K.moveBackInstruction.visible===!0?K.moveBackInstruction.accessibilityText:t===e.SelfieHints.BLINK_NOW&&K.blinkSlowlyInstruction.visible===!0&&K.enableAutoCapture===!0?K.blinkSlowlyInstruction.accessibilityText:t===e.SelfieHints.BLINK_NOW&&K.tapToCaptureInstruction.visible===!0&&K.enableAutoCapture===!1?K.tapToCaptureInstruction.accessibilityText:t===e.SelfieHints.HOLD_STEADY&&K.holdSteadyInstruction.visible===!0?K.holdSteadyInstruction.accessibilityText:t===e.SelfieHints.CAPTURE_OK&&K.doneInstruction.visible===!0?K.doneInstruction.accessibilityText:""}function S(t){return t===e.SelfieHints.CENTER_FACE&&K.centerFaceInstruction.visible===!0||t===e.SelfieHints.MOVE_CLOSER&&K.moveCloserInstruction.visible===!0||t===e.SelfieHints.MOVE_BACK&&K.moveBackInstruction.visible===!0||t===e.SelfieHints.BLINK_NOW&&K.blinkSlowlyInstruction.visible===!0&&K.enableAutoCapture===!0||t===e.SelfieHints.BLINK_NOW&&K.tapToCaptureInstruction.visible===!0&&K.enableAutoCapture===!1||t===e.SelfieHints.HOLD_STEADY&&K.holdSteadyInstruction.visible===!0||t===e.SelfieHints.CAPTURE_OK&&K.doneInstruction.visible===!0}function y(e,t,i){var n=i;try{t[0]="20px",e.font=t.join(" ");var a=e.measureText(n),r=T-a.width>>1,o=E-(x>>1)-18;e.save(),e.fillStyle=K.instructionsBackgroundColor,e.fillRect(r-5,o-20,a.width+10,30),e.fillStyle=K.instructionsTextColor,e.fillText(n,r,o)}finally{e.restore()}}function b(){for(var e in Y)if(Y.hasOwnProperty(e)){var t=Y[e],i=t.getContext("2d");i.clearRect(0,0,t.width,t.height),i=null,t=null}Y={},k=void 0}function C(t){void 0===k&&(k={},k[e.SelfieHints.CENTER_FACE]="center_face.png",k[e.SelfieHints.MOVE_CLOSER]="move_closer.png",k[e.SelfieHints.MOVE_BACK]="move_back_new.png",k[e.SelfieHints.BLINK_NOW]="blink_now.png",k[e.SelfieHints.HOLD_STEADY]="hold-steady.png",k[e.SelfieHints.CAPTURE_OK]="done.png");var i=0,n={},a=Object.keys(k).length;for(var r in k)if(k.hasOwnProperty(r))if(r!==e.SelfieHints.BLINK_NOW){var o=new Image;o.src=e.Utils.getImageUrl(k[r]);var s=function(r,o){return function(){var s=e.ImageUtils.createEmptyCanvas(L,L),l=s.getContext("2d"),c=L/2;l.beginPath(),l.globalAlpha=R,l.arc(c,c,c-2,0,2*Math.PI),l.fillStyle=K.instructionsBackgroundColor,l.fill(),l.globalAlpha=1,l.globalCompositeOperation="source-over",l.drawImage(o,0,0,L,L),l.closePath(),Y[r]=s,i++,o.removeEventListener("load",n[r]),delete n[r],i===a&&t()}}(r,o);n[r]=s,o.addEventListener("load",s)}else i++}e.SelfieHints={CENTER_FACE:"0",MOVE_CLOSER:"1",MOVE_BACK:"2",BLINK_NOW:"3",HOLD_STEADY:"4",CAPTURE_OK:"5"};var T,w,I,x,A,E,P,D,_,M,O,L,R,k,F,U,G,N,j,B,H,V,K,W={minFaceSize:.5,centerToleranceFraction:.15,captureTimeout:1700},z={minFaceSize:.5,centerToleranceFraction:.15,captureTimeout:1700},q={minFaceSize:{type:"number",min:{value:0,include:!1},max:{value:1,include:!1}},centerToleranceFraction:{type:"number",min:{value:0,include:!1},max:{value:1,include:!1}},captureTimeout:{type:"number",min:{value:0,include:!1}}},X=!1,Y={},Z={},J=0,Q=[t,i,n],$=function(t,i,n,a){T=t.screenWidth,w=t.screenHeight,j=i,I=t.width,x=t.height,A=t.mx,E=t.my,_=t.square,H=n;var o=L!==n.guidanceSize||R!==n.guidanceTransparency;L=n.guidanceSize,R=n.guidanceTransparency,M=(T-L)/2,O=(w-L)/2,K=n,r(),X=!1;var s=e.GeneralSettings.getSettingsForRealTimeEdgeDetection();return P=I*W.centerToleranceFraction,D=x*W.centerToleranceFraction,V=s.maxGuidanceThreshold,o||void 0===k?void C(a):void a()},ee=function(t){U=!1;var i=new e.Rectangle(t);for(var n in Q)if(Q.hasOwnProperty(n)&&(Q[n](i),U))return;a(e.SelfieHints.HOLD_STEADY)},te=function(e){X=e,j.blinkDetectedListener=null,j.state=0},ie=function(){return J},ne=function(){return B};return{configure:$,draw:d,processRectangle:ee,processGuidance:a,clearGuidance:r,start:f,stop:h,getOptions:s,getDefaultOptions:l,setOptions:c,resetOptions:u,resetBlinkDetection:te,delay:ie,currentHint:ne,clearCanvases:b}}();var A={APP_STATS_UNINITIALIZED:"APP_STATS_UNINITIALIZED",APP_STATS_INITIALIZING:"APP_STATS_INITIALIZING",APP_STATS_INITIALIZED:"APP_STATS_INITIALIZED",APP_STATS_RECORDING:"APP_STATS_RECORDING",APP_STATS_EXPORTING:"APP_STATS_EXPORTING",APP_STATS_BEGINNING_SESSION:"APP_STATS_BEGINNING_SESSION"},E={ERROR_STATS_ALLREADY_INIT:"App Stats Already Initialized",ERROR_STATS_NOT_INIT:"App Stats Not Initialized. Please initialize first",ERROR_STATS_ALLREADY_RECORDING:"App Stats Already started recording",ERROR_STATS_BEGIN_SESSION_NOT_ALLOWED:"App Stats begin session not allowed in this state",ERROR_STATS_STARTED_BEGIN_SESSION_NOT_ALLOWED:"App Stats Session Started , Please stop session first",ERROR_STATS_END_SESSION_NOT_ALLOWED:"App Stats end session not allowed in this state",ERROR_STATS_LOG_SESSION_NOT_ALLOWED:"App Stats log session not allowed in this state",ERROR_STATS_LOG_FIELDCHANGE_NOT_ALLOWED:"App Stats log field change event not allowed in this state",ERROR_STATS_EXPORT_NOT_ALLOWED:"App Stats export not allowed in this state",ERROR_STATS_NOT_ALLOWED:"App Stats not allowed in this state",ERROR_STATS_STOP_NOT_ALLOWED:"App Stats stop record not allowed in this state",ERROR_STATS_EMPTY_PARAMS:"Parameters should not be empty"},P={SESSION_LOGGED:"session logged",FIELD_CHANGE_LOGGED:"field change event logged"},D=A.APP_STATS_UNINITIALIZED,_=function(){return D};KfxWebSDK.AppStats=function(){"use strict";var n=!1,a=function(t,i){if(e.Utils.verifyCallbacks({successCallBack:t,errorCallBack:i}),D!==A.APP_STATS_UNINITIALIZED){var n=new e.StateError(E.ERROR_STATS_ALLREADY_INIT);return void e.report(i,n)}D=A.APP_STATS_INITIALIZING,e.AppStats.initAppStats(t,i)},r=function(t,i){if(e.Utils.verifyCallbacks({successCallBack:t,errorCallBack:i}),D===A.APP_STATS_UNINITIALIZED){var a=new e.StateError(E.ERROR_STATS_NOT_INIT);return void e.report(i,a)}if(D===A.APP_STATS_RECORDING||D===A.APP_STATS_BEGINNING_SESSION||D===A.APP_STATS_EXPORTING){var r=new e.StateError(E.ERROR_STATS_ALLREADY_RECORDING);return void e.report(i,r)}0==d.length&&d.push(e.AppStats.prepareEnvironment()),D=A.APP_STATS_RECORDING,n=!0,h=!0,"function"==typeof t&&t(D)},o=function(t,i){if(e.Utils.verifyCallbacks({successCallBack:t,errorCallBack:i}),D!==A.APP_STATS_RECORDING){var a=new e.StateError(E.ERROR_STATS_STOP_NOT_ALLOWED+" "+_());return void e.report(i,a)}D=A.APP_STATS_INITIALIZED,n=!1,h=!1,"function"==typeof t&&t(D)},s=function(){return h},l=function(n,a,r){e.Utils.verifyCallbacks({successCallBack:a,errorCallBack:r});try{if(D===A.APP_STATS_UNINITIALIZED||D===A.APP_STATS_INITIALIZED||D===A.APP_STATS_EXPORTING||D===A.APP_STATS_BEGINNING_SESSION){var o=new e.StateError(E.ERROR_STATS_BEGIN_SESSION_NOT_ALLOWED+" "+_());return void e.report(r,o)}e.Utils.validateOptions(n,{sessionkey:{type:"string",mandatory:!0},category:{type:"string",mandatory:!0}}),t=n.sessionkey,i=n.category,D=A.APP_STATS_BEGINNING_SESSION,e.AppStats.logSessionEvent("BeginSession","",""),"function"==typeof a&&a(D)}catch(s){e.report(r,s)}},c=function(t,i,n){e.Utils.verifyCallbacks({successCallBack:i,errorCallBack:n});try{if(D!==A.APP_STATS_BEGINNING_SESSION){var a=new e.StateError(E.ERROR_STATS_LOG_SESSION_NOT_ALLOWED+" "+_());return void e.report(n,a)}e.Utils.validateOptions(t,{sessionType:{type:"string",mandatory:!0},response:{type:"string",mandatory:!1}}),e.AppStats.logSessionEvent(t.sessionType,t.response,t.DocumentID),"function"==typeof i&&i(P.SESSION_LOGGED)}catch(r){e.report(n,r)}},u=function(n,a,r){e.Utils.verifyCallbacks({successCallBack:a,errorCallBack:r});try{if(D===A.APP_STATS_UNINITIALIZED||D===A.APP_STATS_INITIALIZED||D===A.APP_STATS_EXPORTING||D===A.APP_STATS_RECORDING){var o=new e.StateError(E.ERROR_STATS_END_SESSION_NOT_ALLOWED+" "+_());return void e.report(r,o)}e.Utils.validateOptions(n,{success:{type:"boolean",mandatory:!0},message:{type:"string",mandatory:!1}}),n.success?e.AppStats.logSessionEvent("SessionCompleteSuccess",n.message,n.DocumentID):e.AppStats.logSessionEvent("SessionCompleteError",n.message,""),t=null,i=null,D=A.APP_STATS_RECORDING,"function"==typeof a&&a(D)}catch(s){e.report(r,s)}},f=function(t,i){if(e.Utils.verifyCallbacks({successCallBack:t,errorCallBack:i}),D===A.APP_STATS_UNINITIALIZED||D===A.APP_STATS_RECORDING||D===A.APP_STATS_EXPORTING||D===A.APP_STATS_BEGINNING_SESSION){var n=new e.StateError(E.ERROR_STATS_EXPORT_NOT_ALLOWED+" "+_());return void e.report(i,n)}D=A.APP_STATS_EXPORTING,e.AppStats.exportAppStats(function(e){D=A.APP_STATS_INITIALIZED,t(e)},i)},p=function(t,i,n){e.Utils.verifyCallbacks({successCallBack:i,errorCallBack:n});try{if(D!==A.APP_STATS_RECORDING&&D!==A.APP_STATS_BEGINNING_SESSION){var a=new e.StateError(E.ERROR_STATS_LOG_FIELDCHANGE_NOT_ALLOWED+" "+_());return void e.report(n,a)}e.LogisticsEventAppStats.logAppStats(t),"function"==typeof i&&i(P.FIELD_CHANGE_LOGGED)}catch(r){e.report(n,r)}};return{initAppStats:a,startRecord:r,stopRecord:o,isRecording:s,beginSession:l,endSession:u,logSessionEvent:c,logFieldChangeEvent:p,exportAppStats:f}}(),KfxWebSDK.Capture=function(){var t=!1,i=!1,n=function(n,a,r){e.Utils.verifyCallbacks({successCallBack:a,errorCallBack:r});try{e.Utils.validateOptions(n,{useVideoStream:{mandatory:!0,type:"boolean"}}),e.AppStats.prepareInstance(w.CAPTURE);var o=function(i){t=i,t?(e.Utils.validateOptions(n,{preference:{mandatory:!0,type:"string",options:["camera","gallery"]}}),e.CaptureEventAppStats.logAppStats(I.CAPTURE_FALLBACK,"",1),e.CaptureFallback.configure(n,a,r)):(e.Utils.validateOptions(n,{containerId:{mandatory:!0,type:"string",html:{tag:"div",hasChild:!1}},preview:{type:"boolean"}}),e.CaptureEventAppStats.logAppStats(I.ADVANCE_CAPTURE,"",1),e.WebCapture.configure(n,a,r))};if(n.useVideoStream===!1)return void o(!0);KfxWebSDK.Utilities.supportsAutoCapture(function(){o(!n.useVideoStream)},function(){o(!0)})}catch(s){var l=function(){e.report(r,s)};d(l,l,!0)}i=!1},a=function(i,n,a){if(e.Utils.verifyCallbacks({successCallBack:n,errorCallBack:a}),!t)try{e.WebCapture.checkSetOptionsAllowed(),e.WebCapture.setOptions(i),n()}catch(r){e.report(a,r)}},r=function(t,i){e.Utils.verifyCallbacks({successCallBack:t,errorCallBack:i});var n=e.WebCapture.getOptions(),a=e.Guidance.getOptions(),r=n;r.criteria=a,t(r)},o=function(t,i){e.Utils.verifyCallbacks({successCallBack:t,errorCallBack:i});var n=e.WebCapture.getDefaultOptions(),a=e.Guidance.getDefaultOptions(),r=n;r.criteria=a,t(r)},s=function(i,n){if(e.Utils.verifyCallbacks({successCallBack:i,errorCallBack:n}),!t)try{e.WebCapture.capture(i,n)}catch(a){e.report(n,a)}},l=function(n,a){e.Utils.verifyCallbacks({successCallBack:n,errorCallBack:a});try{t?e.CaptureFallback.choosePicture(n,a):e.WebCapture.start(n,a,!1)}catch(r){e.report(a,r)}i=!0},c=function(i,n){e.Utils.verifyCallbacks({successCallBack:i,errorCallBack:n});try{t&&e.CaptureFallback.choosePictureAsBase64(i,n)}catch(a){e.report(n,a)}},u=function(n,a){if(e.Utils.verifyCallbacks({successCallBack:n,errorCallBack:a}),!t){try{e.WebCapture.start(n,a,!0)}catch(r){e.report(a,r)}i=!0}},f=function(n,a){if(e.Utils.verifyCallbacks({successCallBack:n,errorCallBack:a}),!t)try{i=!1,e.WebCapture.stop(n,a)}catch(r){e.report(a,r)}},h=function(t,n){e.Utils.verifyCallbacks({successCallBack:t,errorCallBack:n}),i=!1,d(t,n,!0)},d=function(i,n,a){try{t?e.CaptureFallback.destroy():e.WebCapture.destroy(a),i()}catch(r){e.report(n,r)}},p=function(){return i};return{create:n,setOptions:a,getOptions:r,getDefaultOptions:o,takePicture:l,takePictureContinually:u,forceTakePicture:s,choosePictureAsBase64:c,stopCapture:f,destroy:h,isCameraShown:p}}(),KfxWebSDK.DocumentExtractor=function(){"use strict";var t=function(t,i,n){e.Utils.verifyCallbacks({successCallBack:i,errorCallBack:n}),e.Extraction.extractWithRttiServer(t,i,n)},i=function(t,i,n){e.Utils.verifyCallbacks({successCallBack:i,errorCallBack:n}),e.Extraction.performExtractionWithRttiServer(t,i,n)},n=function(t,i,n){e.Utils.verifyCallbacks({successCallBack:i,errorCallBack:n}),e.Extraction.loginToKTAServer(t,i,n)},a=function(t,i,n){e.Utils.verifyCallbacks({successCallBack:i,errorCallBack:n}),e.Extraction.authenticateIDWithKtaServer(t,i,n)},r=function(t,i,n){e.Utils.verifyCallbacks({successCallBack:i,errorCallBack:n}),e.Extraction.extractWithKtaServer(t,i,n)},o=function(t,i,n){e.Utils.verifyCallbacks({successCallBack:i,errorCallBack:n}),e.Extraction.executeRequestOnKtaServer(t,i,n)},s=function(){e.Extraction.cancelExtraction()};return{extractionWithRttiServer:t,performExtractionWithRttiServer:i,loginToKTAServer:n,extractionWithKtaServer:r,authenticateIDWithKtaServer:a,executeRequestOnKtaServer:o,cancelExtraction:s}}(),KfxWebSDK.ImageProcessor=function(){"use strict";var t=function(t,i,n){e.Utils.verifyCallbacks({successCallBack:i,errorCallBack:n});try{e.ImageProcessor.processImageToBitonal(t,i,n)}catch(a){e.report(n,a)}},i=function(t,i,n,a){if(e.Utils.verifyCallbacks({successCallBack:n,errorCallBack:a}),e.Utils.isClassInstance(t,"HTMLImageElement"))return void e.report(a,new e.ValidationError("HTMLImageElement is deprecated, use ImageData instead"));try{e.ImageProcessor.scaleImage(t,i,n,a)}catch(r){e.report(a,r)}},n=function(t,i,n,a){e.Utils.verifyCallbacks({
successCallBack:n,errorCallBack:a});try{e.ImageProcessor.autoCrop(t,i,n,a)}catch(r){e.report(a,r)}},a=function(t,i,n,a){e.Utils.verifyCallbacks({successCallBack:n,errorCallBack:a});try{e.ImageProcessor.changeDPIForImage(t,i,n,a)}catch(r){e.report(a,r)}};return{bitonal:t,autoCrop:n,scale:i,setDPI:a}}(),function(){"use strict";function t(t,i){e.Utils.validateOptions({containerId:t},{containerId:{type:"string",html:{tag:"div"}}}),n(i),this.containerId=t,this.container=document.getElementById(this.containerId),this.isActive=!1,c=!1;var a=e.Utils.createElement,r=a("div","kfx-layout kfx-review"),o=a("div","kfx-content"),l=a("canvas","kfx-image");e.Utils.isiOSDevice()?l.setAttribute("role","img"):l.setAttribute("role",""),l.setAttribute("aria-label","Review");var u=new s;o.appendChild(l),r.appendChild(o),r.appendChild(u.element),this.element=r,this.canvas=l,this.toolbarView=u}function i(t){t.acceptButton&&e.Utils.validateOptions(t.acceptButton,f),t.retakeButton&&e.Utils.validateOptions(t.retakeButton,f),t.nextButton&&e.Utils.validateOptions(t.nextButton,f)}function n(t){t&&(i(t),e.Utils.setOptions(l,t,u))}function a(){return e.Utils.getOptions(l)}function r(){return e.Utils.getOptions(u)}function o(t,i){for(var n=e.Utils.toggleElement,a=0;a<t.children.length;a++)n(t.children[a],i)}function s(){function t(e){var t=i("button","kfx-button "+e),n=i("div","kfx-text");return t.appendChild(n),t}var i=e.Utils.createElement,n=i("div","kfx-toolbar"),a=t("kfx-accept");n.appendChild(a);var r=t("kfx-retake");n.appendChild(r),this.element=n,this.acceptButton=a,this.retakeButton=r}var l={acceptButton:{text:"Accept"},retakeButton:{text:"Retake"},nextButton:{text:"Next"}},c=!1,u={acceptButton:{text:"Accept"},retakeButton:{text:"Retake"},nextButton:{text:"Next"}},f={text:{type:"string"}};t.prototype.setOptions=function(t,i,a){e.Utils.verifyCallbacks({successCallBack:t,errorCallBack:i});try{n(a),t()}catch(r){e.report(i,r)}},t.prototype.getOptions=function(t,i){e.Utils.verifyCallbacks({successCallBack:t,errorCallBack:i});var n=a();t(n)};var h=function(t,i){e.Utils.verifyCallbacks({successCallBack:t,errorCallBack:i});var n=r();t(n)};t.prototype.review=function(t,i,n){e.Utils.verifyArgument("imageData",t,"ImageData"),e.Utils.verifyCallbacks({acceptCallBack:i,retakeCallBack:n}),o(this.container,!1);var a=this.canvas;a.width=t.width,a.height=t.height;var r=a.getContext("2d");r.putImageData(t,0,0);var s=this.element;this.container.appendChild(s);var u=this.toolbarView,f=document.querySelector(".kfx-review .kfx-toolbar .kfx-button.kfx-accept.kfx-next .kfx-text");f&&(f.innerHTML=l.nextButton.text);var h=document.querySelector(".kfx-review .kfx-toolbar .kfx-button.kfx-accept .kfx-text");h&&!f&&(h.innerHTML=l.acceptButton.text);var d=document.querySelector(".kfx-review .kfx-toolbar .kfx-button.kfx-retake .kfx-text");d&&(d.innerHTML=l.retakeButton.text);var p=function(){u.acceptButton.removeEventListener("click",v),u.retakeButton.removeEventListener("click",S)},m=this,g=function(){r.clearRect(0,0,this.canvas.width,this.canvas.height);var e=document.getElementById(this.containerId);this.canvas.width=0,this.canvas.height=0,m.isActive=!1,c=!1,e&&(e.removeChild(s),o(e,!0))},v=function(){u.acceptButton.classList.contains("kfx-next")||p.call(m);try{i()}finally{if(u.acceptButton.classList.contains("kfx-next")){u.acceptButton.classList.remove("kfx-next");var e=document.querySelector(".kfx-review .kfx-toolbar .kfx-button.kfx-accept .kfx-text");e&&(e.innerHTML=l.acceptButton.text)}else g.call(m)}},S=function(){p.call(m);try{n()}finally{g.call(m)}};u.acceptButton.addEventListener("click",v),u.retakeButton.addEventListener("click",S),m.isActive=!0,c=!0},s.prototype.disable=function(){e.Utils.toggleClass(this.element,"kfx-invisible",!0)},s.prototype.enable=function(){e.Utils.toggleClass(this.element,"kfx-invisible",!1)};var d=function(){return c};KfxWebSDK.ReviewControl=t,KfxWebSDK.ReviewControl.getDefaultOptions=h,KfxWebSDK.ReviewControl.isReviewShown=d}(),KfxWebSDK.SelfieCapture=function(){var t=!1,i=!1,n=function(n,a,r){e.Utils.verifyCallbacks({successCallBack:a,errorCallBack:r});try{e.Utils.validateOptions(n,{videoStream:{mandatory:!0,type:"boolean"}}),e.AppStats.prepareInstance(w.SELFIE_CAPTURE);var o=function(i){t=i,t?(e.SelfieCaptureEventAppStats.logAppStats(x.SELFIE_FALLBACK,"",1),e.SelfieCaptureFallback.configure(n,a,r)):(e.Utils.validateOptions(n,{containerId:{mandatory:!0,type:"string",html:{tag:"div",hasChild:!1}},preview:{type:"boolean"}}),e.SelfieCaptureEventAppStats.logAppStats(x.ADVANCE_CAPTURE,"",1),e.SelfieCapture.configure(n,a,r))};if(n.videoStream===!1)return void o(!0);KfxWebSDK.Utilities.supportsSelfieCapture(function(){o(!n.videoStream)},function(){o(!0)})}catch(s){var l=function(){e.report(r,s)};h(l,l,!0)}i=!1},a=function(i,n,a){if(e.Utils.verifyCallbacks({successCallBack:n,errorCallBack:a}),!t)try{e.SelfieCapture.checkSetOptionsAllowed(),e.SelfieCapture.setOptions(i),n()}catch(r){e.report(a,r)}},r=function(i,n){if(e.Utils.verifyCallbacks({successCallBack:i,errorCallBack:n}),!t){var a=e.SelfieCapture.getOptions(),r=e.SelfieGuidance.getOptions(),o=a;o.criteria=r,i(o)}},o=function(t,i){e.Utils.verifyCallbacks({successCallBack:t,errorCallBack:i});var n=e.SelfieCapture.getDefaultOptions(),a=e.SelfieGuidance.getDefaultOptions(),r=n;r.criteria=a,t(r)},s=function(n,a){e.Utils.verifyCallbacks({successCallBack:n,errorCallBack:a});try{t?e.SelfieCaptureFallback.choosePicture(n,a):e.SelfieCapture.start(n,a)}catch(r){e.report(a,r)}i=!0},l=function(n,a){if(e.Utils.verifyCallbacks({successCallBack:n,errorCallBack:a}),!t){try{e.SelfieCapture.capture(n,a)}catch(r){e.report(a,r)}i=!0}},c=function(n,a){if(e.Utils.verifyCallbacks({successCallBack:n,errorCallBack:a}),!t){try{e.SelfieCapture.stop(n,a)}catch(r){e.report(a,r)}i=!1}},u=function(t,i,n){e.Utils.verifyCallbacks({successCallBack:t,errorCallBack:i});try{e.SelfieCapture.loadModels(t,i,n)}catch(a){e.report(i,a)}},f=function(t,n){e.Utils.verifyCallbacks({successCallBack:t,errorCallBack:n}),i=!1,h(t,n,!0)},h=function(i,n,a){try{t?e.SelfieCaptureFallback.destroy():e.SelfieCapture.destroy(a),i()}catch(r){e.report(n,r)}},d=function(){return i};return{create:n,setOptions:a,getOptions:r,getDefaultOptions:o,takeSelfie:s,forceTakeSelfie:l,stopCapture:c,destroy:f,loadModels:u,isSelfieCameraShown:d}}(),KfxWebSDK.Utilities=function(){"use strict";function t(){if(void 0!==g)return g;if(!i())return!1;if(!n())return!1;var e,t,a=p,r=window.navigator.userAgent;r=r.substring(0,r.indexOf(" AppleWebKit"));for(var o in a)if(a.hasOwnProperty(o)){e=a[o];for(var s in e)if(e.hasOwnProperty(s)){t=e[s];for(var l=0;l<t.length;l++)if(r.indexOf(t[l])>=0)return!1}}return!0}function i(){return window.location.protocol.indexOf("https")>=0}function n(){var t=window.navigator,i=t.getUserMedia;return t.mediaDevices&&(i=t.mediaDevices.getUserMedia||t.mediaDevices.mozGetUserMedia||t.mediaDevices.webkitGetUserMedia||t.mediaDevices.msGetUserMedia),e.Type.isFunction(i)}function a(){if(void 0!==h)return h;if(!i())return!1;var t=e.Utils.getDeviceDetails();if("Android"===t.os.name&&t.os.version<4.5)return!1;if(!n())return!1;var a,r,o=m,s=window.navigator.userAgent;s=s.substring(0,s.indexOf(" AppleWebKit"));for(var l in o)if(o.hasOwnProperty(l)){a=o[l];for(var c in a)if(a.hasOwnProperty(c)){r=a[c];for(var u=0;u<r.length;u++)if(s.indexOf(r[u])>=0)return!1}}return!0}function r(t,i){if(null!==v&&v===!0)return void t();if(null!==y)return void(y?t:i)();if(h=a(),!h)return void i();var n=new e.UserMediaManager(document.createElement("video")),r=function(){n.destroy(),n=null,y=!0,t()},o=function(){n.destroy(),n=null,y=!1,i()};n.configureForSelfie(r,o)}function o(i,n){if(null!==S)return void(S?i:n)();if(!t())return S=!1,void n();var a=new e.UserMediaManager(document.createElement("video")),r=function(){b=l(a),a.destroy(),a=null,S=!0,i()},o=function(){a.destroy(),a=null,S=!1,b=!1,n()};a.configure(r,o,!0,!1)}function s(i,n){if(null!==S&&S===!0)return void i();if(null!==v)return void(v?i:n)();if(!t())return v=!1,void n();var a=new e.UserMediaManager(document.createElement("video")),r=function(){b=l(a),a.destroy(),a=null,v=!0,i()},o=function(){a.destroy(),a=null,v=!1,b=!1,n()};a.configure(r,o,!1,!1)}function l(e){var t=e.stream.stream.getVideoTracks()[0];if(t&&"function"==typeof t.getCapabilities){var i=t.getCapabilities();return!!i.torch}return!1}function c(e,t,i){i=i||KfxWebSDK.resolution.RES_FULL_HD,i===KfxWebSDK.resolution.RES_FULL_HD?s(e,t):i===KfxWebSDK.resolution.RES_4K?o(e,t):t()}function u(e,t){return null!==b&&b===!0?void e():null!==b&&b===!1?void t():void s(function(){(b?e:t)()},t)}function f(){return KfxWebSDK.Capture.isCameraShown()&&!KfxWebSDK.ReviewControl.isReviewShown()?d.CAPTURE_MODE:KfxWebSDK.SelfieCapture.isSelfieCameraShown()&&!KfxWebSDK.ReviewControl.isReviewShown()?d.SELFIE_CAPTURE_MODE:KfxWebSDK.ReviewControl.isReviewShown()?d.REVIEW_MODE:d.NONE}var h,d={CAPTURE_MODE:"KFX_CAPTURE_MODE",SELFIE_CAPTURE_MODE:"KFX_SELFIE_CAPTURE_MODE",REVIEW_MODE:"KFX_REVIEW_MODE",NONE:"KFX_NONE"},p={Samsung:{"Galaxy S2":["GT-I9100","SPH-D710","SC-02C","SC-03D","Galaxy S2","GT-I9100G","GT-I9100T","GT-I9210T","GT-I9100M","SGH-I757M","SGH-I727R","SGH-I927","SGH-T989D","GT-I9108","GT-I9100G","SCH-I929","GT-I9100P","ISW11SC","SHW-M250K","SHW-M250L","SHW-M250S","SGH-I777","SGH-I727","SGH-I927","SCH-R760"],"Galaxy S3":["GT-I9300","GT-I9305","SC-06D","SC-03E","Galaxy S3","SHV-E210K","SHV-E210L","SHV-E210S","SGH-T999","SGH-T999L","SGH-I747","SGH-N064","SGH-N035","SCH-J021","SCH-R530","SCH-I535","SCH-S960L","SCH-S968C","GT-I9308","SCH-I939"],"Galaxy Note 3":["SM-N900","GT-N9000","SCL22","SC-01F","SM-W900W8","SM-N9005","SM-N9002","SM-N9006","SM-N900A","SM-N900T","SM-N900P","SM-N900V","SM-N900R4"],"Galaxy S4":["GT-I9505","GT-I9500","GT-I9515","GT-I9506","GT-I9502","SCH-I545","SPH-L720","SGH-M919","SGH-I337","SHV-E300","SC-04E","GT-I9192","SGH-i337","Galaxy S4","SHV-E300K","SHV-E300L","SHV-E300S","SHV-E330K","SHV-E330L","SHV-E330S","GT-I9505","GT-I9506","GT-I9505G","SGH-I337","SGH-M919","SCH-I545","SPH-L720","SCH-R970","GT-I9508","SCH-I959","GT-I9502","SGH-N045","SGH-I337M","SGH-M919V","SCH-R970X","SCH-R970C"],"Galaxy S4 Mini":["GT-I9195","GT-I9190","GT-I9195L","GT-I9195T","GT-I9192","GT-I9197","GT-I9198","SGH-I257M","SCH-I435"],"Galaxy Note 4":["SM-N910C","SM-N910P","SM-N910G","SM-N910V","SM-N910H","SM-N910A","SM-N910F","SM-N910R4","SM-N910S","SM-N910T","SM-N910U","SM-N910W8"],"Galaxy S5":["SM-G900","Galaxy S5","SM-G900H","SM-G900F","SM-G900FD","SM-G900I","SM-G900K","SM-G900L","SM-G900S","SM-G900M","SM-G900MD","SM-G900W8","SM-G900T","SM-G900T1","SM-G900A","SM-G900V","SM-G900R4","SM-G900P","SM-G9006W","SM-G9008V","SM-G9009D","SM-G900D","SM-G900J"],"Galaxy S6":["SM-G925F","SM-G928X","SM-G920V","Galaxy S6","SM-G925A","SM-G925S","SM-G925FQ","SM-G925i","SM-G925P","SM-G925R4","SM-G925T","SM-G925V","SM-G925W8","SM-G920FQ","SM-G920i","SM-G920P","SM-G920R4","SM-G920T","SM-G920S","SM-G920V","SM-G920W8"],"Galaxy S7":["SM-G935F","SM-G930V","SM-G930F","Galaxy S7","SM-G935FD","SM-G935W8","SM-G935S","SM-G935K","SM-G935L","SM-G9350","SM-G935V","SM-G935A","SM-G935P","SM-G935T","SM-G935U","SM-G935R4","SC-02H","SCV33","SM-G935U","SM-891A","SM-G930FD","SM-G930W8","SM-G930S","SM-G930K","SM-G930L","SM-G9300 ","SM-G930AZ","SM-G930P","SM-G930T","SM-G930R4","SM-G930R4","SM-G9308","SM-G930U","SM-G930A"],"Galaxy Tab S":["SM-T800","SM-T700","SM-T805","SM-T705","SCT21","SM-T807","SM-T807P","SM-T807V"],"Galaxy S10 Plus":["SM-G9750","SM-G975F","SM-G975U","SM-G975W","SM-G9758","SM-G975XU","SM-G975N"]},LG:{G2:["LG-D802","VS980 4G","LG-D800","LG-D801","LG-LS980","LG-D805","LG-D803","L-01F"],G3:["LG-D855","VS985 4G","LG-D850","LG-D851","LG-D852","LG-D858","LG-D859","LG-LS990","LG-US990","LG-AS985","LG-F400"],G4:["LG-H815","LG-H540","LG-H818","LG-H818N","LG-H818P","LG-LS991","LG-H810","LG-H819","LGLS991","LGVS986","LG LS991"],G5:["LG-H820","LG-H830","LG-H840","LG-H848","LG-H850","LG-H860","LG-VS987","LG-LS992"],G6:["LG-H870","LG-H870S","LG-H870K","LG-H870V","LG-H870DS","LG-H871","LG-H872","LG-H872PR","LG-H873","LG-G600S","LG-G600K","LG-G600L","LG-G600V","LG-US997","LG-LS993","LG-AS993","LG-VS998B","LG-VS998G","LG-VS998P","LG-VS998T","LG-VS998W"],G7:["LM-G710EAW","LMG710EAW","LM-G710","LMG710","LM-G710N","LMG710N","LM-G710EM","LMG710EM","LM-G710AWM","LMG710AWM","LM-G710EMW","LMG710EMW","LM-G710TM","LMG710TM","LM-G710ULM","LMG710ULM","LM-G710VMX","LMG710VMX","LM-G710PM","LMG710PM","LM-G710VM","LMG710VM"],"Optimus G Pro":["LG-E940","LG-E980","LG-E986","LG-E988","LG-E989"]},HTC:{"One M8":["HTC_0P6B","HTC6525LVW","HTC_PN071","HTC_P4550","HTC One M8"],"One M9":["HTC One M9"]},Motorola:{"Moto X 2nd Gen":["XT1092","XT1093","XT1094","XT1095","XT1096","XT1097","XT1085"],"Moto G":["XT1033","XT1032","XT1034","XT1028","XT1068","XT1031","XT1039","XT1040","XT1042","XT1045"],"Moto G4":["Moto G (4)","XT1625","XT1622","XT1621","XT1620","XT1626","XT1624"]},Nexus:{"Nexus 4":["Nexus 4"],"Nexus 9":["Nexus 9"]},OnePlus:{6:["ONEPLUS A6003"]},Asus:{"Asus ZenFone 2(E)":["ASUS ZenFone 2"],"Asus ZenFone Zoom":["ASUS_Z00XS","ASUS_ZX550","ASUS_ZX551ML"],"Asus Zoom 3":["ASUS_Z01HDA"],"Asus ZenPad 10":["P028","P023","P01T","P001","P00C"]},Sony:{"Xperia Tablet Z":["SGP311","SGP312","SGP321","SGP511","SO-03E","SGP351"],"Xperia Z1":["C6916","C6903","SO-02F","Xperia Z1","SOL23","C6902","C6906","C6943","L39t","L39h","D5503"]},HUAWEI:{"MediaPad M5 Pro":["CMR-W19","CMR-AL19"]},Google:{"Pixel C":["Pixel C"]}},m={Nexus:{"Nexus 9":["Nexus 9"],"Nexus 4":["Nexus 4"],"Nexus 5":["Nexus 5"],"Nexus 6":["Nexus 6"],"Nexus 6P":["Nexus 6P"]},Samsung:{"Galaxy Tab S":["SM-T800","SM-T700","SM-T801","SM-T805","SM-T705","SCT21","SM-T807","SM-T807P","SM-T807V"],"Galaxy Note 3":["SM-N900","GT-N9000","SCL22","SC-01F","SM-W900W8","SM-N9005","SM-N9002","SM-N9006","SM-N900A","SM-N900T","SM-N900P","SM-N900V","SM-N900R4"]},Motorola:{"Moto X":["XT1049","XT1050","XT1052","XT1053","XT1055","XT1056","XT1058","XT1060"],"Moto X 2nd Gen":["XT1092","XT1093","XT1094","XT1095","XT1096","XT1097","XT1085"],"Moto G4":["Moto G (4)","XT1625","XT1622","XT1621","XT1620","XT1626","XT1624"],"Moto G3":["MotoG3","MotoG3-TE","XT1540","XT1543","XT1544","XT1548","XT1541"]},Sony:{"Xperia Z1":["C6916","C6903","SO-02F","Xperia Z1","SOL23","C6902","C6906","C6943","L39t","L39h","D5503"]},Asus:{"Asus ZenFone Zoom":["ASUS_Z00XS","ASUS_ZX550","ASUS_ZX551ML"]},Redmi:{"Note 4":["Note 4"]},MI:{"MI 5X":["MI 5X"]},HTC:{"One M8":["HTC_0P6B","HTC6525LVW","HTC_PN071","HTC_P4550","HTC One M8"],"Desire 12+":["HTC Desire 12+"]}},g=t(),v=null,S=null,y=null,b=null;return{supportsAutoCapture:c,supportsSelfieCapture:r,supportsFlash:u,getCaptureViewMode:f}}()}();
//# sourceMappingURL=KfxWebSDK.js.map
